<?xml version="1.0"?>
<rss version="2.0">
  <channel>
    <title>UZABASE Tech Blog</title>
    <link>http://tech.uzabase.com/</link>
    <description>株式会社ユーザベースの技術チームブログです。 主に週次の持ち回りLTやセミナー・イベント情報について書きます。</description>
    <lastBuildDate>Wed, 11 Oct 2017 13:03:52 +0900</lastBuildDate>
    <docs>http://blogs.law.harvard.edu/tech/rss</docs>
    <generator>Hatena::Blog</generator>
    
      
      
        <item>
          <title>Chrome hackingと称しブラウザのレイアウトバグをみんなで調べてみました</title>
          <link>http://tech.uzabase.com/entry/2017/10/11/130352</link>          <description><p>はじめまして。プロダクト開発チームの<a href="https://github.com/ryoqun">小野寺 (ryoqun)</a>です。</p>

<p><a href="https://google.com/chrome/browser/">Google Chrome (以下、Chrome)</a>にて、HTMLのレンダリングの回帰バグが紛れ込み、その影響で<a href="https://jp.ub-speeda.com/">SPEEDA</a>の一部分のレイアウトが崩れてしまう問題が発生しました。そこで、「Chrome hacking」と称し、数名の希望者を社内で募り、みんなでこのバグを調査、あわよくば解決しChromeのコミットログに<code>@uzabase.com</code>のドメインを刻もうと奮い立ちました。</p>

<p>しかし結論として、別の案件が入り、作業を中断している間に先を越され、名を刻むことはできませんでした。つまりは現在このバグは別の開発者によって修正が完了しています。しかし、結果的にはOSSのソースコードレベルでの調査の実例としては非常に好例となりました。</p>

<p>その活動記録として、SPEEDA上での問題の発覚からChromeのバグであるという原因の特定や調査から収束に至るまでの一連の出来事を共有したいと思います。</p>

<h2>前提として、<b>本当に</b>Chromeのレイアウトバグでした</h2>

<p>最初はChromeのバグだと断言できませんでした。</p>

<p>そのため、本当にChromeがCSS 2.1のレイアウト回帰バグを混入させてしまったことが原因だと分かった時は驚きでした。</p>

<p>当然として、SPEEDAでのレイアウトバグの発覚直後は、SPEEDAのCSSの問題だと考えていました。
というのもCSSは呆れるくらいに枯れたバグの入る余地のないWebの基礎技術だからです。</p>

<p>CSS 2.1として2011年6月に<a href="https://en.wikipedia.org/w/index.php?title=Cascading_Style_Sheets&amp;oldid=797497810#cite_note-w3.org-40">W3C Recommendationとなり</a>、それから5年以上が経過しています。それまでの歩みは決して容易いものではなかったため、CSSは鉄壁の仕様となっています(1990年代の血みどろのブラウザ競争の中で産み落とされたCSS 1.0がのたうちまわり、当時のWebエンジニアたちをInteroperatabilityの名の下苦悩させ、戦禍の反省とでもいうかのごとく「複数レンダリングエンジン上で実装済み」という大義名分の元、W3CによってひねりだされたCSS 2.0が2000年代を通し、これでもかというくらいに精緻に策定され、晴れてCSS 2.1は生み出されました)。</p>

<p>培われた仕様の厳密性、テストケースの網羅性はもはや芸術レベルで、1つの仕様に対しての手厚さとしては数有る仕様の中でもトップクラスにCSSは位置すると思います(特に個人的には<a href="https://www.w3.org/TR/CSS22/visuren.html">9 Visual formatting model</a>や<a href="https://www.w3.org/TR/CSS22/visudet.html">10 Visual formatting model details</a>あたりは傑作だと思います)。</p>

<p>ということで、2017年の今日において、枯れたCSSに対し、<a href="https://en.wikipedia.org/wiki/Internet_Explorer_6">IE 6</a>やガラケーと戯れて涙を飲みながらレイアウトバグの回避を模索していた苦悩の2000年代を彷彿とさせる事象に再び直面し、非常に印象的でした。
<b>どんなに枯れていようが常にソフトウェアにはバグがつきものであり、バグに直面した時、時には自分たちのコードだけでなくミドルウェアも疑う必要性を痛感しました。</b>
また、CSSを正しく実装することがいかに難しいことであるかの証左なのかもしれません。</p>

<h2>バグの発覚と内容</h2>

<p>今回のバグは、SPEEDAの本番環境にて、<a href="https://chromereleases.googleblog.com/2017/06/stable-channel-update-for-desktop.html">デスクトップ向けのChromeのStableチャンネルに59が出始めてから</a>ようやく気づきました。</p>

<p>バグの内容は、サイト検索フォームの下に表示されるサジェスト候補の一覧が異様に高くなってしまうというものでした。SPEEDAは一般公開されているサービスではないので見せられるスクリーンショットがかなり限定的でわかりにくいのですが、正しいレンダリング時の画像はこのようになります：</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170901/20170901011237.png" alt="f:id:ryoqun:20170901011237p:plain" title="f:id:ryoqun:20170901011237p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>逆に、正しくないレンダリング時の画像は、このようにかなり縦長な感じになってしまいます：</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170901/20170901011251.png" alt="f:id:ryoqun:20170901011251p:plain" title="f:id:ryoqun:20170901011251p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>これだけだとイメージがつきにくいのですが、サジェスト候補が画面表示領域に対してかなりの占有率になってしまい、ユーザーにも違和感を与えるレベルになってしまいました。</p>

<h2>とりあえず応急処置</h2>

<p>他のブラウザや以前のバージョンのChromeでは問題が起きなかったことから、どう考えてもChromeのバグらしいというのが判明してきました。そうなってくるとChromeはすぐには修正されないのでまずは応急処置です。
レンダリングエンジンがどう動いているかを想像しつつ、クロスブラウザで無害で等価なCSSを色々と試行錯誤した結果、結局は以下の変更だけで直ってしまいました。</p>

<pre class="code lang-diff" data-lang="diff" data-unlink> .g-search-suggest li .suggestItem {
<span class="synSpecial">-  display: block;</span>
<span class="synIdentifier">+  display: inline-block;</span>
   padding-left: 90px;
   color: #555;
</pre>


<p>CSS的にはほとんど等価なはずなので、やはりどう考えてもChromeのバグのようでした(ちなみに、こういうレイアウトバグの回避策なんてものは、すっかり失われし技術となってしまいました)。</p>

<p>この応急処置をSPEEDAに反映し、次にChromeを直そうということになりました。</p>

<h2>ミニマルテストケースの作成</h2>

<p>ともかくも最初はミニマルテストケースを作りました。そうすることによって社内に公開しても大丈夫で<a href="https://bugs.chromium.org/p/chromium/issues/list">Googleにもバグレポートを送れる</a>ようになります。
作ったミニマルテストケースは↓の通りです。</p>

<pre class="code lang-html" data-lang="html" data-unlink><span class="synComment">&lt;!DOCTYPE html&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">html</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">style</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">.suggestItemOk1</span> <span class="synIdentifier">{</span>
  <span class="synType">display</span>: <span class="synConstant">inline</span>;
<span class="synIdentifier">}</span>
<span class="synIdentifier">.suggestItemOk2</span> <span class="synIdentifier">{</span>
  <span class="synType">display</span>: <span class="synConstant">inline-block</span>;
<span class="synIdentifier">}</span>
<span class="synIdentifier">.suggestItemNg</span> <span class="synIdentifier">{</span>
  <span class="synType">display</span>: <span class="synConstant">block</span>;
<span class="synIdentifier">}</span>
<span class="synIdentifier">.item</span> <span class="synIdentifier">{</span>
  <span class="synType">overflow</span>: <span class="synConstant">hidden</span>;
  <span class="synType">display</span>: <span class="synConstant">inline-block</span>;
<span class="synIdentifier">}</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">style</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk1&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>AAA<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk1&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>BBB<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk1&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>CCC<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk2&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>AAA<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk2&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>BBB<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemOk2&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>CCC<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemNg&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>AAA<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemNg&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>BBB<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;suggestItemNg&quot;</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;item&quot;</span><span class="synIdentifier">&gt;</span>CCC<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">body</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">html</span><span class="synIdentifier">&gt;</span>
</pre>


<p>ミニマルテストケースの正しいレンダリング時の画像はこうなります:</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170901/20170901013353.png" alt="f:id:ryoqun:20170901013353p:plain" title="f:id:ryoqun:20170901013353p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>逆に、正しくないレンダリング時の画像はこうなります：</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170901/20170901013155.png" alt="f:id:ryoqun:20170901013155p:plain" title="f:id:ryoqun:20170901013155p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>SPEEDA上でのレイアウトバグとなんとなく似ているのは想像できるかと思います。</p>

<p>このミニマルテストケースから分かることは、<code>display: list-item</code>と<code>overflow: hidden</code>,<code>display: block</code>が組み合わさるとどうやらまずいということです。その情報を元に<a href="https://bugs.chromium.org/p/chromium/issues/list?can=2&amp;q=inline+block+overflow+hidden&amp;colspec=ID+Pri+M+Stars+ReleaseBlock+Component+Status+Owner+Summary+OS+Modified&amp;x=m&amp;y=releaseblock&amp;cells=ids">Chromiumのバグを検索</a>してみましたが、同様のバグが見当たらなかったため、自分たちで直してみようということになりました(ちなみに、今現在はこのキーワードで検索すると、今回の回帰バグのレポートを見つけることができます)。</p>

<h2>Chromiumのビルド</h2>

<p>Chromeは、オープンソースである<a href="https://www.chromium.org/">Chromium</a>から作られています。そこでオープンソースの真価を発揮ということで、<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_build_instructions.md">手元のマシンでビルド</a>してみました。Chromiumは相当な数のサードパーティーライブラリに依存していますが、独自ツール(<code>gyp</code>)を使って比較的簡単にビルド環境を構築できます。ただストレージ容量は結構必要で、例えば私の場合は50GBは必要でした。</p>

<p>また、今回は回帰バグなのでChromium 58とChromium 59のどちらも並行させてビルドし、比較調査しやすいようにしました。</p>

<h2>実際にHackして怪しい箇所を見つける</h2>

<p>ChromeのDeveloper Toolsから得られる情報だけではレイアウトバグの状況が分からなかったので、ブラウザの真骨頂であるレンダリングの中のレイアウト(Reflow)コードを読む必要があります。大抵の大規模ソフトウェアは開発目的で色々な内部状態をダンプする機能があり、Chromiumも例外ではありません。ですが、今回の参加メンバーはChromeにはそれほど詳しくないため、当初はそのやり方が分からず、ソースコードとWebと変更履歴をつっつきまわり、最終的にはデバッグ情報を出力させることができました。</p>

<p>具体的には下のように、デバッグ関数をよく通るであろうコードパスから呼び出してみました。</p>

<pre class="code lang-diff" data-lang="diff" data-unlink><span class="synType">diff --git a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
index 92af305..946e7c9 100644
<span class="synType">--- a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synType">+++ b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synStatement">@@ -466,6 +466,10 @@</span><span class="synPreProc"> void LayoutListItem::PositionListMarker() {</span>
 
 void LayoutListItem::Paint(const PaintInfo&amp; paint_info,
                            const LayoutPoint&amp; paint_offset) const {
<span class="synIdentifier">+  this-&gt;ShowTreeForThis();</span>
<span class="synIdentifier">+  this-&gt;ShowLayoutTreeForThis();</span>
<span class="synIdentifier">+  this-&gt;ShowLineTreeForThis();</span>
<span class="synIdentifier">+  //this-&gt;ShowDebugData();</span>
   ListItemPainter(*this).Paint(paint_info, paint_offset);
 }
</pre>


<p>そして、レイアウトバグの有無によって、↓のような違う2つのレイアウトツリーが生成されていることが分かりました。</p>

<p><b>正しい</b>レイアウトツリー:</p>

<pre class="code" data-lang="" data-unlink>LayoutListItem 0x19a65d2243d0   LI
  LayoutListMarker (anonymous) 0x19a65d218df0
  LayoutBlockFlow 0x19a65d218f18        SPAN class=&#34;suggestItemOk2&#34;
    LayoutBlockFlow 0x19a65d219040      SPAN class=&#34;item&#34;
      LayoutText 0x19a65d2415f0 #text &#34;CCC&#34;
LayoutListItem 0x19a65d224290   LI
  LayoutBlockFlow 0x19a65d218828        SPAN class=&#34;suggestItemNg&#34;
    LayoutListMarker (anonymous) 0x19a65d2184b0
    LayoutBlockFlow 0x19a65d218cc8      SPAN class=&#34;item&#34;
      LayoutText 0x19a65d241528 #text &#34;AAA&#34;  </pre>


<p><b>正しくない</b>レイアウトツリー(<code>suggestItemNg</code>の<code>LayoutListMarker</code>が外出しされてしまっている):</p>

<pre class="code" data-lang="" data-unlink>LayoutListItem 0x19a65d224650   LI
  LayoutListMarker (anonymous) 0x19a65d219168
  LayoutBlockFlow 0x19a65d219290        SPAN class=&#34;suggestItemOk2&#34;
    LayoutBlockFlow 0x19a65d2193b8      SPAN class=&#34;item&#34;
      LayoutText 0x19a65d240ee8 #text &#34;CCC&#34;
LayoutListItem 0x19a65d224790   LI
  LayoutBlockFlow (anonymous) 0x19a65d218a78
    LayoutListMarker (anonymous) 0x19a65d219608
  LayoutBlockFlow 0x19a65d219e20        SPAN class=&#34;suggestItemNg&#34;
    LayoutBlockFlow 0x19a65d219cf8      SPAN class=&#34;item&#34;
      LayoutText 0x19a65d241910 #text &#34;AAA&#34;
</pre>


<p>正しくないレイアウトツリー中で、アドレスが<code>0x19a65d218a78</code>の<code>LayoutBlockFlow</code>が余計に生成されています。これによって余計な論理的な行が追加され、意図せず高さがおかしくなってしまうというからくりのようでした。</p>

<p>ここまでくればもう峠を越していて、あとはこの差異をとことん調べ込んでいけばよくなります。</p>

<p>今まではまったくの五里霧中で、どこにバグがあるのか分からず怪しそうなところをとにかく広く浅く探す必要がありました。胸をなでおろせた瞬間でした。</p>

<h2>コミットの特定</h2>

<p><code>&lt;li&gt;</code>関連の実装が肝になっているようだったので、<code>LayoutListItem</code>のソースコードを入念に見ました。調べた結果、回帰バグを混入させた<a href="https://chromium.googlesource.com/chromium/src.git/+/fd1e60f0bee4b6b25d898f4f4f859aa38d1a9643%5E%21/#F2">コミット</a>を特定することができ、それを<code>git revert</code>してビルドし直したらバグが発生しなくなりました！
いろいろな切り口で調べたのですが、結果的には<code>git annotate</code>が決め手でした。比較的浅い回帰バグには<code>git annotate</code>は有効です。</p>

<p>変更内容としては非常に小さいです。ちなみにこの変更を見てみると、もともとはまた別のレイアウトのバグを直そうとしていたようです。</p>

<pre class="code lang-diff" data-lang="diff" data-unlink><span class="synType">diff --git a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
index 6c98974..4dbf2a7 100644
<span class="synType">--- a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synType">+++ b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synStatement">@@ -257,6 +257,11 @@</span><span class="synPreProc"> static LayoutObject* getParentOfFirstLineBox(LayoutBlockFlow* curr,</span>
     if (currChild == marker)
       continue;

<span class="synIdentifier">+    // Shouldn't add marker into Overflow box, instead, add marker</span>
<span class="synIdentifier">+    // into listitem</span>
<span class="synIdentifier">+    if (currChild-&gt;hasOverflowClip())</span>
<span class="synIdentifier">+      break;</span>
<span class="synIdentifier">+</span>
     if (currChild-&gt;isInline() &amp;&amp;
         (!currChild-&gt;isLayoutInline() ||
          curr-&gt;generatesLineBoxesForInlineChild(currChild)))
</pre>


<h2>いざ修正！(は叶わず…)</h2>

<p>直そう！と思って一旦保留していたら、先を越され、その間にupstreamで修正されてしまいました。非常に残念です。</p>

<ul>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=626293">今回回帰バグを紛れ込ませてしまったChromiumのBTS上のIssue</a></li>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=747695">その回帰バグを修正したChromiumのBTS上のIssue</a></li>
</ul>


<p>修正に必要なコードはたったの一行でした。もともとが2行を追加しただけで回帰バグが発生したのですから、その2行のどちらかを直せば回帰バグは直るというわけです。</p>

<pre class="code lang-diff" data-lang="diff" data-unlink><span class="synType">diff --git a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
index 18e98a78..893ee6e 100644
<span class="synType">--- a/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synType">+++ b/third_party/WebKit/Source/core/layout/LayoutListItem.cpp</span>
<span class="synStatement">@@ -259,7 +259,7 @@</span><span class="synPreProc"> static LayoutObject* GetParentOfFirstLineBox(LayoutBlockFlow* curr,</span>
 
     // Shouldn't add marker into Overflow box, instead, add marker
     // into listitem
<span class="synSpecial">-    if (curr_child-&gt;HasOverflowClip())</span>
<span class="synIdentifier">+    if (curr-&gt;HasOverflowClip())</span>
       break;
 
     if (curr_child-&gt;IsInline() &amp;&amp;
</pre>


<h2>コードリーディング</h2>

<p>今回の一連の修正で問題なのは、<code>ListMarker</code>をLayout Treeに配置する場所です。
回帰バグの発生前後に関わらず、大前提として<b><code>LayoutBlockFlow(class=suggeestItemNg)</code>の子として<code>ListMarker</code>を追加する</b>必要があります。しかし、その前提が1つ目の修正で崩れてしまいました。回帰バグにより<code>LayoutListItem(&lt;li&gt;)</code>の子として追加するように意図せず実装が変わってしまいました。</p>

<p>その原因を少し説明します。</p>

<p>まず、1つ目の修正で本当に直したかったことは、<code>&lt;li&gt;</code>に<code>overflow: hidden</code>な子要素があるとき、その子として<code>ListMarker</code>を追加するとclipされ、表示されないという問題でした。</p>

<p>その場合は<code>ListItem</code>の子として<code>ListMarker</code>を入れる必要があります。なので1つ目の修正ではそういうロジックを<code>GetParentOfFirstLineBox()</code>に新規に追加しました。</p>

<p>具体的には、特定条件時に<code>GetParentOfFirstLineBox()</code>からは<code>break</code>経由で<code>nullptr</code>を返し、呼び元である<code>UpdateMarkerLocation()</code>が<code>ListItem</code>の子として<code>ListMarker</code>を追加するというものです。しかし、その判定条件が正しくなく回帰バグが発生してしまいました。</p>

<p>ちなみに、この処理の副作用として改行が必然的に発生します(これがCSS的に正しいかは微妙です)。これは1つ目の修正としては許容するようですが、我々のミニマルテストケースでは許容されません。ミニマルテストケースの正しいレイアウトの挙動は<code>LayoutBlockFlow(class=suggeestItemNg)</code>の子として<code>ListMarker</code>を追加することです。</p>

<p>追加した判定条件中で<code>HasOverflowClip()</code>が判定すべき対象は<code>curr</code>(つまりは<code>LayoutBlockFlow(class=suggeestItemNg)</code>)であり<code>curr_child</code>ではありません。まさに2つ目の修正ではそうなっています。
というのも、<code>curr_child</code>をどうこうというよりもまずは<code>curr</code>が<code>HasOverflowClip()</code>でないならば、<code>curr</code>は<code>ListMarker</code>の親として適切なので、<code>curr</code>に<code>ListMarker</code>を追加すべきだからです。</p>

<p>上のミニマルテストケースは<code>&lt;span class="suggeestItemNg"&gt;</code>の子として<code>&lt;span class="item"&gt;</code>がいます。正しくない条件では、<b><code>overflow: hidden</code>な</b><code>&lt;span class="item"&gt;</code>が<code>&lt;span class="suggeestItemNg"&gt;</code>の子要素となっているために、判定結果が誤って真になり、<code>ListMarker</code>が<code>ListItem</code>の子として追加されてしまいました。繰り返しますが、本来は<code>overflow: hidden</code>でない<code>LayoutBlockFlow(class=suggeestItemNg)</code>の子として追加すべきです。</p>

<p>結果、不要な<code>LayoutBlockFlow</code>ができたことで論理改行が発生し、最終的には高さが意図せず高くなってしまうというレイアウト崩れが発生しました。</p>

<h2>感想</h2>

<p>参加したメンバーの感想です。</p>

<p>小野寺: 複数人でレイアウトロジックの動きを追うのは難しかったです。当社のSPEEDA開発グループではペアプロを積極採用しているのでペアプロの応用実践として何かいい解決案を考えてみたいと思いました。</p>

<p>北内: レンダリングエンジンのソースコードを追うのは骨の折れる作業でしたが、複数人で協力しながら作業したおかげで根気よく進めることができました。また、Appleと共同で開発していたWebKitからフォークしてBlinkに移行したことにともない、メンバ関数の名前をlower-camelcaseからupper-camelcaseに変更するといった変更履歴を見ることができたのも興味深かったです。</p>

<p>鈴木: Chromeがマルチプロセスで動いているからかデバッガでうまくプロセスにattachできなかったため、git grepとデバッグプリントを利用した最終的かつ原始的な手法でバグを調査しましたが、結果的に、これは思いの外有効な策となりました。また、複数人でバグ調査を行う場合、様々な視点・観点を得られ、またメンタル的にもメリットがあるので、機会があればおすすめしたいです。</p>

<p>久保: SREチームでインフラエンジニアとして普段業務をしているため、Chromeのバグ改修は自分には非常にハードルが高く、先輩方についていくだけで必死でしたが、Chromeのような超大なソースのバグの原因を特定する際に、どのようにあたりをつけていくのかについて少し掴めたように思います。今後のSREチームとしての業務に活かせると思いました（Uzabaseのinfraチームは今年の7月よりinfraチームから<a href="https://landing.google.com/sre/">SRE</a>チームに変わり、4Q(10月)以降本格的にSREチームとしてサービス改善にコミットし、バグの改修やレスポンス改善などこれまでのインフラレイヤーにとどまらない業務範囲になります）。</p>

<h2>まとめ</h2>

<p>今回はソースコードレベルまでの調査を業務で行いました。当社では今後もOSSにも積極的に取り組んでいきたいと思います。Chrome内のソースコードが原因の修正までは特定できたのはよかったのですが、別件の案件が入り、Chrome hackingを一旦保留にしていたら、upstreamでその間に修正されてしまい惜しかったです(本来は自分たちでバグレポートを立てて、テストケース込みでパッチを提出しようとしていたのですが……)。</p>

<p>長くなりましたが、最後にまとめでこの記事を終わりたいと思います。</p>

<ul>
<li>天下のGoogleのしかもChromeでさえも回帰バグが紛れ込んでしまうことがある。</li>
<li>オープンソースだと簡単なバグは自分たちで調査＆修正はやろうと思えばできて、みんなでOSSに貢献できる。</li>
<li>弊社では、時にはミドルウェアへのソースコード調査＆解決も厭わない情熱あふれる問題解決大好きエンジニアを募集しています。</li>
</ul>


<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F114230" title="急成長の新サービスでSUPERなエンジニアになりたい人WANTED！ by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/114230">www.wantedly.com</a></cite></p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F136928" title="日本最大級のベンチャー情報プラットフォームの開発エンジニア募集！！ by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/136928">www.wantedly.com</a></cite></p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F45821" title="海外で世界一の経済情報プラットフォームを作りたいエンジニア募集！ by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/45821">www.wantedly.com</a></cite></p>
</description>          <pubDate>Wed, 11 Oct 2017 13:03:52 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812293694236</guid>
          
          <enclosure url="https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Gauge Test Automation Toolとアジャイル開発</title>
          <link>http://tech.uzabase.com/entry/2017/09/26/191009</link>          <description><p>こんにちはSPEEDAのQAチームの工藤です。<br/>
最近ではテスト自動化周りのツールが数多く存在していますが、英語でのみ提供されていて日本で多くの人に知られていないサービスも多いと思います。<br/>
そんな中、<b>Gauge</b>という自動化のツールがイケてるという情報を発見したので実際に調べてみました。</p>

<h1>はじめに</h1>

<p>GaugeとはThoughtWorks社が開発しているオープンソースのテスト自動化ツールです（2017年7月現在でベータ版）。<br/>
もっと具体的に言うと様々なロールのメンバーが自動テストのスクリプトを理解できるようにするためのspecificationツール（恐らく立ち位置的にはCucumber/Gherkinの代替）になります。<br/>
ざっくりGaugeの良いところを挙げると下記になります。</p>

<ul>
<li>Selenium Webdriverと一緒に使える</li>
<li>マークダウン形式で記述できる</li>
<li>ビジネス言語でテスト仕様を記述できる（実行可能な仕様書の概念をサポート）</li>
<li>多言語、マルチプラットフォームをサポート</li>
<li>外部データソースからテストデータを読み込める</li>
<li>拡張可能（自分でpluginを開発できる）</li>
<li>IDEのサポートが充実している</li>
</ul>


<h1>Gaugeで使う用語</h1>

<p>下記がGaugeで使用する基本的な用語（概念）です。<br/>
使い始めるのに最低限必要そうなものをピックアップしているので、当然他にもあります。</p>

<ul>
<li>Specifications(spec)</li>
<li>Scenarios</li>
<li>Steps</li>
<li>Tags</li>
</ul>


<p>もう少し詳しく説明していきます。</p>

<h4>Specification(spec)</h4>

<p>テスト対象アプリケーションの特定の機能の仕様を説明しています。</p>

<h4>Scenarios</h4>

<p>各Scenarioは、特定の仕様の1つのフローを表しています。仕様には少なくとも1つのScenarioが含まれている必要があります。</p>

<h4>Steps</h4>

<p>仕様を実行可能なコンポーネントに分けたものがStepになります。マークダウン形式のunordered list items（bulleted points）として記述されます。<br/>
（大きくContext Steps、Tear Down Steps、Scenarioやconcepts内のStepsに分けられますが、今回はそこらへんの説明は割愛します）。</p>

<h4>Tags</h4>

<p>TagはspecやScenarioを関連付けするために使用します。タグを用いてspecやScenarioをフィルタリングすることができ、後々便利になります。</p>

<h1>Gaugeのインストール</h1>

<p>下記ページからダウンロードできます。インストール方法も簡単で、下記ページに書いてある通りに進めていけば5分もかからずにGauge自体はインストールできます。<br/>
<a href="https://getgauge.io/get-started.html">https://getgauge.io/get-started.html</a></p>

<h1>サンプルコードを見てみる</h1>

<p>下記ページから自分の好みの言語のSampleコードのGithubリンクへ飛ぶことができます。<br/>
<a href="https://docs.getgauge.io/examples.html">https://docs.getgauge.io/examples.html</a></p>

<p>私はWeb app using SeleniumのJavaのSampleコードを選択しました。<br/>
<a href="https://github.com/getgauge/gauge-example-java">https://github.com/getgauge/gauge-example-java</a></p>

<p>下記がSpecificationのファイルになります。<br/>
上記で説明した用語はこんな形で使われます。</p>

<p>user.spec（自然言語でテストケースを記述していくファイル）</p>

<pre class="code" data-lang="" data-unlink>Signup   //Specification
======

Register a customer  //Scenario
-------------------
tags: user, signup, high, final, smoke  //Tags

* Sign up a new customer                  //Step1
* On the customer page                    //Step2
* Just registered customer is listed      //Step3
</pre>


<p>上記のSpecファイルはIDEでタブ切り替えでHTML Previewを閲覧できます。Specファイルがそのまま仕様書として使えます。
（自分の場合はIntelliJを使いました。IDE側でプラグインをインストールしてやる必要があります）　　
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kudogen/20170718/20170718122930.png" alt="f:id:kudogen:20170718122930p:plain" title="f:id:kudogen:20170718122930p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>下記がSeleniumのテストコードになります。
各Stepに対してのテストコードが@Stepという形で実装されているのが分かります。<br/>
UserSpec.java</p>

<pre class="code lang-java" data-lang="java" data-unlink><span class="synType">public</span> <span class="synType">class</span> UserSpec {
    <span class="synType">private</span> <span class="synType">final</span> WebDriver driver;

    <span class="synType">public</span> UserSpec() {
        <span class="synType">this</span>.driver = DriverFactory.getDriver();
    }

    <span class="synType">public</span> String localPart() {
        <span class="synComment">// Creating a random local part of an email address also used as username</span>
        <span class="synStatement">return</span> UUID.randomUUID().toString();
    }

    <span class="synPreProc">@Step</span>(<span class="synConstant">&quot;On signup page&quot;</span>)    <span class="synComment">//Stepsの実装部分</span>
    <span class="synType">public</span> <span class="synType">void</span> navigateToSignUpPage() {
        driver.get(SignUpPage.SignUpUrl);
    }
</pre>


<h1>レポート機能</h1>

<p>プラグインをインストールしてやるだけで、テスト流す度にHTMLのテストレポートを吐き出してくれます（下記画像参照）<br/>
実行したテストをSpecificationやTagで検索できて、Spec毎、Scenario毎、Step毎にどれくらい実行時間がかかったかも簡単にわかります。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kudogen/20170718/20170718123453.png" alt="f:id:kudogen:20170718123453p:plain" title="f:id:kudogen:20170718123453p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h1>今回カバーしていない機能</h1>

<p>これまでに紹介したのはあくまでも超基本的なTerminologyです。
他にも下記のようなものがあるのですが、今回は触れられていません。</p>

<ul>
<li>Concepts</li>
<li>Parameters</li>
<li>Stepの種類（Contexts, Tear Down Steps）</li>
</ul>


<p>またかなり役立ちそうな下記機能もありますが、今回はカバーしていません。</p>

<ul>
<li>Data driven execution</li>
<li>Parallel Execution</li>
</ul>


<h1>まとめ</h1>

<p>弊社ではテストケース＝仕様書という考え方から、ほぼすべてのプロジェクトでUATを書いています。<br/>
元々上記のような取り組みをしていたのですが、もっといいやり方がないか探していたところに見つけたのがGaugeでした。<br/>
Gaugeは実行可能なドキュメントという概念("the concept of executable documentation")をサポートしています。<br/>
また自動テストのケースを誰でも読めるようにするという考え方も弊社の開発チームが今まで取り組んできていたことですが、Gaugeを使えばよりスマートに実現できそうです。<br/>
今後は様々なプロジェクトでGaugeを導入していこうと考えています。</p>

<p>次回は今回カバーできなかったGaugeのAdvancedな機能を中心に取り上げたブログ記事を執筆予定です。</p>

<hr />

<p>株式会社ユーザベースでは、より良い開発プロセスを共に作り上げていきたいエンジニアを<a href="https://www.uzabase.com/recruit/occupation/">大募集中</a>です！</p>
</description>          <pubDate>Tue, 26 Sep 2017 19:10:09 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812280671827</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kudogen/20170718/20170718122930.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>TCP Fast Open</title>
          <link>http://tech.uzabase.com/entry/2017/09/20/174010</link>          <description><p>はじめまして。プロダクト開発チームの<a href="https://github.com/ryoqun">小野寺 (ryoqun)</a>です。</p>

<p>今回は最近少しずつ浸透し始めてきた「<a href="https://en.wikipedia.org/wiki/TCP_Fast_Open">TCP Fast Open</a>(以下、Fast Open)」という最新技術についてTCP/IPのおさらいを踏まえながら紹介したいと思います。ちなみに、この技術はTCPを高速化するもので、Google、Facebook、Appleなどでも本番投入され初めているものの、まだ国内では浸透していなくだいぶ先取りな紹介となります。</p>

<p>Fast Openという技術は比較的枯れたTCPに対してプロトコルレベルで変更を加える比較的インパクトが大きいと勝手に思っている技術です。
最近は低レイヤーの技術はアプリケーション・サービス開発エンジニアだとあまり意識しないとは思いますが、基礎は大事なので
最新動向を掴むと共に、TCP/IPの良い復習ということで少しの間ですがお付き合い下さい。</p>

<h2>Fast Openとは？</h2>

<p>一言でいうとTCPのレイテンシーを改善する新しい拡張技術です。具体的には接続確立時(= Open)のレイテンシーを軽減(= Fast)します(よってFast Openという名前の由来となっています)。正確には、TCPの<a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Connection_establishment">Three-way handshake</a>を省略することで1 <a href="https://en.wikipedia.org/wiki/Round-trip-time">RTT</a>分のレイテンシーを削減できます。</p>

<p>Three-way handshakeを明示的に省略する必要性から、クライアント側とサーバー側の両方がFast Openに対応して初めて有効になります。</p>

<p>注意点としては、僅かに接続確立時の信頼性が犠牲となることです。これについては後述します。また、各ホストへの初回接続時には使えません。理由は、セキュリティのため認証情報(Cookie)が必要になるためです。これはTCPの<a href="https://en.wikipedia.org/wiki/SYN_flood">SYN flooding</a>攻撃に似た危険性を軽減する対策余地をプロトコル上に残すためです。</p>

<h2>Three-way handshakeとFast Open</h2>

<p>本来ならばTCPだとThree-way handshakeが必要になります。つまりは接続確立時に実際の通信ができるまでに、まずクライアント側からSYNフラグが立ったペイロードが無い小さいパケットを送り、サーバー側からSYN+ACKフラグが立ったペイロードが無い小さいパケットを受け取らなければなりません。これがまさしく1 RTT分のレイテンシーに相当するわけです。</p>

<p>他方でFast Openが有効な場合、接続確立時にいきなりSYNフラグを立てた上で、ペイロードを乗せることができます。例えば、HTTPリクエストが<a href="https://en.wikipedia.org/wiki/Maximum_segment_size">TCPのMSS</a>以下の場合は、0 RTTで<a href="https://nginx.org/">nginx</a>などのHTTPサーバーはリクエストの内容をアプリケーションプロセスに渡すことが実現可能です。ただ、現在だとHTTPというよりかはHTTPS(=TLS)が主流です。その場合はTLS handshakeを即座に開始できるというわけです。なお、Fast Openと<a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_1.3_.28draft.29">TLS 1.3</a>を組み合わせるとTLSを含めて0-RTTを実現できるようになるようです。</p>

<h2>デモ</h2>

<p>百聞は一見にしかずということで、まずは実際の動きを見てみましょう。</p>

<p>Fast Openが有効になっているサイトから、Fast Openが有効になっているブラウザで<a href="https://upload.wikimedia.org/wikipedia/commons/0/0a/A4_lands_on_melbourne.jpg">ファイル</a>を<a href="https://www.chromium.org/">Chromium</a>でダウンロードしてみました。その時の<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/reference#timing">ChromiumのDeveloper toolsのNetworkのtiming</a>と<a href="https://www.wireshark.org/">Wireshark</a>で状態を確認してみました。ちなみにテストに使ったサービスはWikimediaですが、Fast Openが有効なサービスにはGoogleなどもありますが、日本国内からのアクセス時にレイテンシーが発生しFast Openの効果がわかりやすくなるようにWikimediaを選んでいます。</p>

<h3>ChromiumのDeveloper tools</h3>

<p>Fast Openが無効と有効になっている時の違いを比べてみました。</p>

<p>無効時:</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170803/20170803105742.png" alt="f:id:ryoqun:20170803105742p:plain" title="f:id:ryoqun:20170803105742p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>有効時:</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170803/20170803105730.png" alt="f:id:ryoqun:20170803105730p:plain" title="f:id:ryoqun:20170803105730p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>赤の矢印(<span style="color: #ff0000">↑</span>)のところに着目するとわかるように、Initial connection(= TCPのThree-way handshakeのこと)がFast Open有効時は必要なくなっていて、SSLのhandshakeが前倒しになって開始されているのがよくわかります。ただ、SSLのhandshakeにかかった時間や実際のデータの転送にかかった時間はそれほど変わっていません。結果としては、Initial connection分の時間(レイテンシー)だけが綺麗に全体のレスポンス時間から減っています。</p>

<h3>Wireshark</h3>

<p>Fast Openが無効と有効になっている時の違いを比べてみました。</p>

<p>無効時:</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170803/20170803111734.png" alt="f:id:ryoqun:20170803111734p:plain" title="f:id:ryoqun:20170803111734p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>有効時:</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170803/20170803111746.png" alt="f:id:ryoqun:20170803111746p:plain" title="f:id:ryoqun:20170803111746p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>赤枠(<span style="color: #ff0000">□</span>)のところに着目するとわかるように、Fast Open無効時は、TCPのThree-way handshakeをちゃんとやっています。しかしFast Open有効時は、Three-way handshakeをスキップしていきなりペイロード(Client Hello; TLS handshakeの最初のパケット)があるパケットを送っているのがわかります。結果、パケットのLengthが大きくなっています。なお、このスクリーンショットからはわからないのですが、この最初のパケットにはSYNフラッグがきちんと立っています。その後のやり取りの流れは無効時と変わりありません。</p>

<h2>長所と短所</h2>

<ul>
<li>○ 接続確立時のRTTが減る！！！！(これは前述の通りですね)</li>
<li>△ 接続確立後のデータ通信のレイテンシーは向上しない(Fast Openは接続確立時だけの話です)</li>
<li>✕ アプリケーション層での冪等性が必要(これについては後述します)</li>
</ul>


<h2>短所： アプリケーション層での冪等性が必要</h2>

<p>これが、この記事の冒頭で書いたFast Openを有効にすることによって犠牲にされた信頼性となります。しかしながら、この懸念を考慮する必要はインターネットから到達可能なWebサービスにおいてはほとんどありません。より正確にいうと、そのような前提の場合はブラウザの多重Submit問題と同じ問題であり、ネットワーク起因やユーザー操作起因の違いはあれど、Fast Open抜きにしても必ず考慮する必要があるからです。しかし、TLSを使っていなかったり、あるいは、イントラネット内で完結するWebサービス、またはTCP本来の高信頼性を要求する通信にてFast Openを有効にする場合には懸念となります。</p>

<p>そのFast Openを有効にした際の信頼性の問題というのは、1つのTCP上のアプリケーションリクエストがIP通信網の品質の問題により、2つになりえるという理論的な問題となります。そのためアプリケーション層において、リクエストが2つになっても問題無いという冪等性が必要になります。</p>

<p>その問題の原因を説明する前にまずは、前提となる背景を説明します。TCPの役割というのは、信頼性が担保されないIP通信上に、信頼できる双方向通信路を実現するためのプロトコルです。Three-way handshakeはその信頼性の担保のために接続確立時に必要となります。当時のTCPの設計に問題があったわけでもなく、現時点に至るまでの技術的発展があったわけでもなく、昔も今も、レイテンシーと信頼性のトレードオフの結果、本来のTCPは信頼性を重視するためにはThree-way handshakeを必要としています。反面、IP通信は、設計思想として、耐障害性、冗長性を重視し、ごく稀なパケットロスやパケット重複は許容しています。</p>

<p>というわけで、Fast Openを有効にした上で、Three-way handshakeが省かれ、パケット重複が万が一発生した場合、サーバーにとってはあたかもTCP接続確立が2つ来たかのように見えるので、2回リクエスト処理をしてしまうということになるわけです。</p>

<h2>普及状況</h2>

<p>繰り返しになりますが、Fast Openはクライアント側とサーバー側がどちらも対応して初めて使えるようになります。具体的にいうと、TCP/IPスタックは多くの場合、OSが実装しているので、OSがFast Openを実装し、それが有効になっている事と、ミドルウェアやアプリケーションが対応している事が必要になります。</p>

<p>クライアント側とサーバー側に分けて、2017年9月時点での普及状況について説明します。</p>

<h3>サーバー</h3>

<p>Google, Wikipedia, CloudFront, Facebookで有効になっているようです。Fast Openはどちらかというと一般的なWebサービスでは効果が出にくく、CDNや広告配信等の1ショットのHTTPリクエストのトラフィックが大量に発生する場合に効果的です。日本サイトは筆者が簡単に確認する範囲では見つけられませんでした。</p>

<h3>クライアント</h3>

<p>Webブラウザはそれぞれ対応が始まっています。筆者は<a href="https://www.ubuntu.com/">Ubuntu 16.04/LTS</a>の<a href="https://packages.ubuntu.com/xenial/chromium-browser">Chromium</a>で動作確認をしています。
OS的にも、iOS、Android、Windowsでそれぞれ動きがあるようです。</p>

<h3>ツール/ミドルウェア</h3>

<p>ちらほらとサポートが始まっています。網羅的に調べたわけではありませんが、<a href="http://netty.io/news/2015/09/30/4-0-32-Final.html">netty</a>、<a href="https://bugs.ruby-lang.org/projects/ruby-trunk/repository/revisions/42865">Ruby</a>、<a href="https://daniel.haxx.se/blog/2016/04/29/curl-7-49-0-goodies-coming/">curl</a>などで対応情報を見つけることができます。</p>

<h2>他の技術との関連</h2>

<p>最後に、Fast Openがそれぞれ他の技術とどのような関連を持つのかを見てみて、Fast Openの理解を多角的に深めていきたいと思います。</p>

<h3><a href="https://en.wikipedia.org/wiki/Network_address_translation">NAT</a></h3>

<p>NATの実装によっては、Fast Openとの相性が良くない場合があります。これは当然で、NATはその原理上TCP接続の状態遷移をトラッキングしなければならないのですが、NATの実装が厳しすぎると、Fast OpenによってThree-way handshakeが省かれれば十分に正しくトラッキングできなくなる場合はあります。</p>

<h3><a href="https://en.wikipedia.org/wiki/HTTP_persistent_connection">HTTP keep-alive</a></h3>

<p>HTTP通信におけるTCPの接続確立時のレイテンシーを軽減するという目的の上では、Fast OpenもHTTP keep-aliveも同じ立ち位置です。HTTP keep-aliveによってだいぶレイテンシーは改善されます。なので通常のブラウジングでは、keep-aliveに比べてFast Openというのはそれほど如実に効果があるわけではありません。ただ、Fast Openの策定背景としては、<a href="https://tools.ietf.org/html/rfc7413#section-6.3.3">HTTP keep-aliveはモバイル回線網にてあまり機能していない</a>という指摘もあります。</p>

<h3>スマートフォン向けのHTTP APIのエンドポイント</h3>

<p>アプリがkeep-aliveしていないならば効果はあります。ただし、まずはkeep-aliveを対応したほうがいいのは言うまでもありません。</p>

<h3><a href="https://en.wikipedia.org/wiki/Last_mile">ラストワンマイル回線網(FTTHと4G)</a></h3>

<p>宅地のラストワンマイル回線網というと今で言えば日本国内で言えば、FTTHが圧倒的なシェアになっています。FTTHで通信ホストが国内の場合はそもそものレイテンシーは数msなのでFast Openの効果はほとんどありません。ADSLならば多少は効果はあります。しかし、ラストワンマイルが何にしろ、海外ホストへのアクセスの場合には効果が望めます。</p>

<p>モバイルのラストワンマイル回線網というと今で言えば4G回線が全盛となっています。こちらの場合は国内ホスト、海外ホストに限らず一定のレイテンシー向上が望めます。</p>

<h3><a href="https://en.wikipedia.org/wiki/HTTP_cookie#Other_uses">Supercookie</a></h3>

<p>Fast Openの際に使われるCookieの転用例としては、Supercookieが挙げられます。セキュリティ上、DOS攻撃対策としてCookieが必要なわけですが、別のセキュリティ観点では、匿名性が犠牲となっています。特に<a href="https://en.wikipedia.org/wiki/HTTP_ETag#Tracking_using_ETags">E-tag</a>、<a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security#Privacy_issues">HSTS</a>同様、passiveでドメインをまたいだ(=クロスドメイン)トラッキングが実現できてしまいます。今回新たにFast Openがトラッキング手段として加わったわけですが、他の既存の代替手段も存在するのも含め、残念ながらトラッキングを現在において完全に抑制することは非常に困難となっています。</p>

<h3><a href="https://en.wikipedia.org/wiki/HTTP/2">HTTP/2</a></h3>

<p>HTTP/2になってもTCPベースなので引き続きFast Openは意味があります。しかし<a href="https://en.wikipedia.org/wiki/QUIC">QUIC</a>に対してはこちらはUDPベースなので関係なくなります。</p>

<h2>参考情報</h2>

<ul>
<li><a href="https://tools.ietf.org/html/rfc7413">仕様(比較的手頃な文量でまとまっていて読みやすい)</a></li>
<li><a href="http://devstreaming.apple.com/videos/wwdc/2015/719ui2k57m/719/719_your_app_and_next_generation_networks.pdf">WWDC 15での言及(冪等性についてわかりやすい図があります)</a></li>
<li><a href="https://insouciant.org/tech/some-quick-thoughts-on-tcp-fast-open-and-chromium/">Chromiumの開発者の考察</a></li>
<li><a href="https://blogs.windows.com/msedgedev/2016/06/15/building-a-faster-and-more-secure-web-with-tcp-fast-open-tls-false-start-and-tls-1-3/">Microsoftの0-RTT TLSと絡めながらの言及</a></li>
</ul>


<h2>まとめ</h2>

<ul>
<li>レイテンシーが速くなります。</li>
<li><a href="https://tools.ietf.org/html/rfc675#section-4.3.2">半世紀近く変わらなかったTCP(のThree-way handshake)</a>が地味に変わるかもしれません。</li>
</ul>


<hr />

<p>株式会社ユーザベースでは、ローレベル含め技術が大好きなエンジニアを<a href="https://www.uzabase.com/recruit/occupation/">大募集中</a>です！</p>
</description>          <pubDate>Wed, 20 Sep 2017 17:40:10 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812285136297</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoqun/20170803/20170803105742.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>マルチホストでのDocker Container間通信 第3回: Kubernetesのネットワーク(CNI, kube-proxy, kube-dns)</title>
          <link>http://tech.uzabase.com/entry/2017/09/12/164756</link>          <description><p>こんにちは。SPEEDA開発チームの鈴木です。</p>

<p>これまでマルチホストでのContainer間通信について、</p>

<ul>
<li>Dockerのネットワークの基礎(<a href="http://tech.uzabase.com/entry/2017/08/07/172411">前々回</a>)</li>
<li>マルチホストでのContainer間通信を実現する手段の一つとしてのOverlayNetwork(<a href="http://tech.uzabase.com/entry/2017/08/23/175813">前回</a>)</li>
</ul>


<p>といった話をしてきましたが、3回目となる今回はこれまでの内容を踏まえた上でKubernetesのネットワークについてお話します。内容としては大きく次の2つになります。</p>

<ol>
<li><strong>どうやってマルチホストでのContainer間通信を実現しているか</strong></li>
<li><strong>Service名でPodと通信できるようするための仕組み</strong></li>
</ol>


<p>では早速1つ目の話をはじめましょう。Kubernetesを利用する場合、基本的には複数のノード上にKubernetesクラスタを構築することになります。
（<a href="https://github.com/kubernetes/minikube">minikube</a>を使って単一ノードからなるKubernetesクラスタを構築するような例外はあります）<br/>
つまり何らかの方法でホストをまたいでContainer間通信を行うわけですが、そのための方法は3つあります。</p>

<h1>マルチホストでContainer間通信を行う3つの方法</h1>

<ol>
<li><strong>自前でOverlayNetworkを構築し、それをKubernetesと連携させる</strong></li>
<li><strong>CNI(Container Networking Interface)を使う</strong></li>
<li><strong>kubenetを使う</strong></li>
</ol>


<p>それではこれから上記3つについて少し詳しく説明していきます。</p>

<h1>1.自前でOverlayNetworkを構築してKubernetesと連携させる</h1>

<p><a href="http://tech.uzabase.com/entry/2017/08/23/175813">前回</a>説明した <a href="https://github.com/coreos/flannel">flannel</a> のようなツールを用いてOverlayNetworkを構築する方法です。<br/>
私が2016年にCoreOSクラスタ上でKubernetesクラスタをマニュアルで構築したとき、CoreOSの公式ドキュメントに記載されていた方法がこれです(CoreOSがContainer Linuxに改名される前の話です)。<br/>
ちなみにCoreOSの場合はflannelを用います(flannelはCoreOS社が開発しています)。<br/>
この場合、CoreOSのcloud-configにflannelの設定とflannelに合わせたDockerの設定が必要になります。<br/>
当然すべてのノードに対して設定が必要になるのでなかなか面倒です。</p>

<h1>2.CNI(Container Network Interface)を使う</h1>

<p><a href="https://github.com/containernetworking/cni">CNI</a>は、<a href="https://www.cncf.io/">Cloud Native Computing Foundation</a>※のプロジェクトで、<br/>
Container内のNetwork Interfaceを構成するためのプラグインを開発するための仕様とライブラリなどから構成されています。<br/>
ネットワーク層をプラガブルにしたいという考えは、多くのContainer RuntimeとOrchestration Toolが共通して持っている考えのため、重複を避けるために定義されました。</p>

<p>※Cloud Native Computing Foundationは、Kubernetesの開発主体です。
DockerやCoreOS、Red Hat、Google、IBM、Mesosphere、シスコ、インテルなどが主導して2015年7月に発足しました。</p>

<p>KubernetesはこのCNIプラグインを利用することができます。
ちなみにDocker自体もCNIとは別に<a href="http://docs.docker.jp/engine/extend/plugins_network.html">ネットワークプラグイン</a>を利用できる仕組みを持っています。</p>

<h3>CNIを利用できるContainer Runtime</h3>

<p>公式ページによると現在(2017年9月)CNIを利用できるContainer Runtimeは以下のようなものがあるようです。<br/>
Kubernetesだけではなく、MesosなんかもCNIを利用できるみたいですね。</p>

<hr />

<ul>
<li><a href="https://coreos.com/blog/rkt-cni-networking.html">rkt</a></li>
<li><a href="http://kurma.io/">Kurma</a></li>
<li><a href="http://kubernetes.io/docs/admin/network-plugins/">Kubernetes</a></li>
<li><a href="https://github.com/openshift/origin/blob/master/docs/openshift_networking_requirements.md">OpenShift</a></li>
<li><a href="https://github.com/cloudfoundry-incubator/cf-networking-release">Cloud Foundry</a></li>
<li><a href="https://github.com/apache/mesos/blob/master/docs/cni.md">Mesos</a></li>
</ul>


<hr />

<h3>3rd Party Plugins</h3>

<p>以下はCNIの仕様に則って作成されたCNIプラグインです(2017年9月現在)。<br/>
注意点として、上述したようにCNIはKubernetesのためだけのインタフェースではないので、Kubernetes用ではないプラグインもあることを挙げておきます。</p>

<hr />

<ul>
<li><a href="https://github.com/projectcalico/cni-plugin">Project Calico</a> - L3の仮想ネットワーク</li>
<li><a href="https://github.com/weaveworks/weave">Weave</a> - 仮想ネットワーク</li>
<li><a href="https://github.com/contiv/netplugin">Contiv Networking</a> - 仮想ネットワーク + 柔軟なネットワークポリシー制御を提供</li>
<li><a href="https://github.com/hustcat/sriov-cni">SR-IOV</a></li>
<li><a href="https://github.com/cilium/cilium">Cilium</a> - Container用 BPF &amp; XDP</li>
<li><a href="https://github.com/infobloxopen/cni-infoblox">Infoblox</a> - ContainerのIPアドレスを管理するサービス(IPAM)</li>
<li><a href="https://github.com/Intel-Corp/multus-cni">Multus</a> - Kubernetesのマルチプラグインとして動作。複数のプラグインのグループ化(他のプラグインをdelegateして呼び出すらしい)。</li>
<li><a href="https://github.com/romana/kube">Romana</a> - KubernetesのためのL3の仮想ネットワーク + ネットワークポリシー制御</li>
<li><a href="https://github.com/Huawei-PaaS/CNI-Genie">CNI-Genie</a> - Kubernetesのマルチプラグインとして動作。一つのContainerに複数のネットワークインタフェースを割り当て、インタフェースごとにCNIプラグインを割り当てられる。例えばeth0はCalico、eth1はFlannel、eth2はWeaveなど。つまりContainerが複数のネットワークにまたがることができる。</li>
<li><a href="https://github.com/nuagenetworks/nuage-cni">Nuage CNI</a> - Kubernetesのための仮想ネットワーク + ネットワークポリシー制御</li>
<li><a href="https://github.com/cloudfoundry-incubator/silk">Silk</a> - Cloud Foundryのためのプラグイン。flannelに触発されたらしい。</li>
<li><a href="https://github.com/John-Lin/linen-cni">Linen</a> - Open vSwitchでOverlayNetworkを構築するプラグイン</li>
</ul>


<hr />

<p>これらを見ると、CalicoやWeaveといった単体でContainerの仮想ネットワークを構築できるツールがCNIプラグインとしても提供されていることがわかります。<br/>
プラグインの要件を満たすように既存の機能をうまく使っているのでしょうね。<br/>
余談ですが、flannelもそうですが、Calico, Weave, Silk, Linenというように「生地」に関連した名前のものが多いですね。</p>

<p>Kubernetesから利用するのは当然Calico, Weave, Contivといった仮想ネットワークのためのCNIプラグインになります。</p>

<h3>CNIプラグインの動作</h3>

<p>続いてCNIプラグインはどう動作するのか、具体的にどんなものなのかをご理解いただくために、少々ソースコードを読みながら解説します。</p>

<h4>CNIプラグインのソースコード</h4>

<p>CNIプロジェクトは、CNIプラグインを簡単に開発できるようにスケルトンを用意しています。<br/>
プラグインの動作は、このスケルトンと実際にスケルトンを使って作られたプラグインの両方を見ると理解できると思います。<br/>
では順番に見ていきましょう。まずスケルトンからです。軽く眺めて次にいきましょう。<br/>
(注：抜粋です。コードすべてではありません。またあくまでこれは今現在のバージョンのコードです。)</p>

<p><a href="https://github.com/containernetworking/cni/blob/HEAD/pkg/skel/skel.go">cni/pkg/skel/skel.go</a></p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">type</span> CmdArgs <span class="synStatement">struct</span> {
    ContainerID <span class="synType">string</span>
    Netns       <span class="synType">string</span>
    IfName      <span class="synType">string</span>
    Args        <span class="synType">string</span>
    Path        <span class="synType">string</span>
    StdinData   []<span class="synType">byte</span>
}

<span class="synStatement">type</span> dispatcher <span class="synStatement">struct</span> {
    Getenv <span class="synType">func</span>(<span class="synType">string</span>) <span class="synType">string</span>
    Stdin  <span class="synType">io.Reader</span>
    Stdout <span class="synType">io.Writer</span>
    Stderr <span class="synType">io.Writer</span>

    ConfVersionDecoder version.ConfigDecoder
    VersionReconciler  version.Reconciler
}

<span class="synStatement">func</span> PluginMain(cmdAdd, cmdDel <span class="synType">func</span>(_ *CmdArgs) <span class="synType">error</span>,<span class="synError"> </span>
  versionInfo version.PluginInfo) {
    <span class="synStatement">if</span> e := PluginMainWithError(cmdAdd, cmdDel, versionInfo); e != <span class="synStatement">nil</span> {
        <span class="synStatement">if</span> err := e.Print(); err != <span class="synStatement">nil</span> {
            log.Print(<span class="synConstant">&quot;Error writing error JSON to stdout: &quot;</span>, err)
        }
        os.Exit(<span class="synConstant">1</span>)
    }
}

<span class="synStatement">func</span> PluginMainWithError(cmdAdd, cmdDel <span class="synType">func</span>(_ *CmdArgs) <span class="synType">error</span>,<span class="synError"> </span>
  versionInfo version.PluginInfo) *types.Error {
    <span class="synStatement">return</span> (&amp;dispatcher{
        Getenv: os.Getenv,
        Stdin:  os.Stdin,
        Stdout: os.Stdout,
        Stderr: os.Stderr,
    }).pluginMain(cmdAdd, cmdDel, versionInfo)
}

<span class="synStatement">func</span> (t *dispatcher) pluginMain(cmdAdd, cmdDel <span class="synType">func</span>(_ *CmdArgs) <span class="synType">error</span>,<span class="synError"> </span>
  versionInfo version.PluginInfo) *types.Error {
    cmd, cmdArgs, err := t.getCmdArgsFromEnv()
    <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
        <span class="synStatement">return</span> createTypedError(err.Error())
    }

    <span class="synStatement">switch</span> cmd {
    <span class="synStatement">case</span> <span class="synConstant">&quot;ADD&quot;</span>:
        err = t.checkVersionAndCall(cmdArgs, versionInfo, cmdAdd)
    <span class="synStatement">case</span> <span class="synConstant">&quot;DEL&quot;</span>:
        err = t.checkVersionAndCall(cmdArgs, versionInfo, cmdDel)
    <span class="synStatement">case</span> <span class="synConstant">&quot;VERSION&quot;</span>:
        err = versionInfo.Encode(t.Stdout)
    <span class="synStatement">default</span>:
        <span class="synStatement">return</span> createTypedError(<span class="synConstant">&quot;unknown CNI_COMMAND: %v&quot;</span>, cmd)
    }

    <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
        <span class="synStatement">if</span> e, ok := err.(*types.Error); ok {
            <span class="synComment">// don't wrap Error in Error</span>
            <span class="synStatement">return</span> e
        }
        <span class="synStatement">return</span> createTypedError(err.Error())
    }
    <span class="synStatement">return</span> <span class="synStatement">nil</span>
}
</pre>


<p>はい、続いてはスケルトンを利用した実際のプラグインです。<br/>
これはCNIプロジェクトがサンプルとして用意している単純なプラグインです。</p>

<p><a href="https://github.com/containernetworking/plugins/blob/master/plugins/main/loopback/loopback.go">plugins/plugins/main/loopback/loopback.go</a></p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">func</span> main() {
    skel.PluginMain(cmdAdd, cmdDel, version.All)
}

<span class="synStatement">func</span> cmdAdd(args *skel.CmdArgs) <span class="synType">error</span> {
    args.IfName = <span class="synConstant">&quot;lo&quot;</span> <span class="synComment">// ignore config, this only works for loopback</span>
    err := ns.WithNetNSPath(args.Netns, <span class="synType">func</span>(_ ns.NetNS) <span class="synType">error</span> {
        link, err := netlink.LinkByName(args.IfName)
        <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
            <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
        }

        err = netlink.LinkSetUp(link)
        <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
            <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
        }

        <span class="synStatement">return</span> <span class="synStatement">nil</span>
    })
    <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
        <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
    }

    result := current.Result{}
    <span class="synStatement">return</span> result.Print()
}

<span class="synStatement">func</span> cmdDel(args *skel.CmdArgs) <span class="synType">error</span> {
    args.IfName = <span class="synConstant">&quot;lo&quot;</span> <span class="synComment">// ignore config, this only works for loopback</span>
    err := ns.WithNetNSPath(args.Netns, <span class="synType">func</span>(ns.NetNS) <span class="synType">error</span> {
        link, err := netlink.LinkByName(args.IfName)
        <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
            <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
        }

        err = netlink.LinkSetDown(link)
        <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
            <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
        }

        <span class="synStatement">return</span> <span class="synStatement">nil</span>
    })
    <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
        <span class="synStatement">return</span> err <span class="synComment">// not tested</span>
    }

    <span class="synStatement">return</span> <span class="synStatement">nil</span>
}
</pre>


<h4>CNIプラグインのソースコード解説</h4>

<p>それではいよいよ解説に入ります。このサンプルのmain関数を見てください。CmdArgsを引数にとる関数2つを、スケルトンのPluginMain関数に渡しています。</p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">func</span> main() {
    skel.PluginMain(cmdAdd, cmdDel, version.All)
}
</pre>


<p>この<code>cmdAdd</code>と<code>cmdDel</code>はContainerが追加・削除されたタイミングで(CNIプラグインを利用するプログラム)から呼び出される関数です。<br/>
引数の<code>CmdArgs</code>は、スケルトンを見ると次のようになっています。</p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">type</span> CmdArgs <span class="synStatement">struct</span> {
    ContainerID <span class="synType">string</span> <span class="synComment">// ContainerのID</span>
    Netns       <span class="synType">string</span> <span class="synComment">// ネットワーク名前空間名</span>
    IfName      <span class="synType">string</span> <span class="synComment">// インタフェース名</span>
    Args        <span class="synType">string</span> <span class="synComment">// プラグイン実行時の引数</span>
    Path        <span class="synType">string</span> <span class="synComment">// CNIプラグインを検索するパスのリスト(パスは:で区切る)</span>
    StdinData   []<span class="synType">byte</span> <span class="synComment">// 標準入力の値</span>
}
</pre>


<p>つまり、プラグインはContainerの追加・削除を契機として、上記構造体の情報を元に任意の処理を行います。<br/>
ちなみにこのサンプルはContainerの追加時にループバックインタフェースをContainerのネットワーク名前空間内に作成し、Containerの削除時にループバックインタフェースをネットワーク名前空間から削除しています。</p>

<p><strong> <code>CmdArgs</code>について補足 </strong><br/>
main関数では<code>cmdAdd</code>,<code>cmdDel</code>の両方を渡しているが、addとdelのどちらを使うかどう決定されるのでしょう。
これはスケルトンのコードを見ればわかるのですが、<code>CNI_COMMAND</code>という環境変数の値により決定されます。<br/>
値が<code>ADD</code>の場合<code>cmdAdd</code>が呼び出され、値が<code>DEL</code>の場合<code>cmdDel</code>が呼び出されます。<br/>
また<code>cmdAdd</code>,<code>cmdDel</code>に渡ってくる`CmdArgsの値はどのようにセットされているのでしょうか。<br/>
これも環境変数が使われていて、単純に以下の環境変数の値が構造体の対応する変数にセットされています。</p>

<table>
<thead>
<tr>
<th style="text-align:left;">環境変数</th>
<th style="text-align:left;">CmdArgsの変数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">CNI_CONTAINERID</td>
<td style="text-align:left;">ContainerID</td>
</tr>
<tr>
<td style="text-align:left;">CNI_NETNS</td>
<td style="text-align:left;">Netns</td>
</tr>
<tr>
<td style="text-align:left;">CNI_IFNAME</td>
<td style="text-align:left;">IfName</td>
</tr>
<tr>
<td style="text-align:left;">CNI_ARGS</td>
<td style="text-align:left;">Args</td>
</tr>
<tr>
<td style="text-align:left;">CNI_PATH</td>
<td style="text-align:left;">Path</td>
</tr>
</tbody>
</table>


<p>つまりCNIプラグインの処理を呼び出すプログラムは、予めこれらの環境変数をセットしておく必要があります。</p>

<p>ここまで簡単にコードを見てきましたが、どうでしょう。結構シンプルな仕組みではないでしょうか。</p>

<h3>KubernetesでCNIを使うには</h3>

<p>KubernetesでCNIを使う場合は、<a href="https://kubernetes.io/docs/concepts/cluster-administration/network-plugins/#cni">公式ドキュメント</a>に書いてありますが、<br/>
<code>kubelet</code> の引数に <code>--network-plugin=cni</code> の指定と、<br/>
CNIの設定を配置するディレクトリ<code>--cni-conf-dir</code>(defaultは <code>/etc/cni/net.d</code>)の指定が必要になります。<br/>
またCNIプラグイン自体は<code>--cni-bin-dir</code>（defaultは<code>/opt/cni/bin</code>）に存在する必要があります。</p>

<p>例えばCNIプラグインとして、Weaveを使用する場合、このような感じになります。</p>

<pre class="code lang-json" data-lang="json" data-unlink>$ <span class="synError">view</span> /<span class="synError">etc</span>/<span class="synError">cni</span>/<span class="synError">net</span>.<span class="synError">d</span>/10-<span class="synError">weave</span>.<span class="synError">conf</span>
<span class="synSpecial">{</span>
    &quot;<span class="synStatement">name</span>&quot;: &quot;<span class="synConstant">weave</span>&quot;,
    &quot;<span class="synStatement">type</span>&quot;: &quot;<span class="synConstant">weave-net</span>&quot;,
    &quot;<span class="synStatement">hairpinMode</span>&quot;: <span class="synConstant">true</span>
<span class="synSpecial">}</span>
</pre>




<pre class="code" data-lang="" data-unlink>$ ls -lat /opt/cni/bin/weave*
lrwxrwxrwx 1 root root       18 Aug 10 14:51 weave-ipam -&gt; weave-plugin-1.9.7*
lrwxrwxrwx 1 root root       18 Aug 10 14:51 weave-net -&gt; weave-plugin-1.9.7*
-rwxr-xr-x 1 root root  9446280 Jun  7 02:37 weave-plugin-1.9.7*</pre>


<h3>CNIの仕様について更に詳しく</h3>

<p>CNIの仕様について更に詳しく知りたい場合は、公式の<a href="https://github.com/containernetworking/cni/blob/master/SPEC.md#example-configurations">こちら</a>をご覧ください。<br/>
CNIの設定ファイルについての説明なども書いてあります。</p>

<h1>3.kubenetを使う</h1>

<p>これはGKEでKubernetesクラスタを構築した場合に利用されている方法です。<br/>
kubenetが使用されていることは、GKEのクラスタに接続して <code>ps ax | grep kubelet</code>などとして<code>kubelet</code>コマンドの引数を見ることで分かります。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink>$ ps ax | <span class="synStatement">grep</span> kubelet
 <span class="synConstant">3461</span> ?        Sl   <span class="synConstant">1218</span>:<span class="synConstant">07</span> /usr/<span class="synStatement">local</span>/bin/kubelet
 <span class="synSpecial">--api-servers=https://xx.xxx.xxx.xxx</span>
 <span class="synSpecial">--enable-debugging-handlers=true</span>
 <span class="synSpecial">--cloud-provider=gce</span>
 <span class="synSpecial">--pod-manifest-path=/etc/kubernetes/manifests</span>
 <span class="synSpecial">--allow-privileged=True</span>
 <span class="synSpecial">--v=2</span> <span class="synSpecial">--cluster-dns=10.11.240.10</span>
 <span class="synSpecial">--cluster-domain=cluster.local</span>
 <span class="synSpecial">--cgroup-root=/</span>
 <span class="synSpecial">--system-cgroups=/system</span>
 <span class="synSpecial">--network-plugin=kubenet</span> <span class="synComment"># ←ここ</span>
 <span class="synSpecial">--runtime-cgroups=/docker-daemon</span>
 <span class="synSpecial">--kubelet-cgroups=/kubelet</span>
 <span class="synSpecial">--node-labels=beta.kubernetes.io/fluentd-ds-ready=true,cloud.google.com/gkenodepool=default-pool</span> 
 <span class="synSpecial">--babysit-daemons=true</span> 
 <span class="synSpecial">--eviction-hard=memory.available&lt;100Mi,nodefs.available&lt;10%,nodefs.inodesFree&lt;5%</span> 
 <span class="synSpecial">--anonymous-auth=false</span> 
 <span class="synSpecial">--authorization-mode=Webhook</span> 
 <span class="synSpecial">--client-ca-file=/etc/kubernetes/pki/ca-certificates.crt</span> 
 <span class="synSpecial">--feature-gates=ExperimentalCriticalPodAnnotation=true</span> 
 <span class="synSpecial">--experimental-allocatable-ignore-eviction</span>
</pre>


<p><code>--network-plugin=kubenet</code>という引数が与えられていますね。<br/>
ちなみにCNIを使う場合は<code>--network-plugin=cni</code>という指定でした。</p>

<p>kubenetを使用する場合、cbr0という名前のブリッジが作成され、cbr0に接続されたpod用のvethペアも作成されます。<br/>
更に言うとkubenetを使用する場合、実はCNIプラグインが使用されているようです(恐らくブリッジへの接続などで)。<br/>
例えばGKEの場合、クラスタの<code>/opt/cni/bin</code>配下を見てみると、以下のようなプラグインが配置されています。</p>

<pre class="code" data-lang="" data-unlink>/opt/cni/bin$ ls -l
-rwxr-xr-x 1 root root 4026452 Mar 22 20:04 bridge
-rwxr-xr-x 1 root root 2901956 Mar 22 20:03 cnitool
-rwxr-xr-x 1 root root 9636499 Mar 22 20:04 dhcp
-rwxr-xr-x 1 root root 2910884 Mar 22 20:03 flannel
-rwxr-xr-x 1 root root 3102946 Mar 22 20:04 host-local
-rwxr-xr-x 1 root root 3609358 Mar 22 20:04 ipvlan
-rwxr-xr-x 1 root root 3170507 Mar 22 20:04 loopback
-rwxr-xr-x 1 root root 3640336 Mar 22 20:04 macvlan
-rwxr-xr-x 1 root root 2733314 Mar 22 20:04 noop
-rwxr-xr-x 1 root root 4000236 Mar 22 20:04 ptp
</pre>


<h4>まとめ</h4>

<p>これまでマルチホストでのContainer間通信を実現するための3つの方法を説明してきたわけですが、自前でやるにしろ、CNIプラグインやkubenetを利用するにせよ、Kubernetes本体の機能はほとんど使われていないことがわかったかと思います。</p>

<h2>マルチホストでContainer間通信ができるだけでは解決しない問題</h2>

<p><a href="http://tech.uzabase.com/entry/2017/08/23/175813">前回の記事</a>で私は「Overlay Networkを構築するだけでは、Containerが起動するホストが動的に変わるようなケースには対応できません。」というようなことを書きました。これはどういうことを言っているのか説明しましょう。</p>

<p>まず、KubernetesのようなオーケストレーションツールでContainerを起動する場合、基本的にはDeployするホストをユーザーが直接指定することはありません。Kubernetesがホストの状況(負荷とか空き容量とか)を見て、適切なホストにDeployしてくれるからです。そう、つまりContainerがどこにDeployされるかは予めわからないのです。<br/>
もちろんDeploy後であれば、DeployされたホストのIPを知ることができます。しかしContainer間で連携を行う場合、Deployされるまで連携するContainerのIPが分からないのは不便きわまりないです。この問題は、当然、<u>ホストをまたいでContainer同士が通信できても解決しません。</u></p>

<p>この問題を解決するには、<u>どのホストにContainerがDeployされてもContainerにアクセスする側が気にしなくていいような仕組みが別に必要</u>になります。<br/>
Kubernetesでは<code>Service</code>がそのための仕組みを提供しています。</p>

<h2>Service</h2>

<p>Kubernetesをお使いの方はご存知の通り、<code>Service</code>はいわゆるロードバランサーで、名前をつけてPod(Kubernetesのリソースの一つでContainerを管理する)と紐付けておくことで、Service経由でPodとやりとりができるようになります。Podがスケールされて複数のホストに存在する場合は、ロードバランシングしてくれたりもします(Kubernetes Cluster上のPodからのみ名前解決できる)。</p>

<p>もう少し具体的に説明しましょう。まず、Serviceを生成するとServiceには自動的にIPが割り当てられます。<br/>
そしてこのIP(とServiceで指定したPort)を介してServiceに紐づくPodとやりとりすることができます。そのため、どのホストにPodがDeployされているか気にする必要がなくなります。</p>

<p>ちなみにこのIPは仮想的なIPで、紐づく物理的あるいは仮想的なNICはどこにも存在しません。<br/>
またこのIPはKubernetes Cluster上のPodからのみやりとりできます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170903/20170903221229.png" alt="f:id:kenji-suzuki:20170903221229p:plain" title="f:id:kenji-suzuki:20170903221229p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>しかし何故Podを直接名前解決できるようにせず、Serviceを挟んでいるのでしょうか。<br/>
Podのスケールアウトに対応するためでしょうか。でもこれはDNSラウンドロビンで対応できそうですね。<br/>
では、仮にPodを直接名前解決できたとしたらどうでしょう。そして、その名前解決の結果がキャッシュされ、キャッシュが有効なうちに何らかの理由でPodがフェールオーバーされて、これまでとは別のホストで起動されたらどうなるでしょうか。困ったことになりますね。このあたりのことは公式の<a href="https://kubernetes.io/docs/concepts/services-networking/service/#why-not-use-round-robin-dns">ここ</a>で言及されています。</p>

<p>さて、ただただServiceの機能について説明するだけでは面白くないので、今回は最後にもう少し突っ込んだ話をしたいと思います。</p>

<h2>Serviceの機能はどのように実現されているか</h2>

<p>今回は機能を次の2つに絞って「誰」が「どのように」実現しているかを説明します。</p>

<ol>
<li>名前解決</li>
<li>ルーティング</li>
</ol>


<p>ルーティングというのは、ServiceのIP（とPort）にアクセスされたら対応するPodのIP（とPort）にフォワードするという意味で書きました。</p>

<h3>担当者は誰だ？</h3>

<p>まず、こちらをご覧ください。これはKubernetesのアーキテクチャ図で、これを見るとKubernetesが様々な登場人物（Component）から成るツールだということがわかります。「誰」がという表現をしたのはこのためです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170903/20170903184036.png" alt="f:id:kenji-suzuki:20170903184036p:plain" title="f:id:kenji-suzuki:20170903184036p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>今回の話でいうと、名前解決の部分を担当しているのが<code>kube-dns</code>（上図にはいませんが）で、ルーティングの部分を担当しているのが<code>kube-proxy</code>です。<br/>
では、「どのように」それを実現しているのでしょうか。</p>

<h3>彼らは一体何をやっているのか？</h3>

<p>彼らがやっていることを端的に表すと「ServiceやEndpointリソースを監視して、リソースの状況に合わせたアクションを起こす」ということをやっています（今回はEndpointリソースには言及しません）。</p>

<p>もう少し具体的に説明しましょう。  <br/>
Kubernetesの<code>kube-apiserver</code>は、自身が管理している各種リソース(ServiceやNode、Pod、Secretなど）について、問い合わせる口を持っています。<br/>
そして問い合わせを行った結果、以前の問い合わせの結果との差分から、リソースの「追加」「削除」「更新」といったリソースの変化を検知しイベント通知を行うためのライブラリが用意されています。このライブラリは汎用的に作られていて、「追加」「削除」「更新」のイベント通知を受けた際に処理を行うイベントハンドラを簡単に設定できるようになっています。</p>

<p>kube-dnsやkube-proxyはサーバとして起動され、常駐しながら上記の仕組みを利用してServiceリソースを監視し、状況に応じた処理を行っています。</p>

<p>実際のソースコードを見てみましょう。
次はkube-dnsのパッケージのコードです。<br/>
<a href="https://github.com/kubernetes/dns/blob/35fcf7c9220f12e07d27bbca0b5de6687820ee7d/pkg/dns/dns.go">dns.go</a></p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">func</span> (kd *KubeDNS) setServicesStore() {
    <span class="synComment">// Returns a cache.ListWatch that gets all changes to services.</span>
    kd.servicesStore, kd.serviceController = kcache.NewInformer(
        kcache.NewListWatchFromClient(
            kd.kubeClient.Core().RESTClient(),
            <span class="synConstant">&quot;services&quot;</span>,
            v1.NamespaceAll,
            fields.Everything()),
        &amp;v1.Service{},
        resyncPeriod,
        kcache.ResourceEventHandlerFuncs{
            AddFunc:    kd.newService,
            DeleteFunc: kd.removeService,
            UpdateFunc: kd.updateService,
        },
    )
}

<span class="synStatement">func</span> (kd *KubeDNS) newService(obj <span class="synStatement">interface</span>{}) {
    <span class="synStatement">if</span> service, ok := assertIsService(obj); ok {
        glog.V(<span class="synConstant">3</span>).Infof(<span class="synConstant">&quot;New service: %v&quot;</span>, service.Name)
        glog.V(<span class="synConstant">4</span>).Infof(<span class="synConstant">&quot;Service details: %v&quot;</span>, service)

        <span class="synComment">// ExternalName services are a special kind that return CNAME records</span>
        <span class="synStatement">if</span> service.Spec.Type == v1.ServiceTypeExternalName {
            kd.newExternalNameService(service)
            <span class="synStatement">return</span>
        }
        <span class="synComment">// if ClusterIP is not set, a DNS entry should not be created</span>
        <span class="synStatement">if</span> !v1.IsServiceIPSet(service) {
            <span class="synStatement">if</span> err := kd.newHeadlessService(service); err != <span class="synStatement">nil</span> {
                glog.Errorf(<span class="synConstant">&quot;Could not create new headless service %v: %v&quot;</span>, service.Name, err)
            }
            <span class="synStatement">return</span>
        }
        <span class="synStatement">if</span> <span class="synStatement">len</span>(service.Spec.Ports) == <span class="synConstant">0</span> {
            glog.Warningf(<span class="synConstant">&quot;Service with no ports, this should not have happened: %v&quot;</span>,
                service)
        }
        kd.newPortalService(service)
    }
}
</pre>


<p>ServiceInformerというのが、Serviceリソースの状態を監視し、通知を行ってくれる構造体になります。<br/>
このInformerにハンドラを登録している部分が、AddFuncやUpdateFuncなどと書かれている部分です。</p>

<p>続いてkube-proxyのパッケージのコードを見てみましょう。こちらも同じような感じで、Informerにハンドラが登録されています。</p>

<p><a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/config/config.go">config.go</a></p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">func</span> NewServiceConfig(serviceInformer coreinformers.ServiceInformer, resyncPeriod time.Duration) *ServiceConfig {
    serviceInformer.Informer().AddEventHandlerWithResyncPeriod(
        cache.ResourceEventHandlerFuncs{
            AddFunc:    result.handleAddService,
            UpdateFunc: result.handleUpdateService,
            DeleteFunc: result.handleDeleteService,
        },
        resyncPeriod,
    )
}

<span class="synStatement">func</span> (c *ServiceConfig) handleAddService(obj <span class="synStatement">interface</span>{}) {
    service, ok := obj.(*api.Service)
    <span class="synStatement">if</span> !ok {
        utilruntime.HandleError(fmt.Errorf(<span class="synConstant">&quot;unexpected object type: %v&quot;</span>, obj))
        <span class="synStatement">return</span>
    }
    <span class="synStatement">for</span> i := <span class="synStatement">range</span> c.eventHandlers {
        glog.V(<span class="synConstant">4</span>).Infof(<span class="synConstant">&quot;Calling handler.OnServiceAdd&quot;</span>)
        c.eventHandlers[i].OnServiceAdd(service)
    }
}
</pre>


<h4>kube-dnsのイベントハンドラは何をしているか</h4>

<p>まずkube-dnsの<a href="https://github.com/kubernetes/dns/blob/35fcf7c9220f12e07d27bbca0b5de6687820ee7d/cmd/kube-dns/app/server.go">server</a>の起動部分を見ると分かるのですが、<a href="https://github.com/skynetservices/skydns">SkyDNS</a>というDNSサービスを起動しています。</p>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">func</span> (server *KubeDNSServer) Run() {
    pflag.VisitAll(<span class="synType">func</span>(flag *pflag.Flag) {
        glog.V(<span class="synConstant">0</span>).Infof(<span class="synConstant">&quot;FLAG: --%s=%q&quot;</span>, flag.Name, flag.Value)
    })
    setupSignalHandlers()
    server.startSkyDNSServer() <span class="synComment">// ここ</span>
    server.kd.Start()
    server.setupHandlers()

    glog.V(<span class="synConstant">0</span>).Infof(<span class="synConstant">&quot;Status HTTP port %v&quot;</span>, server.healthzPort)
    <span class="synStatement">if</span> server.nameServers != <span class="synConstant">&quot;&quot;</span> {
        glog.V(<span class="synConstant">0</span>).Infof(<span class="synConstant">&quot;Upstream nameservers: %s&quot;</span>, server.nameServers)
    }
    glog.Fatal(http.ListenAndServe(fmt.Sprintf(<span class="synConstant">&quot;:%d&quot;</span>, server.healthzPort), <span class="synStatement">nil</span>))
}
</pre>


<p>SkyDNSのサーバーには、問い合わせを受けたときに呼び出される「DNSレコードを返す処理」を渡せるようになっており、その部分のみkube-dnsが実装しています。<br/>
そしてそのレコードの登録処理が、Serviceの変更の通知を受け取ったときに呼び出される処理なのです。<br/>
これによりKubernetes Cluster内で名前解決が可能になります。</p>

<h4>kube-proxyのイベントハンドラは何をしているか</h4>

<p>まず先に言ってしまうと、ServiceからPodへのルーティングは、iptablesによって行われています。<br/>
iptablesの内容を表示させてみると次のようになっています（説明に必要なものだけ抜粋しています）。これはkubernetes-dashboardのルーティングなのですが、Serviceの 10.110.169.150:80 が Pod の 10.42.0.0:9090 にフォワードされていることが分かると思います。</p>

<pre class="code" data-lang="" data-unlink>-A KUBE-SEP-4 -s 10.42.0.0/32     -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34;        -j KUBE-MARK-MASQ
-A KUBE-SEP-4 -p tcp              -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m tcp -j DNAT --to-destination 10.42.0.0:9090

-A KUBE-SERVICES -d 10.110.169.150/32 -p tcp -m comment --comment &#34;kube-system/kubernetes-dashboard: cluster IP&#34; -m tcp --dport 80 -j KUBE-SVC-DASH

-A KUBE-SVC-DASH    -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -j KUBE-SEP-4</pre>


<p>ちなみにこのdashboardをスケールアウトさせてみると<br/>
<code>$ kubectl scale deploy kubernetes-dashboard -n kube-system --replicas=3</code></p>

<p>このようになります。</p>

<pre class="code" data-lang="" data-unlink>-A KUBE-SEP-3 -s 10.44.0.1/32 -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -j KUBE-MARK-MASQ
-A KUBE-SEP-3 -p tcp -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m tcp -j DNAT --to-destination 10.44.0.1:9090
-A KUBE-SEP-1 -s 10.42.0.0/32 -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -j KUBE-MARK-MASQ
-A KUBE-SEP-1 -p tcp -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m tcp -j DNAT --to-destination 10.42.0.0:9090
-A KUBE-SEP-2 -s 10.42.0.1/32 -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -j KUBE-MARK-MASQ
-A KUBE-SEP-2 -p tcp -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m tcp -j DNAT --to-destination 10.42.0.1:9090

# -m statisitc でランダムに宛先を変えている
# 1/3の確率で KUBE-SEP-1
-A KUBE-SVC-XGLOHA7QRQ3V22RZ -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-1
# 1/2の確率で KUBE-SEP-2
-A KUBE-SVC-XGLOHA7QRQ3V22RZ -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-2
# 残りは KUBE-SEP-3
-A KUBE-SVC-XGLOHA7QRQ3V22RZ -m comment --comment &#34;kube-system/kubernetes-dashboard:&#34; -j KUBE-SEP-3</pre>


<p>もう分かったかと思いますが、kube-proxyのイベントハンドラがやっているのは、このiptablesの動的な更新です。
これは上記のkube-proxyのコードを追っていくと分かります(興味がありましたら<a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/iptables/proxier.go">proxier.go</a>のsyncProxyRulesのあたりをご覧ください)。</p>

<h3>まとめ</h3>

<p>kube-dnsとkube-proxyがServiceを監視しており、Serviceが作成されたとき、kube-dnsによりDNSレコードが登録され名前解決が可能になり、そしてkube-proxyによりiptablesを使ったルーティングが設定されることが分かったかと思います。</p>

<p>図にするとこのような流れになるでしょうか。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170906/20170906013723.png" alt="f:id:kenji-suzuki:20170906013723p:plain" title="f:id:kenji-suzuki:20170906013723p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170906/20170906015645.png" alt="f:id:kenji-suzuki:20170906015645p:plain" title="f:id:kenji-suzuki:20170906015645p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170906/20170906013926.png" alt="f:id:kenji-suzuki:20170906013926p:plain" title="f:id:kenji-suzuki:20170906013926p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170906/20170906014014.png" alt="f:id:kenji-suzuki:20170906014014p:plain" title="f:id:kenji-suzuki:20170906014014p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170906/20170906014153.png" alt="f:id:kenji-suzuki:20170906014153p:plain" title="f:id:kenji-suzuki:20170906014153p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>さて、大分長くなりましたがKubernetesのネットワーク話はいかがだったでしょうか。<br/>
様々な仕組みは用意しつつ、巧みに自前での実装を回避しているという印象を私は受けました。<br/>
Kubernetesは調べていくと感心させられることが多いですね。</p>

<h4>シリーズ</h4>

<p>第1回: <a href="http://tech.uzabase.com/entry/2017/08/07/172411">マルチホストでのDocker Container間通信 第1回: Dockerネットワークの基礎</a><br/>
第2回: <a href="http://tech.uzabase.com/entry/2017/08/23/175813">マルチホストでのDocker Container間通信 第2回: Port Forwarding と Overlay Network</a><br/>
第3回: マルチホストでのDocker Container間通信 第3回: Kubernetesのネットワーク(CNI, kube-proxy, kube-dns) (当記事)</p>
</description>          <pubDate>Tue, 12 Sep 2017 16:47:56 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812287412050</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170903/20170903221229.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>マルチホストでのDocker Container間通信 第2回 Port Forwarding と Overlay Network</title>
          <link>http://tech.uzabase.com/entry/2017/08/23/175813</link>          <description><p>こんにちは。SPEEDA開発チームの鈴木です。<br/>
<a href="http://tech.uzabase.com/entry/2017/08/07/172411">前回</a>はマルチホストでのDocker Container間通信の説明の前段として、Dockerのネットワークが次のようになっているという話をしました。
　<br/>
　<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170710/20170710131809.png" alt="f:id:kenji-suzuki:20170710131809p:plain" title="f:id:kenji-suzuki:20170710131809p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>今回はいよいよ、マルチホストでどうやってDocker Container同士の通信を実現するのかを説明していきます。</p>

<h1>はじめに</h1>

<p>マルチホスト間でのDocker Container通信とは、次のようにホストをまたいでDocker Container同士が通信することを指します。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170707/20170707164743.png" alt="f:id:kenji-suzuki:20170707164743p:plain" title="f:id:kenji-suzuki:20170707164743p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>図で見ると大分単純ですし、前提条件次第では実際簡単に実現できるのですが、Containerのオーケストレーションを前提におくと色々な仕組みが必要なことがわかってきます。</p>

<h2>DockerによるContainerのマルチホスト間通信</h2>

<p>例としてA,B,C,Dという4つのDocker Containerを、複数のホストに配置するとこのようになります（Host XとYは同じネットワークに属することとします）。<br/>
※以降の説明には不要なため、vethの記載は省略します。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714142929.png" alt="f:id:kenji-suzuki:20170714142929p:plain" title="f:id:kenji-suzuki:20170714142929p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>これをネットワーク的な視点で見ると、次のような感じです。
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714184336.png" alt="f:id:kenji-suzuki:20170714184336p:plain" title="f:id:kenji-suzuki:20170714184336p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>Container AとContainer Bは当然通信できます。<br/>
また、Container AからHost Yまでも問題なく通信できます。
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714184907.png" alt="f:id:kenji-suzuki:20170714184907p:plain" title="f:id:kenji-suzuki:20170714184907p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>しかし、Container Cとは通信できません。なぜならContainer AとContainer Cは異なるPrivate Network上に存在するからです。
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714185209.png" alt="f:id:kenji-suzuki:20170714185209p:plain" title="f:id:kenji-suzuki:20170714185209p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>この問題を解決して、異なるホストのContainerと通信できるようにする方法はいくつかあります。<br/>
その1つがDockerのPort Forwarding機能です。</p>

<h3>Port Forwarding</h3>

<p>Port Forwarding機能を使うとContainerの外部からContainerにアクセスできるようになります。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># Host Yの8080番ポートにアクセスしたら、Container Cの80番ポートにForwardする</span>
host-y: $ docker run <span class="synSpecial">--name</span> container-c <span class="synSpecial">-d</span> <span class="synSpecial">-p</span> <span class="synConstant">8080</span>:<span class="synConstant">80</span> nginx
</pre>


<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714190341.png" alt="f:id:kenji-suzuki:20170714190341p:plain" title="f:id:kenji-suzuki:20170714190341p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>iptablesの設定内容を見ると、<code>docker run</code>で指定したようにPort Forwardingが行われる設定がされていることがわかります。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink>host-y:/$ sudo iptables-save 
*nat
<span class="synComment"># 略</span>
-A DOCKER ! <span class="synSpecial">-i</span> docker0 <span class="synSpecial">-p</span> tcp <span class="synSpecial">-m</span> tcp <span class="synSpecial">--dport</span> <span class="synConstant">8080</span> <span class="synSpecial">-j</span> DNAT <span class="synSpecial">--to-destination</span> 172.17.0.2:<span class="synConstant">80</span>
COMMIT
<span class="synComment"># 略</span>
</pre>


<p>この通信方法は<strong>「接続元のContainerが接続先のContainerのホストのIPを知っている」</strong>という条件のもとに成り立っています。つまりContainerが起動するホストが動的に変わるようなケースには対応できません。<br/>
逆に言えばホストが固定されていて、今後も変わらないならばこれで十分です。</p>

<h3>Overlay Network</h3>

<p>Overlay Networkとは、あるNetworkの上に別のNetworkを構築する技術です。<br/>
異なるホストのContainer同士が通信できない原因はContainerが異なるネットワークに属していることにありました。<br/>
「じゃあOverlay Network構築して同じネットワークに属するようにしてしまえばいいじゃん」というのがこの方法です。
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170714/20170714200720.png" alt="f:id:kenji-suzuki:20170714200720p:plain" title="f:id:kenji-suzuki:20170714200720p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>Overlay Networkを使用する場合、Containerは同じネットワークに属していることになるので、異なるホストのContainerと直接通信することができるようになります。<br/>
続いてOverlay Networkの構築方法をいくつかご紹介します。</p>

<h4>1. <a href="https://docs.docker.com/engine/swarm/">Docker Swarm mode</a></h4>

<p>Dockerのオーケストレーション機能であるSwarm modeでContainerのマルチホスト間通信を実現している方法が、まさにこのOverlay Networkを利用する方法です。<br/>
Swarm modeでクラスタを構築した後、Docker用のネットワーク一覧を表示する<code>docker network ls</code>コマンドを実行してみると、Overlay Networkが構築されていることがわかります。</p>

<pre class="code" data-lang="" data-unlink>$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
d95e8109f33a        bridge              bridge              local
e5430ed50f3d        docker_gwbridge     bridge              local
6f6c8c7f698d        host                host                local
1q38yeph9dnj        ingress             overlay             swarm
2bae9ccfec69        none                null                local</pre>


<p>以前のSwarmではService Discoveryとしてconsul, etcd, zookeeperなどの分散KVSが必要でしたが、Swamr modeの登場以降は不要になっています（Dockerに組み込まれたようです）。</p>

<h4>2. 分散KVSと<code>docker network create -d overlay</code>コマンドを使って自前で構築</h4>

<p>Swarm modeがやってくれているようなことを自前でやります。いまはSwarm modeがあるので、この方法が使われることはあまりないでしょう。</p>

<h4>3. <a href="https://github.com/coreos/flannel">flannel</a>のようなOverlay Network構築ツールを使う</h4>

<p>flannelは公式ページの冒頭に「Flannel is a simple and easy to configure layer 3 network fabric designed for Kubernetes.」とあるように、元々Kubernetes向けに作られたものです。<br/>
flannelを使用する場合、次のイメージのように各ホストにflanneldとetcdをインストールします。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170717/20170717220751.png" alt="f:id:kenji-suzuki:20170717220751p:plain" title="f:id:kenji-suzuki:20170717220751p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>flannelの主な役割は2つです。</p>

<ol>
<li>etcdを使ってNetwork情報を共有することで、docker0に重複しないSubNetを割り当てる。<br/>
(割り当て済みのSubNetのアドレス帯を共有しているので重複を避けられる）</li>
<li>各ホストに仮想NIC<code>flannel0</code>を作成。Container間でpacketを送受信する際、docker0と接続されたflannel0がVXLANでpacketのカプセル化・非カプセル化を行う。</li>
</ol>


<p>VXLANでカプセル化されたpacketは次のような構造をしています。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170718/20170718012341.png" alt="f:id:kenji-suzuki:20170718012341p:plain" title="f:id:kenji-suzuki:20170718012341p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>元のpacket(Inner MAC Address 〜 payloadまで)の送信先IPはContainer CのIPですが、Container Cは仮想的には同じNetworkに属しているものの物理的には別のNetworkに属しておりルーティングできないので、上記図でルータ的役割を果たしているHost Yのeth0を宛先とする別のHeader(Outer MAC Address 〜 VXLAN Headerまで)を付加しています。このようにあるプロトコルを別のプロトコルで包むことをカプセル化といいます。</p>

<p>packetを受信した側は、付加されたHeaderの情報（VXLAN Headerの情報など）から受信したpacketがVXLANのpacketであることが判別できるので、包んでいるプロトコルを剥がして本来送信したかった宛先に送ることができます。
例えばHost XのContainer AからHost YのContainer Cにpacketを送信すると次のようにpacketが送信されていきます。NICの右側が、そのNICのpacketをキャプチャしたものです（簡略化しています）。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170726/20170726032055.png" alt="f:id:kenji-suzuki:20170726032055p:plain" title="f:id:kenji-suzuki:20170726032055p:plain" class="hatena-fotolife" itemprop="image"></span>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170726/20170726032225.png" alt="f:id:kenji-suzuki:20170726032225p:plain" title="f:id:kenji-suzuki:20170726032225p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>Overlay Networkだけで解決できないこと</h4>

<p>Port Forwardingと同様に、Containerが起動するホストが動的に変わるようなケースには対応できません。<br/>
同じネットワークに属してはいますが、同じホストに存在するわけではないので、dockerのlink機能やdocker-composeを使っての名前解決ができないからです。<br/>
Docker swarmやKubernetesなどはこの問題を解決するための仕組みをもっています。</p>

<p><a href="http://tech.uzabase.com/entry/2017/09/12/164756">次回</a>は、KubernetesにおけるContainerのマルチホスト間通信と合わせてこのあたりのことを書きたいと思います。</p>

<h4>シリーズ</h4>

<p>第1回: <a href="http://tech.uzabase.com/entry/2017/08/07/172411">マルチホストでのDocker Container間通信 第1回: Dockerネットワークの基礎</a><br/>
第2回: マルチホストでのDocker Container間通信 第2回: Port Forwarding と Overlay Network (当記事)<br/>
第3回: <a href="http://tech.uzabase.com/entry/2017/09/12/164756">マルチホストでのDocker Container間通信 第3回: Kubernetesのネットワーク(CNI, kube-proxy, kube-dns)</a></p>
</description>          <pubDate>Wed, 23 Aug 2017 17:58:13 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812279548363</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170710/20170710131809.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>マルチホストでのDocker Container間通信 第1回: Dockerネットワークの基礎</title>
          <link>http://tech.uzabase.com/entry/2017/08/07/172411</link>          <description><p>こんにちは。SPEEDA開発チームの鈴木です。<br/>
調べてみるとなかなか興味深い技術であるマルチホストでのDocker Conainer間通信。<br/>
これをどのように実現しているのか説明したいと思います。
が、その前に今回の投稿では、まず基礎知識的な話としてDockerのネットワークについて順を追って説明をします。</p>

<h1>Dockerのネットワーク</h1>

<h2>docker0</h2>

<p>Dockerをインストールしたあと、<code>ifconfig</code>や<code>ip addr show</code>すると<code>docker0</code>なるものが表示されるようになるので、気になっていた人もいるかと思います。<br/>
これは一体何者なのでしょうか。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ ifconfig
docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 0.0.0.0
        ether 02:42:fb:28:ee:2d  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

</pre>


<p>　<br/>
この<code>docker0</code>はDockerによって自動的に作成された仮想ブリッジで、Docker Container同士をつなぐためのものです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170707/20170707184308.png" alt="f:id:kenji-suzuki:20170707184308p:plain" title="f:id:kenji-suzuki:20170707184308p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h2>docker0に接続されているネットワーク・インタフェース</h2>

<p>何かしらDocker Containerを起動した状態で、ブリッジを管理する<code>brctl</code>コマンドを実行してみると次のように<code>docker0</code>に接続されているネットワーク・インタフェースが表示されます。
(<code>brctl</code>は<code>bridge-utils</code>パッケージに含まれています）</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ brctl show
bridge name     bridge id               STP enabled     interfaces
docker0         8000.0242fb28ee2d       no              veth269de4e
                                                        veth87e3222
                                                        vethbcff718</pre>


<p>そしてこれがインタフェースを<code>grep veth</code>してみた結果です。たしかにこのネットワーク・インタフェースは存在するようですね。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ ip addr show | grep veth
9: vethbcff718@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default 
11: veth269de4e@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default 
15: veth87e3222@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </pre>


<p>　<br/>
ちなみにDocker Containerをすべて落としてみるとこうなります。<code>docker0</code>には何も接続されていないようですね。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ brctl show
bridge name bridge id       STP enabled interfaces
docker0     8000.0242fb28ee2d   no  </pre>


<p>さきほど存在したネットワーク・インタフェースもいなくなっています。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ ifconfig | grep veth
[kenji@arch ~]$ 
</pre>


<p>　<br/>
なるほど。じゃあこのvethXXXがDocker Containerのネットワーク・インタフェースなのか、というとちょっと違うのですが、正確なところを説明する前にそもそもvethって何なのかを説明します。</p>

<h2>veth</h2>

<p>vethは <strong>v</strong>irtual<strong>eth</strong>ernet device、つまり仮想的なネットワーク・インタフェースです。<br/>
vethは常にペアで作成され、このペア間で通信が行えます。<br/>
(vethペアの片割れをveth peerといいます)</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170707/20170707192057.png" alt="f:id:kenji-suzuki:20170707192057p:plain" title="f:id:kenji-suzuki:20170707192057p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>　<br/>
vethペアは次のようなコマンドで作成できます。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ sudo ip link add name veth1 type veth peer name veth1-peer</pre>


<p><code>ip link show</code>で確認してみると、vethのペアが作成されていることが分かります。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ ip link show | grep veth
18: veth1-peer@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
19: veth1@veth1-peer: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</pre>


<p>　<br/>
さて、ここで一つの疑問が生じます。</p>

<p><strong>「Docker Containerを起動したときに作成されるvethって一つじゃね？」</strong></p>

<p>Containerの起動後にネットワーク・インタフェースを表示してみると、たしかにそう見えます。</p>

<pre class="code" data-lang="" data-unlink>[kenji@arch ~]$ docker ps --format &#34;table {{.ID}} {{.Names}}&#34;
CONTAINER ID NAMES
b71e096208c2 kong
7add408c9775 kong-database

# Containerが2つなので4つvethが表示されるはず？
[kenji@arch ~]$ ip link show | grep veth
17: vethb96b887@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default 
21: veth9c7e462@if20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default </pre>


<p>　<br/>
この疑問に答えるキーワードが<strong>ネットワーク名前空間</strong>です。</p>

<h2>ネットワーク名前空間</h2>

<p>Dockerのことを勉強すると必ずといっていいほど説明されていますが、Linuxはカーネルが扱う様々なリソースをある単位でまとめて分離する仕組みを持っています。
この仕組みを<a href="https://linuxjm.osdn.jp/html/LDP_man-pages/man7/namespaces.7.html">名前空間</a>といいます。
分離されたリソースはその名前空間に属するプロセス以外からは直接見えなくなります。</p>

<p>例えばunshareコマンドでUTS名前空間を新たに作成した場合、その名前空間を作成した側と別のホスト名を持つことができます。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># 1. 名前空間のエントリを表示</span>
kenji@test1:~$ sudo <span class="synStatement">ls</span> <span class="synSpecial">-l</span> /proc/*/ns | <span class="synStatement">grep</span> uts | awk <span class="synStatement">'</span><span class="synConstant">{print $11}</span><span class="synStatement">'</span> | <span class="synStatement">sort</span> | uniq
uts:<span class="synStatement">[</span><span class="synConstant">4026531838</span><span class="synStatement">]</span>

<span class="synComment"># 2. UTS名前空間を新たに作成し、その名前空間でbashを実行</span>
kenji@test1:~$ sudo unshare <span class="synSpecial">-u</span> /bin/bash
root@test1:~# 

<span class="synComment"># 1,2 とは別のシェルで名前空間のエントリを表示すると一つ増えてることが分かる</span>
kenji@test1:~$ sudo <span class="synStatement">ls</span> <span class="synSpecial">-l</span> /proc/*/ns | <span class="synStatement">grep</span> uts | awk <span class="synStatement">'</span><span class="synConstant">{print $11}</span><span class="synStatement">'</span> | <span class="synStatement">sort</span> | uniq
uts:<span class="synStatement">[</span><span class="synConstant">4026531838</span><span class="synStatement">]</span>
uts:<span class="synStatement">[</span><span class="synConstant">4026532203</span><span class="synStatement">]</span>

<span class="synComment"># 1,2 のシェルでホスト名を変更</span>
root@test1:~# hostname updated-host
root@test1:~# hostname
updated-host

<span class="synComment"># 1,2 とは別のシェルでホスト名を表示すると、こちらには上記の変更が反映されないことが分かる</span>
kenji@test1:~$ hostname
test1
</pre>


<p>　</p>

<p>この名前空間には色々種類があるのですが、ネットワークに対する名前空間が<strong>ネットワーク名前空間</strong>です。<br/>
そして前述のvethペアの片割れは、作成したネットワーク名前空間に移動させることができるのです。<br/>
つまりvethペアによってネットワーク名前空間同士を仮想的なケーブルでつなぐことができます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170709/20170709234136.png" alt="f:id:kenji-suzuki:20170709234136p:plain" title="f:id:kenji-suzuki:20170709234136p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>移動させたvethは移動元からは見えなくなります。これがDocker Containerのvethの片割れが見えなかった理由です。<br/>
ここまでを踏まえるとDockerのネットワークが次のようになっていることが理解できるでしょう。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170710/20170710000413.png" alt="f:id:kenji-suzuki:20170710000413p:plain" title="f:id:kenji-suzuki:20170710000413p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>更に付け加えると、veth(peer)はDocker Container内ではeth0として見えるようになっています。
またDockerによりveth(peer)にIPアドレスが割り当てられます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170710/20170710132020.png" alt="f:id:kenji-suzuki:20170710132020p:plain" title="f:id:kenji-suzuki:20170710132020p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h2>Docker Containerのネットワーク名前空間を参照する</h2>

<p>ネットワーク名前空間の一覧は<code>ip netns</code>コマンドで参照でき、<code>ip netns exec ネットワーク名前空間名</code>コマンドを使うと指定したネットワーク名前空間で任意のコマンドが実行できるのですが、Docker Containerのネットワーク名前空間はDockerにより隠蔽されています。<br/>
しかし以下2つの情報を知っていれば、強引に参照することができます。</p>

<ol>
<li>Docker Containerのネットワーク名前空間は<code>/proc/Docker ContainerのPID/ns/net</code>に割り当てられる。</li>
<li><code>ip netns</code>コマンドで表示されるネットワーク名前空間は、<code>/var/run/netns</code>ディレクトリ配下のものである。</li>
</ol>


<p>どういうことかというと、Docker ContainerのPIDを調べてネットワーク名前空間を見つけて、/var/run/netnsへのリンクを貼るのです。<br/>
試してみたいけど面倒くさいという方のためにシェルを用意してあります(<a href="https://github.com/pujoheadsoft/docker-netns">github</a>)。<br/>
プログラムの性質上、実行にroot権限が必要になるので、気になるようでしたら内容をご確認ください。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink>git clone https://github.com/pujoheadsoft/docker-netns.git
<span class="synStatement">cd</span> docker-netns
<span class="synStatement">chmod</span> <span class="synSpecial">+x</span> docker-netns.sh 

<span class="synComment"># 実行例</span>
~/docker-netns$ sudo ./docker-netns.sh visible
container<span class="synStatement">'</span><span class="synConstant">s network namespace to visible, you can show container</span><span class="synStatement">'</span>s nemespace by <span class="synStatement">[</span>ip netns<span class="synStatement">]</span> command.
kenji@master:~/docker-netns$ ip netns
bfe34b8a7972
2ec174520fda

<span class="synComment"># vethとvethに対応するContainerを表示</span>
kenji@test1:~/docker-netns$ sudo ./docker-netns.sh showveth
VETH                 CONTAINER ID         NAMES                         
veth2753b2f          51f82f5e9712         /mywordpress_wordpress_1      
vetha334043          4939c68f1740         /mywordpress_db_1  

<span class="synComment"># ContainerのIPを表示(リソースはcontainer側のものですが、コマンドはホスト側のものを使えるので、IPを表示するコマンドがないContainerでもIPを表示できます)</span>
kenji@test1:~/docker-netns$ sudo ./docker-netns.sh showip
CONTAINER ID    IP                                       NAMES
51f82f5e9712    inet 172.18.0.3/<span class="synConstant">16</span> scope global eth0     /mywordpress_wordpress_1
4939c68f1740    inet 172.18.0.2/<span class="synConstant">16</span> scope global eth0     /mywordpress_db_1
</pre>


<h3>ルーティング</h3>

<p>Dockerにより、Docker Containerから外部のネットワークに接続できるようIPマスカレードが行われるようなルーティングになっています。<br/>
これはIPテーブルを参照してみると分かります。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synStatement">[</span>kenji@arch ~<span class="synStatement">]</span>$ ip addr show | <span class="synStatement">grep</span> docker
<span class="synConstant">3</span>: docker0: <span class="synStatement">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="synStatement">&gt;</span> mtu <span class="synConstant">1500</span> qdisc noqueue state DOWN group default 
    inet 172.17.0.1/<span class="synConstant">16</span> scope global docker0

<span class="synComment"># iptablesの情報を参照</span>
<span class="synStatement">[</span>kenji@arch ~<span class="synStatement">]</span>$ sudo iptables-save 
<span class="synComment"># Generated by iptables-save v1.6.1 on Mon Jul 10 01:15:10 2017</span>
*nat
<span class="synComment"># --中略--</span>
-A PREROUTING <span class="synSpecial">-m</span> addrtype <span class="synSpecial">--dst-type</span> LOCAL <span class="synSpecial">-j</span> DOCKER
-A OUTPUT ! <span class="synSpecial">-d</span> 127.0.0.0/<span class="synConstant">8</span> <span class="synSpecial">-m</span> addrtype <span class="synSpecial">--dst-type</span> LOCAL <span class="synSpecial">-j</span> DOCKER

<span class="synComment"># これがIPマスカレードの部分。Dockerのネットワーク(172.17.0.0/16)かつ、</span>
<span class="synComment"># docker0以外のインタフェースからパケットが出力された場合IPマスカレードする</span>
-A POSTROUTING <span class="synSpecial">-s</span> 172.17.0.0/<span class="synConstant">16</span> ! <span class="synSpecial">-o</span> docker0 <span class="synSpecial">-j</span> MASQUERADE
-A DOCKER <span class="synSpecial">-i</span> docker0 <span class="synSpecial">-j</span> RETURN

COMMIT
<span class="synComment"># --中略--</span>
</pre>


<p>これまでの図に加えると、このような感じになりますね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170710/20170710131809.png" alt="f:id:kenji-suzuki:20170710131809p:plain" title="f:id:kenji-suzuki:20170710131809p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>以上がDockerのネットワークの説明になります。<br/>
Docker Composeを使った場合、bridgeやルーティングはまたこれとは少し違ったものになるのですが、そこは割愛します。<br/>
<a href="http://tech.uzabase.com/entry/2017/08/23/175813">次回</a>は、いよいよマルチホストでのDocker Container間通信の話をします。</p>

<hr />

<p>株式会社ユーザベースでは、DockerやDocker関連技術に興味のあるエンジニアを<a href="https://www.uzabase.com/recruit/occupation/">大募集中</a>です！</p>

<h4>シリーズ</h4>

<p>第1回: マルチホストでのDocker Container間通信 第1回: Dockerネットワークの基礎 (当記事)<br/>
第2回: <a href="http://tech.uzabase.com/entry/2017/08/23/175813">マルチホストでのDocker Container間通信 第2回: Port Forwarding と Overlay Network</a><br/>
第3回: <a href="http://tech.uzabase.com/entry/2017/09/12/164756">マルチホストでのDocker Container間通信 第3回: Kubernetesのネットワーク(CNI, kube-proxy, kube-dns)</a></p>

<hr />

<iframe frameborder='0' height='305px' name='wantedly_project_widget_114494' scrolling='no' src='https://www.wantedly.com/projects/114494/widget' style='border: none; max-width: 100%; min-width: 240px; width: 540px;'></iframe>


<iframe frameborder='0' height='305px' name='wantedly_project_widget_91396' scrolling='no' src='https://www.wantedly.com/projects/91396/widget' style='border: none; max-width: 100%; min-width: 240px; width: 540px;'></iframe>


<iframe frameborder='0' height='305px' name='wantedly_project_widget_59258' scrolling='no' src='https://www.wantedly.com/projects/59258/widget' style='border: none; max-width: 100%; min-width: 240px; width: 540px;'></iframe>


<iframe frameborder='0' height='305px' name='wantedly_project_widget_48032' scrolling='no' src='https://www.wantedly.com/projects/48032/widget' style='border: none; max-width: 100%; min-width: 240px; width: 540px;'></iframe>


<iframe frameborder='0' height='305px' name='wantedly_project_widget_45821' scrolling='no' src='https://www.wantedly.com/projects/45821/widget' style='border: none; max-width: 100%; min-width: 240px; width: 540px;'></iframe>

</description>          <pubDate>Mon, 07 Aug 2017 17:24:11 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8599973812277685273</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenji-suzuki/20170707/20170707164743.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>スタートアップ広報が新規上場するときに気をつけておきたいこと</title>
          <link>http://tech.uzabase.com/entry/2016/12/08/172316</link>          <description><div>こんにちは、ユーザベースで広報とIRを担当している山田です。2016年10月21日、株式会社ユーザベースは東京証券取引所マザーズに上場しました。</div>
<div> </div>
<div><iframe style="border: none; overflow: hidden;" src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fuzabase%2Fposts%2F1264328823599210&amp;width=500" width="500" height="539" frameborder="0" scrolling="no"></iframe></div>
<div> </div>
<div>上場できたのもこれまで支えていただいた皆さまのおかげです……といった形式ばったことは最小限に留めておいて、上場にあたって広報ノウハウがあまり公開されていなくて本気で困ったので、Tech Blogの場を借りて、今後増えてくると思われる上場準備中の企業の広報担当者さんたち向けに<strong>「スタートアップが新規上場（IPO）する際に広報として気をつけておきたいこと」</strong>をまとめたいと思います。</div>
<div> </div>
<div>なおユーザベースのバックオフィスチームには公認会計士の資格を持つメンバーが、ファームを作れるぐらいの人数いるという幸運もあったため、本記事では財務や会計的な側面には触れません。</div>
<div> </div>
<h3>上場前</h3>
<div> </div>
<div>上場前にできることはそれほどありません。上場承認後に必要になる作業を想像して、それへの情報収集と対策を粛々と進めていきます。</div>
<div> </div>
<div>ユーザベースの場合は以下の作業に主にリソースを割きました。</div>
<div> </div>
<div>
<ul>
<li>目論見書カラーページの制作</li>
<li>IRページの制作</li>
<li>上場当日セレモニーの演出</li>
<li>上場後最初となる決算説明会の準備</li>
</ul>
</div>
<div> </div>
<div>特に目論見書とIRページについては、上場承認後に投資家との接点になる最重要ポイントです。「私たちが何者であるか」を知っていただいて、会社の何を評価して、株式を保有してほしいかというメッセージが伝わるものにしなければなりません。</div>
<div> </div>
<div>会社によって何を知ってほしいかという軸は異なりますが、私たちが伝えたいメッセージは<strong>「経済情報で、世界をかえる」</strong>というミッションです。このミッションとコーポレートカラーである赤、そして大事にしている<strong>「7つのルール」</strong>を前面に推し出すことにしました。​</div>
<div> </div>
<div>
<p><img class="hatena-fotolife" title="f:id:kiyohero:20161207132340p:plain" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kiyohero/20161207/20161207132340.png" alt="f:id:kiyohero:20161207132340p:plain" /></p>
<p><img class="hatena-fotolife" title="f:id:kiyohero:20161207132352p:plain" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kiyohero/20161207/20161207132352.png" alt="f:id:kiyohero:20161207132352p:plain" /></p>
</div>
<p> </p>
<p>「何を知ってほしいか」は会社によってそれぞれだと思うので、経営陣も交えてしっかり議論した上で、方針を決めるのが良いと思います。</p>
<p> </p>
<h3>上場承認〜上場当日</h3>
<div> </div>
<div>上場承認が下りたら、いよいよ上場に向けたスパートのはじまりです。顧客、社員、投資家など様々なステークホルダーに適切に情報を届ける必要があります。</div>
<div> </div>
<div>まず承認を受けたら、公式情報としてすぐにプレスリリースを出します。ネット上での最速情報としてTDnetのPDFがありますが、テキストベースのフォーマットで自社の情報を発信した方がシェアされやすいと思います。</div>
<div> </div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="東京証券取引所マザーズ市場への新規上場承認に関するお知らせ - 株式会社ユーザベース" src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.uzabase.com%2Fpress%2Flisting-aproval%2F" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="http://www.uzabase.com/press/listing-aproval/">www.uzabase.com</a></cite></p>
</div>
<div> </div>
<div>上場当日ももちろんプレスリリースを出した方が良いです。上場当日はセレモニー等の準備でばたばたしていますが、場が開く9時より前には公開できていると良いと思います。</div>
<div> </div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="東京証券取引所マザーズ市場上場のお知らせ" src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.uzabase.com%2Fpress%2Flisting-information%2F" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="http://www.uzabase.com/press/listing-information/">www.uzabase.com</a></cite></p>
</div>
<div> </div>
<div>また同日に、コーポレートサイトのIRページも公開します。（上場日前には公開してはいけません。）</div>
<div> </div>
<div>だいたいのコンテンツは有報などから自動で取得されますが、「株主の皆さまへ」といったコンテンツは自社で用意する必要があります。投資家・株主の方々は事業内容や業績のほかに、社長や従業員のキャラクターも重要視されるので、肩肘張ったものではなくて「らしさ」が出るものが良いと思います。ユーザベースの場合は創業メンバー3人からの『3つの約束』として公開しています。</div>
<div> </div>
<div>
<blockquote>
<div><strong>株主・投資家の皆様へ 3つの約束</strong></div>
<div>
<ol>
<li><strong>「経済情報で、世界をかえる」このビジョンの達成に向けて忠実に行動します。</strong></li>
<li><strong>良い時も悪い時も、正直に話します。</strong></li>
<li><strong>有言実行を積み重ねる事で、信頼を獲得していきます。</strong></li>
</ol>
</div>
</blockquote>
</div>
<div>
<p> </p>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="株主・投資家の皆様へ" src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.uzabase.com%2Fir%2Ftopmessage%2F" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="http://www.uzabase.com/ir/topmessage/">www.uzabase.com</a></cite></p>
</div>
<div> </div>
<div>「社員の顔が見えることが重要」というのは、プロピッカーでもあるレオス・キャピタルワークス 藤野英人さんの記事を参考にしました。この分析については自分の感覚とも合致していてすごく納得感がありました。現在進めているコーポレートサイトリニューアルでも、もっと社員の人となりが見えるものにしていく予定です。</div>
<div> </div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="藤野英人さん「投資家は社員の『顔』が見える企業の株を買いたい」 | 広報会議 2014年11月号" src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fmag.sendenkaigi.com%2Fkouhou%2F201411%2Foffice-pr%2F003567.php" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="http://mag.sendenkaigi.com/kouhou/201411/office-pr/003567.php">mag.sendenkaigi.com</a></cite></p>
</div>
<div> </div>
<div>ちなみに承認発表日は想定以上のトラフィックが来たため、一時的にサイトにアクセスいただけない状態が発生してしまいました。大変嬉しい悲鳴ではありますが、同時にとても恥ずかしいことでもあるので、サイトがダウンする可能性は最大限排除しておきましょう。</div>
<div> </div>
<h3>上場後</h3>
<div> </div>
<div>上場後はより広報的な技量が求められます。上場に伴って増えるメディアや投資家からの面談依頼、兜倶楽部とのお付き合い、適時開示を含めた投資家とのコミュニケーション等々……。</div>
<div> </div>
<div>変わらずにあるのは「どうコミュニケーションすれば自社のファンになってくれるのか」という視点です。ユーザベースは少し変わったかたちのIRとして、を使った個人投資家向けIR活動を開始しています。</div>
<div> </div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="【ユーザベース】最新決算と僕たちのすべて" src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fnewspicks.com%2Fnews%2F1853866%3Fref%3Duser_9317" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="https://newspicks.com/news/1853866?ref=user_9317">newspicks.com</a></cite></p>
</div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="ユーザベース、個人投資家の皆さまに向けたスマホ時代のIRを開始" src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.uzabase.com%2Fpress%2Fuzabse-ir-privateinvestors%2F" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="http://www.uzabase.com/press/uzabse-ir-privateinvestors/">www.uzabase.com</a></cite></p>
</div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="【採録】「BtoBとBtoCを持っているのが強み」 ユーザベース個人投資家説明会リポート 前編" src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fnewspicks.com%2Fnews%2F1932305%3Fref%3Duser_291503" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="https://newspicks.com/news/1932305?ref=user_291503">newspicks.com</a></cite></p>
</div>
<div>
<p><iframe class="embed-card embed-webcard" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="【採録】「メディアは上場すべきか」「株主優待に有料オプションを」などに回答 ユーザベース個人投資家説明会 後編" src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fnewspicks.com%2Fnews%2F1932352%3Fref%3Duser_291503" frameborder="0" scrolling="no"></iframe><cite class="hatena-citation"><a href="https://newspicks.com/news/1932352?ref=user_291503">newspicks.com</a></cite></p>
</div>
<div> </div>
<div>上場というのは会社が変化する極めて大事なタイミングですが、これを活かして「より強い会社をつくる」きっかけにできると良いなと、上場を経て感じました。この記事がこれから上場される皆さまの参考になれば幸いです。</div>
<div> </div>
<p>（この記事は『<a href="http://www.adventar.org/calendars/1929">広報マーケティング Advent Calendar 2016 - Adventar</a>』の8日目の記事です。広報・マーケティング界隈の方のご参加をお待ちしています！） </p></description>          <pubDate>Thu, 08 Dec 2016 17:23:16 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328749687197977231</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/k/kiyohero/20161208/20161208172654.png?1481185638" type="" length="0" />
        </item>
      
    
      
      
        <item>
          <title>CI環境 に関する Tips を共有する勉強会「Web Tech Tokyo #2」を開催しました</title>
          <link>http://tech.uzabase.com/entry/2016/12/05/101546</link>          <description><p>こんにちは。ニューズピックスの大川です。2016年11月14日に、Web系エンジニア同士でTipsを共有しあう交流会 「Web Tech Tokyo」の第2回目をユーザベースで開催しました。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fweb-tech-tokyo.connpass.com%2Fevent%2F43773%2F" title="Web Tech Tokyo #2（CI環境 Tips 共有会） (2016/11/14 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://web-tech-tokyo.connpass.com/event/43773/">web-tech-tokyo.connpass.com</a></cite></p>

<p>このイベントでは、参加者全員がWeb系の開発Tipsを発表し、楽しく議論します。</p>

<p>第2回目は <b>CI環境 をテーマ</b>に、日頃困っていることや成果を出したことについて発表し、交流する場にしました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/h/horobetsu613/20161128/20161128162435.jpg" alt="f:id:horobetsu613:20161128162435j:plain" title="f:id:horobetsu613:20161128162435j:plain" class="hatena-fotolife" itemprop="image"></span>
<span style="font-size: 80%">フリードリンクと軽食を楽しみつつ、和気あいあいと進行します</span></p>

<p><a href="http://tech.uzabase.com/entry/2016/10/28/133638">Web Tech Tkyo #1</a>では12名の方に発表していただき、内容がとてもボリュームのある回でした。</p>

<p>今回はもう少し人数を減らして募集枠を6名とし、「<b>Jenkinsで自動的に画面キャプチャする方法</b>」「<b>テスト文化のない組織にテストを導入した話</b>」など実践的なお話しを発表していただきました。</p>

<p>どの方も熱心に CI環境 に取り組まれているので、かなり収穫が多く密度の高い勉強会になったと思います。シェアいただいたスライドも下記に投稿しておりますので是非ご覧ください。ざっくばらんに話す中で、様々なおもしろい情報を交換するため、その場にいた方が間違いなくおもしろいです！</p>

<p>第3回目は2017年の年明けに開催を予定しております。テーマはまだ決めていませんが、「<b>ユーザー行動ログ解析の実際</b>」や「<b>どの Javascript Framework を選ぶか</b>」のようなテーマで行おうかと考えております。</p>

<p>4〜6名程度の発表者枠に、数名の聴講枠を追加するつもりです。次回もconnpassのページで告知しますので、ご興味のある方は是非ご参加くださいませ！</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fweb-tech-tokyo.connpass.com%2F" title="Web Tech Tokyo" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://web-tech-tokyo.connpass.com/">web-tech-tokyo.connpass.com</a></cite></p>

<h5>公開スライド</h5>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_370405" mozallowfullscreen="true" src="//speakerdeck.com/player/fb1579ae2f814609a3183ce52d26fe80" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/feb0223/jenkinsdewebhua-mian-kiyaputiya">speakerdeck.com</a></cite></p>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_369510" mozallowfullscreen="true" src="//speakerdeck.com/player/e2f66649a9094d7ea7506d2c8fd98cd8" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/leko/rekasinakai-fa-xian-chang-niutworu-reteciwodao-ru-sitahua">speakerdeck.com</a></cite></p>

<p><iframe src="https://www.slideshare.net/slideshow/embed_code/key/iDvLLUMnVrhafF" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/toshihumianan/gcpci" title="GCPでCI環境を構築する" target="_blank">GCPでCI環境を構築する</a> </strong> from <strong><a target="_blank" href="http://www.slideshare.net/toshihumianan">Toshihumi Anan</a></strong> </div><cite class="hatena-citation"><a href="http://www.slideshare.net/toshihumianan/gcpci">www.slideshare.net</a></cite></p>
</description>          <pubDate>Mon, 05 Dec 2016 10:15:46 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328749687196383456</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/h/horobetsu613/20161128/20161128162435.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Docker に関する Tips を共有する勉強会「Web Tech Tokyo #1」を開催しました</title>
          <link>http://tech.uzabase.com/entry/2016/10/28/133638</link>          <description><p>こんにちは。ニューズピックスの大川です。先日、<b>WebTechTokyo</b>というイベントの第1回目をユーザベースオフィスで開催しました。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fweb-tech-tokyo.connpass.com%2Fevent%2F40548%2F" title="Web Tech Tokyo #1（Docker Tips 共有会） (2016/10/12 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://web-tech-tokyo.connpass.com/event/40548/">web-tech-tokyo.connpass.com</a></cite></p>

<p>このイベントでは、参加者全員がWeb系の開発Tipsを発表し、楽しく議論します。</p>

<p>第1回目は Docker をテーマに、日頃困っていることや成果を出したことについて発表し、議論し合う場にしました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/h/horobetsu613/20161027/20161027102203.jpg" alt="f:id:horobetsu613:20161027102203j:plain" title="f:id:horobetsu613:20161027102203j:plain" class="hatena-fotolife" itemprop="image"></span>
<span style="font-size: 80%">会場の様子</span></p>

<p>全員に発表してもらうのは初の試みだったので、ハードルが高すぎて人が集まらないのではないかと不安でしたが、とてもありがたいことに12名の方に参加していただきました！</p>

<p>イベントの開催については何回も経験がありますが、全員が無遅刻無欠席という素晴らしい状況は初めてでした。時間を無駄にすることもなく、熱量をもって発表・議論できたことがとても嬉しかったです。</p>

<p>みなさんにたくさんの資料を共有いただきましたので、この記事の最後で是非ご覧ください。</p>

<p>他にも、残念ながら非公開ですが、「host machine も registry も jenkins も相次いで disk full になった話」「フロントエンドのエンジニアがひとりで環境構築するまでの話」などなど、たくさんの楽しい発表をしていただきました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/h/horobetsu613/20161027/20161027104632.jpg" alt="f:id:horobetsu613:20161027104632j:plain" title="f:id:horobetsu613:20161027104632j:plain" class="hatena-fotolife" itemprop="image"></span>
<span style="font-size: 80%">ビールと軽食をつまみつつ、穏やかな雰囲気で進行しました</span></p>

<p>今回の反省点としては、</p>

<ul>
<li>みなさん、あまりお酒を飲まないのでソフトドリンクを充実させた方が良かった</li>
<li>ピザ・軽食が少し足りなかった</li>
<li>議論（交流）する時間をもっと取りたかった</li>
</ul>


<p>などがあったなと思っておりますので、これは次回必ず改善します！</p>

<p><b>第2回は 11/14（月）</b> を予定しております。<b>テーマは、「CI環境」</b>です。</p>

<p>すこし範囲が大きいテーマですが、「ビルド」「デプロイ」「テスト」などの自動化に関して、みなさんがどうしているか、何に困っているか、どういうツールを導入しているか、などなどを発表・議論していけたらと思っています。</p>

<p>connpassのページで告知しますので、ご興味のある方は是非ご参加ください！</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fweb-tech-tokyo.connpass.com%2F" title="Web Tech Tokyo" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://web-tech-tokyo.connpass.com/">web-tech-tokyo.connpass.com</a></cite></p>

<h5>公開された資料</h5>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_363274" mozallowfullscreen="true" src="//speakerdeck.com/player/15b4797783ce4e1b8823400cf0cd776c" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/kotatsu360/docker-with-packer">speakerdeck.com</a></cite></p>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="596" id="talk_frame_363199" mozallowfullscreen="true" src="//speakerdeck.com/player/5492fd03398548edb3ed0466c9665bb3" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/y13i/alpine-linux-falsesusume">speakerdeck.com</a></cite></p>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="596" id="talk_frame_363267" mozallowfullscreen="true" src="//speakerdeck.com/player/f381e1707b224583b39239cf152736c2" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/himaoka/sysdigshi-ouze-kontenaziyanakutemo">speakerdeck.com</a></cite></p>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_363211" mozallowfullscreen="true" src="//speakerdeck.com/player/99f5a025bdb546449c14cf4ae0c4f6ad" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/dtan4/web-tech-tokyo-number-1">speakerdeck.com</a></cite></p>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_363130" mozallowfullscreen="true" src="//speakerdeck.com/player/e86eec55af364e4181be00f9881e802d" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/hoshinotsuyoshi/hatutichu-li-tehakowoshi-uhua">speakerdeck.com</a></cite></p>
</description>          <pubDate>Fri, 28 Oct 2016 13:36:38 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328749687191490863</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/h/horobetsu613/20161027/20161027102203.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>エンジニア向けMeetupイベントレポート　第4回：『大規模サービスを支えるインフラ』</title>
          <link>http://tech.uzabase.com/entry/2016/07/21/102954</link>          <description><p>こんにちは！SPEEDA Techチームの清水です。<br>
<br>
毎月開催してきたユーザベース Meetupも、ついに第4回を数えました。<br>
回を重ねていくうちにノウハウも溜まってきております。<br></p>

<h3>開催内容：『大規模サービスを支えるインフラ』</h3>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F33709%2F" title="UZABASE Meetup#4 〜大規模サービスを支えるインフラ〜 (2016/07/07 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/33709/">uzabase-meetup.connpass.com</a></cite></p>

<p>今回は CTOの杉浦が司会を務めました。
ぜ、ぜんぜん滑ってなんてないんだからね！
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160719/20160719094340.jpg" alt="f:id:kaonash:20160719094340j:plain" title="f:id:kaonash:20160719094340j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>さて、第3回に引き続き、今回も外部からスペシャルゲストをお招きいたしました。<br>
ファッションアプリiQONを開発するVASILYさんのインフラエンジニアを担当している光野さんにご登壇いただきました。<br>
実はVASILYさんは、ユーザベースが入っているビルの下の階にオフィスを構えているというご近所さん。そのご縁もあって時折エンジニア同士の交流をしており、今回も登壇をお願いいたしました。
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160719/20160719094402.jpg" alt="f:id:kaonash:20160719094402j:plain" title="f:id:kaonash:20160719094402j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>内容はPackerやChefを活用して開発環境と本番環境を同じVMイメージから一括作成するというもの。自動化素晴らしい。<br>
<iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_350631" mozallowfullscreen="true" src="//speakerdeck.com/player/3f0048e00cb2495ab5920b139bd6547a" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/kotatsu360/create-prod-and-dev-vm-image-atst-by-packer">speakerdeck.com</a></cite>
以前、Vasilyさんの他の社員の方のプレゼンを見た時にも感じましたが、みなさんプレゼンがうまい！
<br>
ユーザベースも魅力的なプレゼンが出来るように頑張らねばと刺激をいただきました。<br>
<br>
ユーザベースからも、それぞれSPEEDAとでインフラを担当しているエンジニアが登壇いたしました。<br>
SPEEDAはオンプレ、はAWSを使用しているため、お互い異なるノウハウや悩みがあり、どのように課題を解消しているのかについて発表をしてもらいました。<br></p>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/fPX8utv3Y1LNWc" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<iframe src="//www.slideshare.net/slideshow/embed_code/key/kw1X4Ypmukv3xe" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p>そしてお決まりのビールとピザで懇親会がスタート！<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160719/20160719094416.jpg" alt="f:id:kaonash:20160719094416j:plain" title="f:id:kaonash:20160719094416j:plain" class="hatena-fotolife" itemprop="image"></span>
懇親会では、いつも様々なバックグラウンドをもつ方と交流を深めることができ、大変有意義な時間となっており、今回も非常に実りある時間となりました。</p>

<h3>今後の予定</h3>

<p>ユーザベースでは定期的にMeetupイベントを開催しています。<br>
次回は調整中ですが、8月下旬に開催をする予定です。<br>
詳細が決まり次第connpassで募集を開始いたしますので、まだ参加をしたことがない方やリピーターの方も、ぜひ遊びに来てください！</p>
</description>          <pubDate>Thu, 21 Jul 2016 10:29:54 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/6653812171406238951</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160719/20160719094340.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>子育てと仕事を両立できる、ユーザベースでの働き方とは</title>
          <link>http://tech.uzabase.com/entry/2016/07/19/121312</link>          <description><p>こんにちは、インフラチームの小林です。</p>

<p>僕は、仕事と子育てを両立させながら働くエンジニアです。本当に両立できるのか、今回はユーザベースでの働き方についてご紹介します。</p>

<p>我が家は夫婦共働きで、5歳と2歳の娘がいます。</p>

<p>妻は今年の4月に復職が決まり、次女にも保育園に通ってもらうことになりました。保育園探しは大変で、やっと決まって安心したのもつかの間、1日目から長時間あずかってもらえるわけではないということに気付きました。</p>

<p>保育園に通うことを慣れてもらうための、「慣らし保育」というものがあったのです。</p>

<p>この期間中、次女のお迎え時間はお昼過ぎ。近くに親族もいないし、妻は復職します。さあどうしよう。悩んだ末、「僕が在宅勤務をする」という選択肢を選びました。育児・家事も分担制にして、朝は僕が家事や洗濯、登園準備を担当し、夜は妻にバトンタッチすることにしたのです。</p>

<h4><b>自由と無責任は違う</b></h4>

<p>僕が在宅勤務という選択をするにあたり、強く印象に残っている代表の梅田の言葉があります。</p>

<p>「仕事だけの人生ってつまらないよね。プライベートも大事にして、仕事とプライベートを高次元でバランスさせて、互いが原動力となり両輪がしっかりとまわっていく。そんな状態が理想だし、それを実現させるために起業したんだ。だから、生産性の向上をひたすら追及し、みんなが高いパフォーマンスを発揮することによって世界一休みが多い会社にしたい。」</p>

<p><iframe src="http://tech.uzabase.com/embed/2015/01/15/102658" title="世界一ハッピーでワクワクする会社を目指して ～SPEEDA, を生んだ企業文化～ - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2015/01/15/102658">tech.uzabase.com</a></cite></p>

<p>もちろん、在宅勤務は休みではありません。会社という場所にとらわれずに働くという選択肢です。だけど、子育てというプライベートを大切にしながら働きたい、そう思ったときに梅田の言葉が背中を押してくれました。</p>

<p>とはいえ、自分が達成すべき仕事にコミットしなければ、在宅勤務で子育てをするという僕の願いはかないません。きちんと責任を果たしたうえで、望みがかなう。個人的には、この順番を間違えてはいけないと肝に銘じ、在宅勤務でも結果を出すことで、周りも前向きに協力してくれると考えました。</p>

<h4><b>チームメンバーに感謝</b></h4>

<p>エンジニアという職業に就いている方は、「いやいや、そうは言っても顔を合わせて仕事をしないと厳しいときもあるでしょ」と思うでしょう。実際、在宅勤務を始めたときは、まさに佳境でした。スケジュールもタイトで、家にいると作業効率も落ちてしまう。</p>

<p>しかも、僕が在宅勤務になることで、他のメンバーにも仕事の引き継ぎが発生。「これは本当にフェアなのだろうか」という疑問があり、正直、在宅勤務を決めたことへの後ろめたさがありました。</p>

<p>その複雑な胸の内を、勇気をもってチームメンバーに話したんです。すると、反対どころか「ぜひ在宅勤務をしてください」と応援してくれて。本当に感謝の気持ちでいっぱいでした。</p>

<p>今後、子育てをするメンバーが増えてきたとき、僕は「大丈夫！僕もそうやってやってきた！」と伝えたい。みんなが胸を張って子育てに向かえるよう、後押しするのが最低限の恩返しだと思っています。</p>

<h4><b>育児と仕事の葛藤</b></h4>

<p>そうして、僕の在宅勤務が始まり、育児と仕事の両立という貴重な経験を積むなかで、改めて「子育て」と「時間通りに働くこと」のバランスをとることの難しさを実感しました。</p>

<p>娘を送り出した後、仕事に集中できたと思えば、あっという間にお迎えの時間。お迎えに行くと、娘は僕の顔を見るなり号泣するので、つきっきりであやさないといけない。やっと寝かしつけたとしても、一緒に寝落ちしてしまうこともしばしば。仕事に集中できる時間が本当に限られてしまったのです。</p>

<p>育児に「時間」という概念が入ると、急に難易度が上がります。朝のバスの時間、お迎えの時間など、いつも会社で仕事をしていること以外に決められた時間があるのは、想像以上に大変です。</p>

<p>それに、子ども相手に無駄を省いて効率的に動こうとすれば痛い目をみます。特に次女は、自我が芽生えてきた時期なので、着替えなどを手伝おうとすると「自分でやりたい」と大泣きし、予想以上に時間がかかってしまう。だから、決まった時間にすべてをこなすためには、相当な余裕を持った行動が必要でした。</p>

<p>こうした経験から、育児をしながら仕事をするには、かなり時間が限られるということが分かりました。子どもたちがいない時間が唯一仕事に集中できる。でもその前後は、まったく時間が取れない。当然、仕事に集中できる時間以外に対応しないといけない仕事もあるので、なかなか大変です。</p>

<p>もちろん、「もっと仕事をしたい」という気持ちはあります。だけど、僕にとって子育ては同じかそれ以上にやりたいこと。最近では、仕事と家族との時間の切り替えをうまくやることで、メリハリをつけながら働けるようになりました。</p>

<p>何より、ワークライフバランスとは、仕事とプライベートの陣取り合戦ではなく、お互いに補完し合うものなのだということが分かったのは収穫です。</p>

<p>ユーザベースという会社は、自分がコミットした仕事を全うし結果を出せば、働く時間も場所も自由です。出社義務もありません。そのような環境だからこそ、仕事とプライベートを高次元でバランスさせて、互いが原動力となり、仕事と育児という両輪をしっかりとまわすことができたのです。</p>

<p>あのとき、僕が在宅勤務をするという選択をして本当によかった。</p>

<p>人生は一度きりです。仕事もプライベートも両立させてこそ、豊かな人生になるのではないかと思います。最初は大変でしたが、学びも多く、毎日出社しているだけではわからない世界も知りました。だから、少しでも興味を持ってくれたなら、ユーザベースに遊びに来て欲しい。ぜひ一緒に働いてみませんか？</p>

<p>応募に関する詳細はこちら：www.wantedly.com
<iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F59258" title="世界に通じるビジネス基盤のインフラを支えたい方、募集中！ by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/59258">www.wantedly.com</a></cite></p>
</description>          <pubDate>Tue, 19 Jul 2016 12:13:12 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/6653812171404145835</guid>
          
          <enclosure url="http://cdn.mogile.archive.st-hatena.com/v1/image/uzabase/302456199552088609.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>エンジニア向けMeetupイベントレポート　第3回：『チームの生産性を向上させる』</title>
          <link>http://tech.uzabase.com/entry/2016/07/01/131328</link>          <description><p>SPEEDA Techチームの清水です。<br>
<br>
連日のユーザベースMeetupレポート、第3弾です。(連日更新しているのは今まで更新をさぼっていたからですごめんなさい)<br>
第1回、第2回レポートはこちら↓
<iframe src="http://tech.uzabase.com/embed/2016/06/29/024236" title="エンジニア向けMeetupイベントレポート　第1回：『/SPEEDA「高速」成長の秘密』 - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2016/06/29/024236">tech.uzabase.com</a></cite>
<iframe src="http://tech.uzabase.com/embed/2016/06/30/100159" title="エンジニア向けMeetupイベントレポート　第2回：『Java開発最前線』 - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2016/06/30/100159">tech.uzabase.com</a></cite></p>

<h3>開催内容：『チームの生産性を向上させる』</h3>

<p>今回のテーマは「チームの生産性を向上させる」です。<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F31833%2F" title="UZABASE Meetup#3 〜チームの生産性を向上させる〜 (2016/06/02 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/31833/">uzabase-meetup.connpass.com</a></cite></p>

<p>第3回では、初の試みとして社外から登壇者をお招きしました。<br>
ライブ共有型スポーツニュースアプリ「Player!」を開発するスタートアップ、ookamiさんよりCTOの中村さんをお招きして、Githubを中心とした「Player!」の開発手法についてお話いただきました。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160624/20160624170647.jpg" alt="f:id:kaonash:20160624170647j:plain" title="f:id:kaonash:20160624170647j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<script async class="speakerdeck-embed" data-id="e40ac595793c416d912c5d2cebae119f" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>


<p>その他にも弊社エンジニアからユーザベースでのチーム開発の進め方やSlackを用いたChatopsの発表も行い、生産性向上への取り組みについて熱く語ってもらいました。<br>
参加者の方々もいつも以上にたくさんの質問を登壇者に向けて投げかけていたのが印象的でした。<br></p>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/gVvievLR4IFaSx" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<iframe src="//www.slideshare.net/slideshow/embed_code/key/d76D0f1WLzgtW" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<h3>発表後のお楽しみ</h3>

<p>そして懇親会。
お決まりのピザ&amp;エビスビールです。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160701/20160701130952.jpg" alt="f:id:kaonash:20160701130952j:plain" title="f:id:kaonash:20160701130952j:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
終了後には運営に協力してくれたメンバーで記念撮影。ユーザベースTシャツで統一してみました。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160701/20160701131001.jpg" alt="f:id:kaonash:20160701131001j:plain" title="f:id:kaonash:20160701131001j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h3>次回告知</h3>

<p>第4回は7月7日の七夕に行います。テーマは「大規模サービスを支えるインフラ」です。<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F33709%2F" title="UZABASE Meetup#4 〜大規模サービスを支えるインフラ〜 (2016/07/07 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/33709/">uzabase-meetup.connpass.com</a></cite></p>

<p>恵比寿で皆さんとお会いできるのを楽しみにしています！</p>
</description>          <pubDate>Fri, 01 Jul 2016 13:13:28 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792370971084</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160624/20160624170647.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>エンジニア向けMeetupイベントレポート　第2回：『Java開発最前線』</title>
          <link>http://tech.uzabase.com/entry/2016/06/30/100159</link>          <description><p>SPEEDA Techチームの清水です。<br>
<br>
先日レポートいたしましたユーザベースMeetup、第2回目のレポートをお届けします。<br>
第1回レポートはこちら↓
<iframe src="http://tech.uzabase.com/embed/2016/06/29/024236" title="エンジニア向けMeetupイベントレポート　第1回：『/SPEEDA「高速」成長の秘密』 - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2016/06/29/024236">tech.uzabase.com</a></cite></p>

<h3>開催内容：『Java開発最前線』</h3>

<p>第1回目Meetup開催の1ヶ月後、ユーザベースのメイン開発言語であるJavaをテーマとして第2回を開催しました。<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F29952%2F" title="Java開発最前線 - UZABASE Meetup#2 (2016/04/28 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/29952/">uzabase-meetup.connpass.com</a></cite></p>

<p>第2回目も大盛況で、前回から応募枠を大幅に増やしたにも関わらず、すぐに満員となりました。ありがとうございます！<br>
ユーザベースでは開発に使用するJavaのバージョンはすべて最新のJava8に更新済みで、その中で最新の機能をどのように活用しているかという点にスポットをあてた発表となりました。<br>
また、もともとRubyをこよなく愛していた弊社エンジニアが、いかにJavaを(も？)愛するようになったかという発表もあり、これもなかなか興味深い内容でした。<br></p>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/5Nh2q6rfFcl6o7" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<script async class="speakerdeck-embed" data-id="61841c27732f4659b88cc3f8837a26c3" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>


<iframe src="//www.slideshare.net/slideshow/embed_code/key/BOpFRufiWrU2XS" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p>第1回の「ちょっと発表が多すぎて疲れるかも」という反省をいかし、今回から発表枠は基本3つまでというスタイルにしました。<br>
終わった後はピザとビールで乾杯！(そして写真を撮り忘れる・・・)<br>
ご参加頂いた方、ありがとうございました！</p>

<h3>今後の予定</h3>

<p>前回のレポートでもお伝えしましたが、ユーザベースでは定期的にMeetupイベントを開催しています。<br>
次回は7月7日の七夕、「大規模サービスを支えるインフラ」というテーマで開催します！<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F33709%2F" title="UZABASE Meetup#4 〜大規模サービスを支えるインフラ〜 (2016/07/07 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/33709/">uzabase-meetup.connpass.com</a></cite>
6月30日現在、すでに枠は埋まっていますが、まだいけるかも・・・ぜひお気軽に参加ボタンを押してください！</p>
</description>          <pubDate>Thu, 30 Jun 2016 10:01:59 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/6653812171403193024</guid>
          
          <enclosure url="https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>エンジニア向けMeetupイベントレポート　第1回：『/SPEEDA「高速」成長の秘密』</title>
          <link>http://tech.uzabase.com/entry/2016/06/29/024236</link>          <description><p>こんにちは、SPEEDA Techチームで新規機能開発を担当しています清水です。<br>
<br>
ユーザベースでは今、定期的にエンジニア向けにMeetupイベントを開催しています！<br>
3月に開催をした第1回目から、ほぼ月1回のペースで開催しており、すでに開催数は3回を数えています。<br>
<br>
今回はMeetupイベントの目的と、第1回の開催内容をレポートします。<br>
(追って第2回・第3回のレポートもアップしますのでお楽しみに！)
<br></p>

<h3>目的</h3>

<p>弊社では、様々な先進的な取り組みをしているにも関わらず、なかなか「技術の会社」として認識をしてもらえていなかったりします。<br>
なかには「サービスは外注していると思っていました」とおっしゃる方も・・・。<br>
さすがにこれはまずいということで、もっとユーザベースという会社やカルチャー、雰囲気、そして社員のことを知ってもらうため(さらに言えば優秀なエンジニアの採用に繋げるため)、Meetupイベントを企画することになりました。<br></p>

<h3>開催内容：『/SPEEDA「高速」成長の秘密』</h3>

<p>記念すべき第1回目は「高速化」をテーマに開催しました。<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F28036%2F" title="/SPEEDA「高速」成長の秘密 - UZABASE Meetup#1 (2016/03/25 19:00〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/28036/">uzabase-meetup.connpass.com</a></cite></p>

<p>正直、「本当にみんな来てくれるんだろうか・・・」と不安でいっぱいでしたが、最終的には参加枠を大幅に上回るお申し込みをいただきました！<br>
第1回ということでユーザベースのチーフテクノロジスト竹内やのCTO(ちょうどこの日就任した)杉浦らが登壇。<br>
「高速化」という幅広いテーマも手伝って、ユーザベースで採用している全文検索エンジンElasticsearchの話から自動テスト、高速開発の話まで、バラエティに富む内容で発表させていただきました。<br>
なかには当時開発中だったの新機能に関する発表もあり、盛りだくさんの内容となりました。</p>

<script async class="speakerdeck-embed" data-id="cdb7490b22af4ff7a369f04bde4900e1" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<script async class="speakerdeck-embed" data-id="f0d9c82bab0d4536808883c13cbcfe37" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<script async class="speakerdeck-embed" data-id="95117b3ac70c457e88ed2f5171655789" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<script async class="speakerdeck-embed" data-id="c7c15e74a2cc4f4d8e84cc224a88a377" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>


<script async class="speakerdeck-embed" data-id="cbc523f3f74344c39793782272299ed9" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>


<p>また、ユーザベースの外部パートナーでありClojureのContributorでもある株式会社シェルフ代表の矢野さんより、『オープンソース開発のすすめ』という内容でLTも行っていただきました！<br>
<span style="font-size: 200%"><a href="https://slideck.io/github.com/tyano/lightning_talks/join_to_open_source.md#/">オープンソース開発のすすめ</a></span></p>

<h3>発表後のお楽しみ</h3>

<p>ユーザベースMeetupでは、発表の後に参加者の皆さんと親睦を深める目的で懇親会を開催しています。<br>
懇親会では、ピザとエビスビール(もちろんお茶もあります)をご用意しています！<br>
こちらは懇親会の様子。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160627/20160627165330.jpg" alt="f:id:kaonash:20160627165330j:plain" title="f:id:kaonash:20160627165330j:plain" class="hatena-fotolife" itemprop="image"></span>
けっこう多めにピザをご用意しているはずなんですが、無くなるのが早い早い・・・現在ピザの増量を検討中です。<br></p>

<h3>今後について</h3>

<p>今後も定期的にMeetupイベントを開催していく予定です。<br>
取り急ぎ、次回は7月7日の七夕、「大規模サービスを支えるインフラ」というテーマで開催します！<br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fuzabase-meetup.connpass.com%2Fevent%2F33709%2F" title="UZABASE Meetup#4 〜大規模サービスを支えるインフラ〜 (2016/07/07 19:30〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://uzabase-meetup.connpass.com/event/33709/">uzabase-meetup.connpass.com</a></cite></p>

<p>今回も(大変ありがたいことに)すでに席が埋まってしまっていますが、直前で一定数キャンセルが出ることを考えると、まだギリギリ入れるはず・・・ぜひふるってご参加ください！</p>
</description>          <pubDate>Wed, 29 Jun 2016 02:42:36 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/6653812171403112073</guid>
          
          <enclosure url="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kaonash/20160627/20160627165330.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title> Hinemos5.0.1移行記（その2：保守サービスとエンタープライズオプションを契約） </title>
          <link>http://tech.uzabase.com/entry/2016/04/28/121633</link>          <description><p>ユーザベース インフラチームの小林です。</p>

<p>だいぶ時間が空いてしまいましたが、「<a href="http://tech.uzabase.com/entry/2016/03/11/155758">Hinemos5.0.1移行記（その1：理想と現実の葛藤）</a>」の記事から引き続き、Hinemos5.0.1への移行のお話です。</p>

<p><br><br></p>

<h2>前回のおさらい</h2>

<p>Hinemos環境をバージョンアップするために、以下の流れで行うことを考えていました。</p>

<ol>
<li><p>   Hinemos5Managerを新規構築 、動作検証</p></li>
<li><p>   Hinemos3のデータをHinemos5に移行</p></li>
<li><p>   Hinemos3からHinemos5への順次切り替え</p></li>
</ol>


<p>しかし、実際には思っていた通りにいかないことが判りました。</p>

<p>具体的には、3番目の「Hinemos3からHinemos5への順次切り替え」の部分で、以下の問題がでてきたというお話でした。</p>

<ul>
<li><p>Agent用にサポート対象バージョンのOpenJDKを入れるか、OracleJDK1.8を使い続けるか。</p></li>
<li><p>Hinemos3とHinemos5のAgentが同居できるといっても、どちらかのインストールディレクトリを変えないといけない。</p></li>
</ul>


<p><br><br></p>

<h2>救世主が現る</h2>

<p><a href="http://tech.uzabase.com/entry/2016/03/11/155758">前回の記事</a>にも書いてありますが、<A Href="http://atomitech.jp/">アトミテック</A>さんが上記の問題を解決してくれました。<br>
もともと、Hinemos5が出る前から、データ移行の相談を何回かしておりました。
その際に、すごく頼りになりそうだったので<br>
「データ移行＋移行時のトラブルサポート」という形で、今回依頼をいたしました。<br>
結果的にそれが大正解で、本当にいろいろなことをサポートしていただきました。<br>
<br>
特に、OpenJDKを入れるかOracleJDK1.8を使い続けるかという問題を解決するうえで、非常に助かりました。
既存の環境で使用しているOracleJDK1.8を使い続けたかったのですが、これを短時間で動作検証するのは私達には不可能でした。<br>
しかし、快く<A Href="http://atomitech.jp/">アトミテック</A>さんにご対応いただけたおかげで、OracleJDK1.8でもHinemos5.0の動作が一通り問題ないことが判りました。<br>
当然ながら自己責任の上で、弊社環境ではOracleJDK1.8でHinemos5.0のAgentを動かしてます（今のところ不具合はありません）。<br>
<br>
OracleJDK1.8でHinemos5.0のAgentを動かすにあたって、何個か落とし穴がありましたが、そこら辺もご対応をいただいてます（起動shellにJavaのバージョンチェックがあったりなど）。
<br></p>

<h2>移行できたよ！</h2>

<p>問題を踏まえた上で、HinemosのAgentは以下の手順で切り替えることになりました。</p>

<ol>
<li><p>   Hinemos3.1のAgentのインストールディレクトリ変更</p></li>
<li><p>   Hinemos5.0のAgentをOracleJDK1.8で起動</p></li>
<li><p>   Hinemos3.1からHinemos5.0への順次切り替え</p></li>
</ol>


<p><br>
Hinemos3.1のAgentの変更に当たっては、Agentの再起動が入るのでできるだけ既存のジョブに影響が出ないように調整しながら行いました。
Hinemos5.0のAgentは既存のジョブがないので、一括で作業をしました。<br>
ジョブの順次切り替えは、前回書いたように各ジョブネットは簡単な仕組みで連携していたため、一つのジョブネットがうまくいったら、Hinemos3側のスケジュールを無効化、Hinemos5側のスケジュールを有効化しながら、代替1ヶ月くらいかけて切り替えることができました。
<br>
<br>その途中でもいろいろとあったのですが（Nagiosの監視用スクリプトのVerUpや、エラー時のジョブの挙動が変わってた事など）、一つ一つ真摯にご対応いただけたおかげで、非常にスムーズに作業が進みました。
<br></p>

<h2>結果、保守サービスとエンタープライズオプションの契約を結ぶ事に</h2>

<p>おかげで、無事にHinemos5への移行ができたのですが、あまりにも真摯に対応していただいたので、<A Href="http://atomitech.jp/">アトミテック</A>さん経由でHinemosの保守サービスとエンタープライズオプションの契約を結ばせていただきました。<br>
<br>
保守サービスとエンタープライズオプションを契約すると、以下のメリットがあります。</p>

<ul>
<li>修正パッチを提供してもらえる<br>
<span style="color: #1464b3">→今回で言うと、Hinemos5.0.2のリリース前に、Hinemos5.0.1のメモリリークの修正パッチが提供されて、事前にその不具合を解消する事ができました。
</span></li>
<li><p>エンタープライズオプションが使えるようになる</p></li>
<li><p>Hinemosでわからない事を相談できる</p></li>
</ul>


<p>分からない事を相談できるという点が有難く、Hinemosの情報を検索しても出てこないことが多いのですが、何が起きても聞ける環境があると思えるだけで大きな安心感があります。<br>
<br>
個人的に嬉しいのは、エンタープライズオプションを使って、更にHinemosの使える幅が広がりそうなので、いろいろ試していきたいと思ってます。<br>
Hinemosの情報が意外と少ないので、弊社ブログでもHinemosユーザーの皆さんに有益な情報を発信できればと思っています。<br></p>

<p><br></p>

<h2>今回の移行で思った事</h2>

<p>今回移行をしてみてすごく実感したのが、「やはり、あまり一つの製品で凝った仕組みを作らない方が良いな」ということでした。<br>
Hinemosの機能を試したいと言っておきながら矛盾する話ではありますが、うちはHinemosを使いこなしていなかったおかげで、移行に大きな工数がかからずに済んだと思っています。<br>
Hinemosは確かに便利でまだまだ使いこなせる余地があると思っていますし、他の有償版のジョブ監視ツールももっと細かいところができるかもしれません。<br>
この「細かいところ」が肝で、このせいで移行が大規模や製品選定のネックになる事が多い気がしています。<br>
<br>
弊社のジョブの組み方は、最低限のジョブネットを作って、各ジョブネット間はファイル連携という単純な仕組みを用いています。<br>
このファイル連携も、shellでファイル作成とファイル監視をしているので、Hinemosからみたらジョブの実行をしているだけになります。<br>
おかげで、ジョブの切り替えタイミングに余裕を持たせることができたので、私を含めて2～3人程度でも余裕を持って切り替えることができたと思っています。<br>
もし、この組み方がジョブ監視ツールの機能で、全部ジョブの前後関係を組んでいた場合、異なるHinemos間での先行条件はできないので、一括で変更をしないといけない状態でした。<br>
<br>
極端な話をすれば、Hinemosから別製品に載せ替えることもできたと思います（ジョブデータの変換できればですが）。<br>
<br>
そこら辺の自由度は最大限残しておくためにも、あまり凝った機能を使わずに、できるだけ単純な部分を組み合わせるのが良いのではないか、と実感した次第です。<br>
<br>
そうはいっても、便利な機能は使うべきだと思うので、そこら辺を意識しながら、あまり依存しすぎることのないように使っていくことが大事かなと考えています。<br></p>

<h2>今後の要望</h2>

<p>上でいろいろ書きましたが、私自身はHinemosと末永く付き合うつもりでいます。<br>
今後も長くおつきあいする上で、今回の移行で引っかかった以下の点を実現してもらえると、次回（何年後か判りませんが）のHinemosバージョンアップ作業のハードルがだいぶ下がるはずなので是非お願いしたいところです。</p>

<ul>
<li>インストールディレクトリを/opt/hinemos_XXXみたいなバージョンごとに分けてほしい</li>
<li>Agentをインストールするときに、OpenJDKを/opt/hinemos_XXX以下に一緒に入れてほしい</li>
</ul>


<p><br>
<br></p>

<h2>エンタープライズオプションのExp/Imp機能の画面紹介</h2>

<p>簡単に、エンタープライズオプションで使いたかったExp/Impについて紹介します。<br>
このおかげで、ジョブの修正の工数が大幅に縮小されました。<br>
<br>
オプションをインストールすると、こんな感じでメニューが増えます。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420202629.png" alt="f:id:manabu-kobayashi:20160420202629p:plain" title="f:id:manabu-kobayashi:20160420202629p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
エクスポート・インポートの設定は、クライアント設定の画面から確認や変更ができます。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420202656.png" alt="f:id:manabu-kobayashi:20160420202656p:plain" title="f:id:manabu-kobayashi:20160420202656p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>実際の画面はこんな感じ。ここらへんで、エクスポート・インポート・差分比較ができます。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420202707.png" alt="f:id:manabu-kobayashi:20160420202707p:plain" title="f:id:manabu-kobayashi:20160420202707p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>変更用のExcelの画面はこんな感じで、<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420202717.png" alt="f:id:manabu-kobayashi:20160420202717p:plain" title="f:id:manabu-kobayashi:20160420202717p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>出力した内容との差分比較は、このようなCSVファイルで出力されて、変更されたところが一目でわかります
（自分の作業が想定通りか一目でわかって便利です）。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420202911.png" alt="f:id:manabu-kobayashi:20160420202911p:plain" title="f:id:manabu-kobayashi:20160420202911p:plain" class="hatena-fotolife" itemprop="image"></span></p>
</description>          <pubDate>Thu, 28 Apr 2016 12:16:33 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792370893698</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160420/20160420200927.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>：記事をオススメするLINE BOTをつくってみた</title>
          <link>http://tech.uzabase.com/entry/2016/04/15/140513</link>          <description><p>はじめまして。技術チームの井原です。</p>

<p>チャットボット（Bot）という言葉を聞いたことがあるでしょうか。スマホやWebのメッセンジャー上で動く自動会話ロボットで、4/7にLINEが<a href="https://business.line.me/ja/products/4/introduction">BOT API Trial</a>を公開したことでエンジニア界隈で一躍ホットなトピックとなりました。今週にはFacebookが対応を発表し、でも話題になりました。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fnewspicks.com%2Fnews%2F1496965" title="FacebookがMessengerのチャットボットのプラットフォームを発表" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://newspicks.com/news/1496965">newspicks.com</a></cite></p>

<p>私もBOT API Trialの公開で大喜びしたクチで、さっそく週末と帰宅後の時間でLINE BOTを作ってみました。</p>

<h1>うま</h1>

<p>こちらが作成したBotです。「うま」（非公式Bot）といいます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414174014.png" alt="f:id:ryoju:20160414174014p:plain" title="f:id:ryoju:20160414174014p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>ユーザーが知りたいことをうまに伝えると、良さそうなの記事を探してお教えします。記事の内容が気になったら、画像をタップするとページが開きます。</p>

<p>さて、うまがどういうふうにできているのかご説明いたしましょう。</p>

<h1>インフラ環境</h1>

<p>うまはAWSで動いています。EC2（w/ Elastic IP） + ELB + CloudFront + Certificate Manager + Route 53という構成です。Certificate Managerを使うためにバージニア北部のリージョンで動かしています。</p>

<p>LINE BOTを動かすために以下の対応が必要でした。</p>

<ul>
<li><p>LINE BOTのコールバックを受けるためにはSSLが必須で、かつ<a href="http://qiita.com/git6_com/items/008404506836011af33b">証明書を選り好みする</a>ため、Certificate Managerの証明書を使っています。私が所有しているドメインに対して作成した証明書をCloudFrontに紐付けて、さらにCloudFrontのエンドポイントをRoute 53のAレコードで設定しています。ここの設定に苦労したので、キャプチャを貼付しておきます。よかったら参考にしてください。</p>

<ul>
<li>Certificate Manager<br>コールバックURLに使いたいドメインで証明書を作成します。ワイルドカードである必要はありません。<Br><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414202224.png" alt="f:id:ryoju:20160414202224p:plain:w400" title="f:id:ryoju:20160414202224p:plain:w400" class="hatena-fotolife" style="width:400px" itemprop="image"></span></li>
<li>CloudFront<br>ディストリビューションを作成し、証明書を設定します。CNAMEにもコールバックURLのドメインを設定します。<br><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414202227.png" alt="f:id:ryoju:20160414202227p:plain:w400" title="f:id:ryoju:20160414202227p:plain:w400" class="hatena-fotolife" style="width:400px" itemprop="image"></span></li>
<li>Route 53<br>ドメインのAタグにディストリビューションを設定します。<br><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414202230.png" alt="f:id:ryoju:20160414202230p:plain:w200" title="f:id:ryoju:20160414202230p:plain:w200" class="hatena-fotolife" style="width:200px" itemprop="image"></span></li>
</ul>
</li>
<li><p>LINE BOTはAPIの呼び出し元のIPアドレスを事前に登録しておく必要があり、固定グローバルIPが必要となります（可変だと突然呼び出しが通らなくなるおそれがある）。そのためにElastic IPをEC2インスタンスに付けています。</p></li>
</ul>


<p>ちなみに、私はさくらのVPSを1台契約しており、最初はそれを使おうとしたのですが、証明書の問題でうまくいきませんでした。仕方なくAWSに環境を作って、開発中のプログラム一式も移したという経緯がありました。おそらくLINE BOT APIのサーバ側でチェックしているのでしょうが、無償で取れるSSL証明書ではこちらの用意したコールバックURLを呼んでくれない（？）ようで、GMO GlobalSignの試用証明書、EcoCertの試用証明書と試したのですが、いずれもうまくいきませんでした。SSL証明書はLINE BOTを作ろうとする趣味プログラマのハードルとなっていて、BOT API Trialの公開から数日は「この証明書なら大丈夫」「これはダメ」みたいな話題が多かったです。</p>

<h1>メッセージの処理と記事推薦</h1>

<p>ユーザーが知りたいことを送信してから、うまが記事を提示するまでの流れは以下のようになっています。</p>

<ol>
<li>形態素解析</li>
<li>特徴語抽出</li>
<li>記事の検索</li>
<li>記事の選択</li>
<li>記事の提示</li>
</ol>


<p>また、大まかなデータのやりとりはこのような形になります。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414213825.png" alt="f:id:ryoju:20160414213825p:plain" title="f:id:ryoju:20160414213825p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h3>1. 形態素解析</h3>

<p>ユーザーがLINEでうまとのトークを開始し、知りたいことを入力すると、LINEのサーバを経由してコールバックURLへ<a href="https://developers.line.me/bot-api/api-reference#receiving_messages">テキストメッセージ</a>がPOSTされます。テキストメッセージからユーザーの入力した知りたいことを取り出して形態素解析を行い、単語に切り分けます。
形態素解析エンジンにはMeCabとIPA辞書（オフィシャルサイトで配布されているもの）を使っています。</p>

<h3>2. 特徴語抽出</h3>

<p>ユーザーは自然な（口語的な）表現で知りたいことを入力するため、検索の前処理として不要な単語を落としています。ここはバリエーションの考えられる処理ですが、現状では単純に名詞だけを残し、それ以外の品詞はすべて落としています。</p>

<p>ただ、ログを見るとやはり適切ではない分割をされているケースが多いです。が経済ニュースアプリであるためか、企業名等の固有名詞をメッセージに含む場合が多いのですが、分割しすぎているケースが頻繁に見られます。提示するニュースの適切さをあげるには、ここの改善が大事だなという印象があります。企業・業界情報プラットフォームである<a href="https://www.uzabase.com/speeda/">SPEEDA</a>の辞書を使えばもっと良くなるかもしれません。</p>

<h3>3. 記事の検索</h3>

<p>抽出された特徴語を用いての記事を検索します。ここではの検索機能は使わず、Google検索を使っています。の検索機能は有料会員にだけ開放されている機能なので、誰にでもオープンなGoogle検索にしました。GoogleのWeb検索で上位10件を取得しています。</p>

<h3>4. 記事の選択</h3>

<p>うまは、1つの知りたいことに対して1件だけ記事を提示するため、検索結果の中から提示する記事を選択する必要があります。画像を合わせて提示したいので、検索結果の上位から画像があるかをチェックしていき、画像があるものが見つかればそれを選択しています。</p>

<p>ここも将来的な改善の余地が大きい箇所です。たとえば、検索結果の記事ごとにPick数を取得して重み付けをする、みたいなことはすぐに思いつきます。ただ、やりだすと終わりがありませんし、記事の内容を判定に使うためにはクローリングやページの処理が必要で、レスポンスタイムがそのぶん伸びてしまうこともあり、このような処理としています。</p>

<h3>5. 記事の提示</h3>

<p><a href="https://developers.line.me/bot-api/api-reference#sending_rich_content_message">リッチメッセージ</a>を作ってLINEサーバにPOSTすると、ユーザーに記事が提示されます。</p>

<p>以上の処理がワンセットで、テキストメッセージを受け付けるたびにこれを実行します。</p>

<h1>社内公開</h1>

<p>だいたい動くようになったところで、社内(ニューズピックス/ユーザベース)のSlackでうまを公開しました。けっこう好評で皆に使ってもらえたのですが、やっぱりユーザーの実際の使い方というのは、開発者に様々な気づきやアイディアを与えてくれるものです。以下はのメンバーがSlackにポストしてくれたキャプチャです。</p>

<h3>時間の指定</h3>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414204703.jpg" alt="f:id:ryoju:20160414204703j:plain:w250" title="f:id:ryoju:20160414204703j:plain:w250" class="hatena-fotolife" style="width:250px" itemprop="image"></span></p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414204706.png" alt="f:id:ryoju:20160414204706p:plain:w250" title="f:id:ryoju:20160414204706p:plain:w250" class="hatena-fotolife" style="width:250px" itemprop="image"></span></p>

<p>いまの処理方法では、時間（記事の公開時刻）をまったく考慮していません。「今日の」「昨日の」のような時間指定のあるメッセージだと、ユーザーの意図を踏まえないイマイチな答えになってしまいます。改善ポイントですね。</p>

<h3>形容詞の使用</h3>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414204734.png" alt="f:id:ryoju:20160414204734p:plain:w250" title="f:id:ryoju:20160414204734p:plain:w250" class="hatena-fotolife" style="width:250px" itemprop="image"></span></p>

<p>現在の処理方式では特徴語抽出で名詞だけを残しており、「盛り上がった」は形容詞なので、検索結果に何ら反映されません。この場合は「ニュース」だけで検索した結果を返すことになっています。</p>

<p>まあ、うまは生まれたばかりだからね……。開発者としてはがんばって賢くしてやりたいものです。</p>

<h1>ソースコード</h1>

<p><a href="https://github.com/ryoju/newspicks_bot">現状のソースコードをGithubに上げた</a>ので、よろしければご覧ください。まだα版くらいの感じなので、ごちゃごちゃ弄っている最中でコメントも皆無と、綺麗とは言いがたいのですが。そのうち整理されてくるはず……たぶん。</p>

<p>実装にはPythonを使っています。フレームワークはDjango(w/ Django REST Framework)です。 どこかで動かしてみる時には、newspicks/settings_line.pyにあなたのLINE BOTのChannel ID, Channel Secret, MIDを記載してください。</p>
</description>          <pubDate>Fri, 15 Apr 2016 14:05:13 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792371135866</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/r/ryoju/20160414/20160414174014.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Slackを全社導入したので、社内向け利用マニュアルを公開してみた</title>
          <link>http://tech.uzabase.com/entry/2016/03/17/145415</link>          <description><p>はじめまして。ユーザベース Cultureチームの木村です。先月、インターンとして入社し、就職活動と二足の草鞋でやっています。
<br>
<br>
今回、ユーザベース全体として「Slack」の全面導入が決まりました！
これまで、社内でのチャットコミュニケーションはチームごとにLINE・チャットワーク・Skypeを使用し混在していましたが、今後はSlackに統一をしていきます。
<br>
<br>
全社導入時に使用した<span style="color: #F5A2A2">Slackのご紹介</span>と<span style="color: #F5A2A2">簡易マニュアル</span>を公開します。Slackが気になっていた方や初めて知る方に、他のコミュニケーションツールと違う点についてお伝えしたいと思います。
<br>
<br></p>

<h3>What’s Slack？</h3>

<p><br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316161207.png" alt="f:id:uzabase:20160316161207p:plain" title="f:id:uzabase:20160316161207p:plain" class="hatena-fotolife" itemprop="image"></span>>
<br></p>

<blockquote><p>Slack（スラック）は、スチュワート・バターフィールドによって開発された、チームコミュニケーションツール。2013年8月に公開され、公開から24時間以内に8000の顧客にサインアップされた。現在Slackは世界中で急速に普及しており、1日に利用するアクティブユーザー数は125万人で、有料会員が37万人(2015年9月時点)。利用者数は90日ごとに倍増するペースで伸び続けている。</p></blockquote>

<p><u><b>ざっくり言えば、「ビジネス用途のLINE」です。</b></u>
<br>メールで堅苦しくやり取りをするよりも、チャットツールで簡単にコミュニケーションをとる方が、精神的にも楽ですし、効率的ですよね。LINEはプライベートと混同されてしまうし・・というわけで、Slackになりました。
<br>
ですが、チャットワークを始め、数ある企業向けコミュニケーションツールの中から、どうしてSlackが選ばれたのか？
<br>
ということで、以下にSlackを利用する5つのメリットをあげてみました！
<br>
<br></p>

<h4>Slackのイケてる点</h4>

<ol>
<li><b>情報の抽出が簡単＆網羅的</b>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163128.png" alt="f:id:uzabase:20160316163128p:plain" title="f:id:uzabase:20160316163128p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
検索機能で、チャンネル(LINEのグループチャットの概念)をまたいで、過去ログ全ての検索ができます。
<br>また、ファイルやまとまった文章を投稿するPost機能は、それ自体にコメントをつけることができるので、返答や意見が一か所にまとまりやすいです。Postは複数人での共同編集にも対応しています。
<br>
<br></li>
<li><b>連携できる外部サービスが豊富</b>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163143.png" alt="f:id:uzabase:20160316163143p:plain" title="f:id:uzabase:20160316163143p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
Slackと言えば拡張性。例えばGmailからメールが来たらSlackに通知され、そのままSlack上で内容の確認ができるなど、あらゆる通知や情報がSlackを見るだけで確認ができるようになります。TwitterやRSS、Google Calendarといった一般的なサービスから、GitHubなどエンジニア向けのサービスまで、幅広く連携することができます。
<br>
<br></li>
<li><b>UIがシンプルでスタイリッシュ</b>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316170627.png" alt="f:id:uzabase:20160316170627p:plain" title="f:id:uzabase:20160316170627p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
個人的な好みにはなりますが、とにかくお洒落でシンプル。洗練されたUIは、SPEEDAと共通する部分があるように思えます。コミュニケーションツールは毎日使うものですので、やはりごちゃごちゃしたUIよりも、シンプルで分かり易いものの方が捗ります。
<br>
<br></li>
<li><b>各端末用のアプリがある</b>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316162310.jpg" alt="f:id:uzabase:20160316162310j:plain" title="f:id:uzabase:20160316162310j:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
ブラウザ版の他、Mac、Windowsのデスクトップ版、iOS、Androidのアプリ版もあり、いつでもどこでも使うことができます。
<br>
<br></li>
<li><b>各種コードをアップロードできるsnippet機能がある。</b>
<br>
この点が、とりわけエンジニアライクな設計になっています。Tech Blogということで、少し詳しくご説明します。
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163202.png" alt="f:id:uzabase:20160316163202p:plain" title="f:id:uzabase:20160316163202p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
左上の入力画面にコードの名前を打ち込み、右上のプルダウンでコードの言語種類を選ぶと、中央のプログラムコードが色付けされたり、自動でインデントがつけられます。
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163221.png" alt="f:id:uzabase:20160316163221p:plain" title="f:id:uzabase:20160316163221p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
実際に投稿すると、このように見えます。これまで、他のチャットサービスでコードをベタ貼りしていた時と比べて、かなり見違えると思います。色付け、インデントに加えて行番号も書いてあるため、他のエンジニアとのコミュニケーションもとりやすくなっています。
<br>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163243.png" alt="f:id:uzabase:20160316163243p:plain" title="f:id:uzabase:20160316163243p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
投稿されたSnippetには、Post機能と同じようにコメントを付けられるだけではなく、検索でコードやコメントの中身まで引っかかります！
<br>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163304.png" alt="f:id:uzabase:20160316163304p:plain" title="f:id:uzabase:20160316163304p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
ちなみに、これは「in:helloslack during:2016 helloWorld」と検索しており、『「helloslack」チャンネルの2016年に投稿された中で、helloWorldの文字列が存在する』メッセージもしくはファイルを抽出しています。
<br></li>
</ol>


<h3>How to Slack</h3>

<h4>1.コミュニケーション</h4>

<p>Slackでのコミュニケーション方法は、以下の3通りです。
<br>
・メンバー全体に特定の情報を送信する「チャンネル」
<br>
・個々のメンバーに向けた「ダイレクトメッセージ」
<br>
・特定のメンバーのみが閲覧できる「プライベートグループ」
<br></p>

<h5>1-1.チャンネル</h5>

<p>チャンネルとは、関連する話題を部屋別に分ける機能で、LINEのグループチャットと同じようなものです。ただし、このチャンネルに表示している内容は、Slack全体に共有されるので、チャンネルに参加していない人でも自由に閲覧することが可能です。(チャンネルに参加していないメンバーは、発言することはできません。)
<br>
<br>
【新規チャンネル作成】
<br>
新規チャンネルは「CHANNELS」の「＋ボタン」をクリックして作成をします。お好みのチャンネル名と招待したいメンバー(後からでも追加可能)、チャンネルの説明をいれたら、「Create channel」をクリックしてください。
<br>
 <span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163337.png" alt="f:id:uzabase:20160316163337p:plain" title="f:id:uzabase:20160316163337p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
＋ボタンの左にある「CHANNELS」からは既存のCHANNELを検索することができます。
<br>
<br>
【チャット】
<br>
通常の会話は、チャットツールと同様でテキストを入力し、Enterで送ることができます。編集したい場合には、テキスト入力欄の右に「･･･」がでますので、そこから「Edit message」で編集してください。
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163821.png" alt="f:id:uzabase:20160316163821p:plain" title="f:id:uzabase:20160316163821p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
コメントにPinやStarを付けて、後から見やすくすることもできます。
<br>
<br>
【メンション】
<br>
投稿時に、以下のコマンドを入力すると、特定のユーザー名を記載したメッセージが送れるようになります。初期設定では、メンションのみがポップアップ通知されるようになっているため、これを使うことで相手にメッセージが伝わりやすくなります。
<br>
@username → 特定の個人へのメンションは、@を入れて一覧の予測変換より選択出来ます。
<br>
@everyone or @group → チャンネル関係なく、全てのメンバーへのメンション
<br>
@here → オンラインのメンバーへのメンション
<br>
@channel → チャンネルのメンバー全員へのメンション
<br>
<br>
【ファイル共有】
<br>
テキスト入力欄左部の＋ボタンから、「Upload a file」、もしくはドラッグアンドドロップで、テキスト入力エリアに画像やファイルを持ってくると、アップロードが可能です。gif・jpg・png・pdf・textなど、どんなファイルでも送ることができます。
<br>
<br></p>

<h5>1-2.ダイレクトメッセージ</h5>

<p>ダイレクトメッセージは、名前の通り直接連絡のやり取りができます。
一対一の会話なので、他の参加者が内容を確認することはできません。
<br>
 <span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163348.png" alt="f:id:uzabase:20160316163348p:plain" title="f:id:uzabase:20160316163348p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
画面左部「DIRECT MESSAGES」からユーザーの検索ができます。
<br>
<br></p>

<h5>1-3.プライベートグループ</h5>

<p>プライベートグループは、チャンネルとほぼ同じ機能ですが、このチャンネルに書かれた内容は参加メンバーのみに共有され、同じチーム内でも閲覧はできません。クローズドな環境なのでサプライズ等の計画に使えそうです！
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316163925.png" alt="f:id:uzabase:20160316163925p:plain" title="f:id:uzabase:20160316163925p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
通常のチャンネル作成と同様、「CHANNNELS」の「＋ボタン」から作成画面へ
→上部の「Public」タブをクリックすると「Private」となります。
<br>
<br></p>

<h4>2.別アプリとの連携</h4>

<p>【Google Driveとの連携】
Google DriveとSlackを連携しておくと、Google DriveのファイルURLをSlackに貼り付けた際に、Slack上にファイルとして認識される（検索対象になる） ようになります。スプレッドシートなどを頻繁に触る方は設定しておくと、Slack内から検索できたり、直にファイルが開けたりしてとても便利になります。
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316164158.png" alt="f:id:uzabase:20160316164158p:plain" title="f:id:uzabase:20160316164158p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
画面左部の自分のユーザーネームをクリック
<br>
→右部「Account」をクリック
<br>
→左部「Configure Apps」をクリック
<br>
→一覧から「Google Drive」をクリック
<br>
→「Authenticate」から連携許可
<br>
<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316173141.png" alt="f:id:uzabase:20160316173141p:plain" title="f:id:uzabase:20160316173141p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
URLではなく、ファイル形式で表示されるようになった上、Slack上でコメントを付けられるようになりました！
<br></p>

<h3>感想</h3>

<p>長々と書いてしまいましたが、何か一つでもご参考になるものがあれば幸いです。スラッシュコマンドやPin機能など、Slackにはまだまだ可能性が秘められております。皆さまもぜひお試しください。<br>
私個人としても、全社へのSlack導入のお仕事をいただいてから、半信半疑で使い始めたのですが、今はすっかりSlackの虜です。連携サービスやチャンネルの運用を駆使して<span style="color: #F5A2A2">「社内のコミュニケーション全てをSlackで完結させる」</span>と考えはじめたら、もうワクワクの極みです。<br>
そして就活生である身としては、Slackを全社的に有効活用させて<b>「はい！私は、インターン先の企業において、社内コミュニケーションの活性化に尽力しました！」</b>的なことを言えるようになりたいものです。</p>
</description>          <pubDate>Thu, 17 Mar 2016 14:54:15 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792367290487</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20160316/20160316161207.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Hinemos5.0.1移行記（その１：理想と現実の葛藤）</title>
          <link>http://tech.uzabase.com/entry/2016/03/11/155758</link>          <description><p>ユーザベース インフラチームの小林です。</p>

<p><a href="http://tech.uzabase.com/entry/2016/02/18/165541">前回の記事</a>から引き続き、今回からHinemos5.0.1への移行のお話です。</p>

<h2>が、その前に1箇所訂正があります</h2>

<p><a href="http://tech.uzabase.com/entry/2016/02/18/165541">前回のブログで書いた</a>ジョブスケジュール日跨ぎの件ですが、<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160226/20160226221222.jpg" alt="f:id:manabu-kobayashi:20160226221222j:plain" title="f:id:manabu-kobayashi:20160226221222j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>0:00～48:00に設定する事で、日跨ぎができました！<br>
先日Hinemosセミナーに出た際に、NTTデータさんに教えてもらいました。ありがとうございます。<br>
（けれど、日付の指定が年・月・日をいちいち選ばないといけないので、やっぱり不便です。
日付選択を、カレンダーから選択できる機能もつけてしてほしい・・・と思ってます。）
<br>
<br></p>

<h2>移行の流れ</h2>

<p>さて、話を本題に。
<br>
弊社のHinemos環境をバージョンアップするにあたり、おおざっぱに以下の流れで行いました。</p>

<ol>
<li>Hinemos5Managerを新規構築 、動作検証</li>
<li>Hinemos3のデータをHinemos5に移行</li>
<li>Hinemos3からHinemos5への順次切り替え</li>
</ol>


<p>（正確にはHinemos3.1.2とHinemos5.0.1ですが、省略します。）</p>

<h2>では、動作検証の話</h2>

<p>新規構築は、マニュアル通りに行えば特に問題はありません。
動作検証においては、Hinemos3ではあまり高度な機能を使っていなかったこともあり、<br>
ジョブスケジューラとして、以下のような基本的な部分だけの検証で十分でした。(新機能は移行後に順次追加。)</p>

<ul>
<li>指定した通りにコマンド実行ができるか</li>
<li>きちんと先行条件が効くか</li>
<li>スケジューラが機能するか</li>
</ul>


<p>上の部分について全然問題はなかったのですが、Hinemos3と違うところがあったので、思いついた部分を列挙します。<br>
<br>
<b>先行条件が自動で変わって便利！</b><br>
Himemos3の時、ジョブIDを変更したいと思っても、後続のジョブの先行条件も変更しなければならず、すごく億劫でした。<br>
ところが、今回のバージョンアップで試してみたところ、下記のようにジョブIDを変更すると、それに紐付く後続ジョブの先行条件が自動で変わってくれます！<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160229/20160229170138.jpg" alt="f:id:manabu-kobayashi:20160229170138j:plain" title="f:id:manabu-kobayashi:20160229170138j:plain" class="hatena-fotolife" itemprop="image"></span><br>
<b>デフォルトのチェックが余計？</b><br>
新規ジョブ作成時、デフォルトで【条件を満たさなければ終了する】にチェックが入っているのですが、これにチェックが入っていると、前のジョブが異常終了した際などに終了してしまうので、弊社の環境では不便でした。<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160229/20160229170136.jpg" alt="f:id:manabu-kobayashi:20160229170136j:plain" title="f:id:manabu-kobayashi:20160229170136j:plain" class="hatena-fotolife" itemprop="image"></span><br></p>

<p>また、<b>ジョブをコピーして追加したい時に、うまくコピーができる場合と、できない場合（実行コマンド等が空になる）があるので、その謎を解きたいと思ってます。</b><br><br></p>

<h2>データ移行は、<A Href="http://atomitech.jp/">アトミテック</A>さんに依頼</h2>

<p>次に、2点目の「Hinemos3のデータをHinemos5に移行」では、弊社の環境でノード数は約70、ジョブの登録数は約3000とありました。
これを人力で、ミスなく再設定する自信がない・・・<br>
という事で、Hinemosのデータ変換は、Hinemosソリューションパートナーの<A Href="http://atomitech.jp/">アトミテック</A>さんに依頼をさせていただきました。
今回はデータの変換だけではなく、Hinemos5移行後のサポートも含めて契約をさせていただき、
後々それが大きな助けとなりました。</p>

<p>ちなみに、アトミテックさんは、<a href="http://atomitech.jp/hinemos/blog/:title">ブログ</a>でHinemosの情報発信をしており、いろいろな機能の検証をされてます。<br></p>

<p>Hinemos3->5へのデータ変換は、アトミテックさんにお願いしたことで、
弊社側での残作業は3つ目の「Hinemos3からHinemos5への順次切り替え」になります。</p>

<h2>目指す移行方法</h2>

<p>「順次切り替え」と書かせていただきましたが、
以下の要因から、一括切り替えではなく、順次確認をしながらの切り替えが可能でした。</p>

<ul>
<li>Hinemos3とHinemos5のエージェントは同居可能(Windows環境は除く)</li>
<li>ジョブの組み方を単純にしているため、機能検証をする項目が少ない</li>
</ul>


<p>後者について、もう少し詳しく説明します。<br>
一般的なジョブの組み方としては、以下のようにジョブネット間を先行条件で繋ぐことが多いと思います。（Hinemosに限らず）<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160227/20160227013446.jpg" alt="f:id:manabu-kobayashi:20160227013446j:plain" title="f:id:manabu-kobayashi:20160227013446j:plain" class="hatena-fotolife" itemprop="image"></span>
ところが、弊社環境では、ジョブネット間の連携において、先行条件で繋いでいませんでした。
どういうことかというと、各ジョブネットの最後にファイルを作成させて、
次のジョブは、そのファイルがあると動くようにしており、ファイルの作成・監視もshellで動かしています。
こんな感じです。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160227/20160227013915.jpg" alt="f:id:manabu-kobayashi:20160227013915j:plain" title="f:id:manabu-kobayashi:20160227013915j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>このおかげで、こんなことが可能になります。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160227/20160227013500.jpg" alt="f:id:manabu-kobayashi:20160227013500j:plain" title="f:id:manabu-kobayashi:20160227013500j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>こうする事で、<span style="color: #ff5252"><b>一度に全部を切り替えるのではなく、ジョブネット一つずつの動作確認をしながら切り替えができるので、
スケジュールに余裕を持たせた移行が可能な状況でした。
</b></span><br></p>

<h2>と思ったら単純にはAgentが同居できなかったよ！</h2>

<p>Agentで使うJavaをマニュアルから抜粋すると、</p>

<pre class="code lang-sh" data-lang="sh" data-unlink> Hinemosエージェントを利用する場合
 以下のいずれかのopenjdkをインストールしてください。
   java-1.7.0-openjdk
   java-1.6.0-openjdk
</pre>


<p>という事になっているのですが、弊社ではOracleJDK1.8を使ってました。<br>
Agentにいれるために、既存のサービスに影響が出そうなことをしたくない。<br></p>

<p>そしてもう一つ。
インストールディレクトリ
/opt/hinemos
って、バージョンが違ってもインストール先が一緒だということ。<br>
（rpmコマンドでのインストールなので、オプションを付ければ変更もできるかもしれませんが、デフォルトはこのまま）<br>
<br>
つまり、異なるバージョンが同居できるといっても、インストール先をデフォルトから変更をしないといけないのです。</p>

<h2>状況の整理</h2>

<p>状況を整理すると、</p>

<ul>
<li>Agent用にサポート対象バージョンのOpenJDKを入れるか、OracleJDK1.8を使い続けるか。</li>
<li>Hinemos3とHinemos5のAgentが同居できるといっても、どちらかのインストールディレクトリを変えないといけない。</li>
</ul>


<p>という問題にぶつかりました。</p>

<p>前者ですが、当初は簡単に考えていて、
OpenJDKのバイナリファイルをダウンロードして、Agentのインストールディレクトリに展開をすればいいのでは、と思っていましたが、
<a href="http://openjdk.java.net/">http://openjdk.java.net/</a>をみると、yumからしかインストールができないようです。
yumでインストールした場合、万が一環境変数に変更があったりすると、既存のジョブに影響が出てしまう。
うーん、困った。</p>

<p>そこで、後者。<br>
新規でインストールをするHinemos5のAgentのインストールディレクトリを変える<br>
or<br>
既存サービスで利用をしているHinemos3のAgentのインストールディレクトリを変える<br>
<br>
という２択ですが、これから使う方を大事にしたいと思い、Hinemos3の方を変えることにしました。</p>

<p>ここで登場をするのが、やはり<A Href="http://atomitech.jp/">アトミテック</A>さんなのでした。
意外と長くなったので次回へ続く。</p>

<p><br>
<br></p>

<h2>新機能のジョブのリトライ間隔の検証</h2>

<p>ちょっと話題を変えまして、小ネタを一つ。<br>
<br>
ジョブのリトライ機能が追加されましたが、<br></p>

<ul>
<li>リトライ間隔ってどれくらいなんだろう？</li>
<li>それは変更ができるか？</li>
</ul>


<p>というのが気になり、検証をしてみました。
管理者マニュアルには、他のリトライに関する説明はあったのですが、上の点については書いてないんだもの。。。。<br></p>

<p>では、検証開始。<br></p>

<p>1．エラーになるジョブを作る
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304212735.png" alt="f:id:manabu-kobayashi:20160304212735p:plain" title="f:id:manabu-kobayashi:20160304212735p:plain" class="hatena-fotolife" itemprop="image"></span><br>
2．あたりまえだけどすぐ終わる。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304210055.png" alt="f:id:manabu-kobayashi:20160304210055p:plain" title="f:id:manabu-kobayashi:20160304210055p:plain" class="hatena-fotolife" itemprop="image"></span>
3．リトライ回数を2で設定してみたら、落ちるまで20秒かかった。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304210103.png" alt="f:id:manabu-kobayashi:20160304210103p:plain" title="f:id:manabu-kobayashi:20160304210103p:plain" class="hatena-fotolife" itemprop="image"></span>
4．ソースを見てみた。<br>
というか、retryって言葉でgrepをかけてみて探してみた。そして、下の情報にたどり着く。<br>
どうやら、「job.retry.interval」という値で管理ができる。デフォルトは10*1000で、実際は10秒なので、msで設定しているっぽい。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304210111.png" alt="f:id:manabu-kobayashi:20160304210111p:plain" title="f:id:manabu-kobayashi:20160304210111p:plain" class="hatena-fotolife" itemprop="image"></span>
5．プロパティ画面で、job.retry.intervalを60000で設定してみた。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304210115.png" alt="f:id:manabu-kobayashi:20160304210115p:plain" title="f:id:manabu-kobayashi:20160304210115p:plain" class="hatena-fotolife" itemprop="image"></span>
6．ちゃんと2分伸びた！
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160304/20160304210125.png" alt="f:id:manabu-kobayashi:20160304210125p:plain" title="f:id:manabu-kobayashi:20160304210125p:plain" class="hatena-fotolife" itemprop="image"></span>
<br>
<br>
というわけで、<br></p>

<ul>
<li>リトライ間隔のデフォルトは10秒</li>
<li>job.retry.intervalで変更可能</li>
</ul>


<p>というお話でした。
<br></p>
</description>          <pubDate>Fri, 11 Mar 2016 15:57:58 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792364897598</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160226/20160226221222.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>RxJava + Vert.x + jOOλ で Microservice 的な何かを作ってみた</title>
          <link>http://tech.uzabase.com/entry/2016/03/08/140142</link>          <description><p>技術チームの竹内(@chimerast)です。</p>

<p>先日、<a href="http://connpass.com/event/25532/">Rx Ja Night 2016 #1</a>という勉強会で、「RxJava + Vert.x + jOOλ で Microservice 的な何かを作ってみた」という題でLTしてきたので内容を少し書いてみようと思います。</p>

<p>当日は自分以外基本Android勢の発表で、サーバサイドの自分にとっては、とてもアウェイな雰囲気でしたがめげずに発表してきました。RxJavaっていうとサーバサイドでは普通は使う機会がないですからね。</p>

<script async class="speakerdeck-embed" data-id="2745f52212ba4e678b9d37f172c9ebdb" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>


<h2>今回作ったものとその問題点</h2>

<p>ブラウザでチャートを描画するための元データとなるJSONを返すREST APIを作りました。</p>

<p>現在UZABASEではマイクロサービスアーキテクチャ的な何かのように、複数のREST APIを提供するサービスをぽこぽこ立ち上げており、その中の一つという位置づけです。</p>

<p>今回作ったChart APIの裏では、企業情報を扱う「Companies API」、統計情報を扱う「Stats API」、チャートそれぞれの線のデータ指定情報を管理する「Media API」という3つのAPIが動いています。これらにリクエストを投げて得たデータを元に最終的なチャートのJSONを構築します。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20160227/20160227154832.jpg" alt="f:id:chimerast:20160227154832j:plain" title="f:id:chimerast:20160227154832j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>今回作る前から問題点として上がっていたのは、</p>

<ul>
<li>Chart APIだけがAWS上に配置され、それ以外がオンプレのデータセンター上にありデータセンター間通信となってしまうこと</li>
<li>最終的なレスポンスを返すまでに複数回（多いときには20回以上）バックエンドのAPIにリクエストを投げる必要があるということ</li>
</ul>


<p>という二点です。</p>

<p>この状態で最速でレスポンスを返すためには、並列でバックエンドのAPIにリクエストを投げる必要がありますが、それを普通にブロッキングI/Oでやろうとすると、Chart APIへの1リクエストが10スレッド以上立ち上げてバックエンドAPIの返りを待つ必要があるという残念な状態になってしまします。</p>

<h2>使ったもの</h2>

<h3>Vert.x <a href="http://vertx.io/">http://vertx.io/</a></h3>

<p>Nettyの上に作られ、ノンブロッキングI/Oで通信を行う事のできる高レベルAPI群です。サブプロジェクトがたくさんありDBとの通信を行うことの出来るモジュールなんかもあります。</p>

<p>これのサブプロジェクトの一つである、Vert.x-WebをつかってRESTなAPIをつくりつつ、バックエンドAPIに対して１スレッドからノンブロッキングで複数リクエストを投げるみたいな使い方をしました。</p>

<p>Vert.xの問題点として、全てがコールバックで返る非同期APIなため、例えば単純なDBのSELECT&amp;UPDATEをするだけでも何段ものインデントが必要な書き方になります。メソッドを分けるという単純な解決法もありますが宣言的に書けるところは宣言的に書きたいです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20160227/20160227160730.jpg" alt="f:id:chimerast:20160227160730j:plain" title="f:id:chimerast:20160227160730j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>これを解決するためにRxJavaを使います。</p>

<h3>RxJava <a href="https://github.com/ReactiveX/RxJava">https://github.com/ReactiveX/RxJava</a></h3>

<p>RxJavaは、Streamとしての側面とPromiseとしての側面を併せ持ったライブラリです。いろいろな使い方ができ自分も全てのメソッドの使い道をうまく把握出来ていません。Android勢はJava8がまだ使えないためStreamの代わりとして使っていたり、非同期処理も多いのでPromiseとしての使い方をしたり色々しているようです。</p>

<p>今回のサーバサイドの開発では、Promiseとしての側面しか使っていません。コールバック地獄から抜け出すため(flatMap)、そして、複数の非同期処理をひとまとめにするため(zip)に主に使っています。</p>

<p>最終的には組み合わせて以下みたいなコードになっています。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20160229/20160229075644.jpg" alt="f:id:chimerast:20160229075644j:plain" title="f:id:chimerast:20160229075644j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h2>感想</h2>

<p>あまり長い文を書いても読みづらくなるだけなので、あとの細かい所はスライドを見てみてください。</p>

<p>Vert.xは巨大なモノリシックなサービスを作るのにはあまり向いていない気がしていますが、今回のように小さいサービスを作るには軽くて向いていると思えました。特に並列でバックエンドのAPIに丸投げして待つみたいなものを作る時にはスレッドの数を考える必要が無いという大きな利点があると思います。</p>

<p>RxJavaは非同期処理を気持ちよく書けるライブラリです。Vert.x、RxJavaともにJava8に対応しているためラムダ式でがしがし書くことができます。</p>

<h2>エンジニア募集</h2>

<p>株式会社ユーザベース、および、株式会社ニューズピックスではエンジニアを募集しています。ご興味があればお気軽にご連絡ください。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fcompanies%2Fuzabase-inc%2Fprojects" title="株式会社ユーザベースの採用/求人一覧 - Wantedly" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/companies/uzabase-inc/projects">www.wantedly.com</a></cite></p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fcompanies%2Fnewspicks%2Fprojects" title="株式会社ニューズピックスの採用/求人一覧 - Wantedly" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/companies/newspicks/projects">www.wantedly.com</a></cite></p>
</description>          <pubDate>Tue, 08 Mar 2016 14:01:42 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/10328537792364977387</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20160227/20160227154832.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Hinemos3.1.2→Hinemos5.0.1に移行しました</title>
          <link>http://tech.uzabase.com/entry/2016/02/18/165541</link>          <description><p><a href="http://tech.uzabase.com/entry/2015/01/29/102935">前回の投稿</a>から約1年と、だいぶ時間が空いてしまいました。<br>
ご無沙汰しておりますユーザベース インフラチームの小林です。</p>

<p>当時海外留学していたメンバーも無事帰国し、新メンバーも増え、インフラチームはだいぶにぎやかになっております。</p>

<h2>Hinemos3.1.2→Hinemos5.0.1に移行！</h2>

<p>さて、本題なのですが、昨年5月にHinemos5が発表されました。<br>
すぐに導入したかったのですが、昨年9月の5.0.1の公開を待って、満を持してHinemos3.1.2→Hinemos5.0.1への移行を行いました。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160215/20160215231044.png" alt="f:id:manabu-kobayashi:20160215231044p:plain" title="f:id:manabu-kobayashi:20160215231044p:plain" class="hatena-fotolife" itemprop="image"></span>
<br><br><br>
この移行時の顛末については、次回にさせていただくとして、今回はHinemos5にしてみて、実際どうだったかというところを紹介させていただきます。</p>

<h2>Hinemos5.0.1で大幅な運用改善を実現！</h2>

<p>おさらいですが、Hinemos3の運用での困っていた点は以下の通りです。</p>

<ul>
<li>Hinemosエージェントが、Windows8だと動かない<br>

<ul>
<li>⇒そもそもWindows対応のみで、Mac作業者が作業できない。</li>
</ul>
</li>
<li>画面を開くの重い、ジョブの登録はもっと重い<br>

<ul>
<li>⇒あまりに重くて、常時PC開きっぱなし。</li>
</ul>
</li>
</ul>


<p>ジョブ管理ツールとしては問題なく動いてくれていたのですが、パフォーマンス面でどうしても運用メンバーの負荷が上がっている状態でした。</p>

<p>では、これらが、Hinemos5になって解決されたかというと、、<br>
<span style="color: #000000"><b>はい、ばっちりです！</b></span></p>

<p><br>
Webクライアントについては、下のブログで詳しく紹介されているのでそちらをご確認いただきたいですが、リッチクライアントと遜色ない仕上がりで、<br>
<b>ようやくジョブ監視のWindows縛りから解放されたのであります！</b><br>
<iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Ftech-sketch.jp%2F2015%2F09%2Fhinemos5-0_part1.html" title="Hinemos5.0新機能紹介Part1「Webクライアント」 | Tech-Sketch" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://tech-sketch.jp/2015/09/hinemos5-0_part1.html">tech-sketch.jp</a></cite></p>

<p><br>
次に、画面が開くまで時間ですが、僕の実測ベースで、<br></p>

<ul>
<li>Hinemos3の時

<ul>
<li>ログインするまで：2分7秒（そのあとに、ジョブ履歴の画面を開くのにまた待ち時間）</li>
<li>ジョブの登録時の待ち時間：2分30秒</li>
</ul>
</li>
<li>Hinemos5の時

<ul>
<li>ログインするまで：30秒（更にジョブ履歴の画面まで開いてる！！）</li>
<li>ジョブの登録時の待ち時間：10秒位</li>
</ul>
</li>
</ul>


<p>と大幅改善されていて、<b>常時画面を開いている状態からも解放されました。</b><br>
毎日Hinemos開いていたので、待ち時間だけで1年で約10時間の削減効果です(笑</p>

<p><br>
それ以外にも、<br></p>

<ul>
<li><b>ジョブのスケジュール予定がわかるようになった</b>り、<br>（新規でスケジュールしたときに想定通り動くか確認できて超便利！）
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160217/20160217225235.png" alt="f:id:manabu-kobayashi:20160217225235p:plain" title="f:id:manabu-kobayashi:20160217225235p:plain" class="hatena-fotolife" itemprop="image"></span></li>
<li><b>祝日のパターンなどを複数のカレンダで共有できた</b>り（デフォルトで祝日入ってるし！）<br></li>
<li><b>ジョブのエラー時にSlackに通知出るようにした</b>り
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160215/20160215215536.png" alt="f:id:manabu-kobayashi:20160215215536p:plain" title="f:id:manabu-kobayashi:20160215215536p:plain" class="hatena-fotolife" itemprop="image"></span></li>
</ul>


<p>と、いろいろと運用負荷が下がっています。（通知の機能は、Hinemos3からあった機能を使ってます。）</p>

<h2>Hinemos5.0.1のちょっといけていない点</h2>

<p>で、いいことばかりでもなく、ちょっといけてない点もあったりしてます。<br></p>

<ul>
<li>Hinemos5.0.1でも若干不安定。

<ul>
<li>→なんかメモリリークしてそうな感じ。月に何回かサービス再起動してます。</li>
</ul>
</li>
<li>ジョブスケジュールを臨時で停止したい時、日跨ぎしたいとき不便。（例えば、今日の12時から、明日の12時まで止めたい時とかは2度登録必要。）<br><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160215/20160215225823.png" alt="f:id:manabu-kobayashi:20160215225823p:plain" title="f:id:manabu-kobayashi:20160215225823p:plain" class="hatena-fotolife" itemprop="image"></span></li>
<li>ジョブ履歴画面から落ちたジョブのコマンド確認したい時に、グレーアウトされてて見れない。<br>（下の例だと短いコマンドですが、長いコマンドだと途中で切れる。）<br><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/m/manabu-kobayashi/20160215/20160215225116.png" alt="f:id:manabu-kobayashi:20160215225116p:plain" title="f:id:manabu-kobayashi:20160215225116p:plain" class="hatena-fotolife" itemprop="image"></span><br></li>
</ul>


<p>下の２つは、Hinemos3とHinemos5で操作が違って慣れてないだけの気もしますが・・・</p>

<p><br><br></p>

<h2>HInemos5.0.0→5.0.1へのアップグレード手順</h2>

<p>最後に、開発環境にあった、5.0.0環境を5.0.1にアップグレードしてみましたので、簡単に手順を載せておきます。
（そんな難しいことはしてませんが。。）<br></p>

<h3>1. DBのバックアップを取得</h3>

<p>念のため、jvmを停止後バックアップを取得します。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># /opt/hinemos/bin/jvm_stop.sh</span>
<span class="synComment"># /opt/hinemos/sbin/mng/hinemos_backup.sh</span>
<span class="synComment"># /opt/hinemos/bin/jvm_start.sh</span>
</pre>


<h3>2. それぞれサービス停止</h3>

<p>弊社環境では、ManagerとWebクライアントが同居しています。</p>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># service hinemos_web stop</span>
<span class="synComment"># service hinemos_manager stop</span>
</pre>


<h3>3. さらに念をおしてHinemosマネージャver.5.0.0のバックアップを取得</h3>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># cp -rp /opt/hinemos /tmp/hinemos_500_backup</span>
<span class="synComment"># cp -rp /opt/hinemos_web /tmp/hinemos_web_500_backup</span>
</pre>


<h3>4. rpmコマンドでUpdate</h3>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># rpm -Uvh hinemos-manager-5.0.1-1.el7.x86_64.rpm</span>
<span class="synComment"># rpm -Uvh hinemos-web-5.0.1-1.el7.x86_64.rpm</span>
</pre>


<h3>5. serviceファイルをリロードする</h3>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># systemctl daemon-reload</span>
</pre>


<h3>6. それぞれサービス起動</h3>

<pre class="code lang-sh" data-lang="sh" data-unlink><span class="synComment"># service hinemos_manager start</span>
<span class="synComment"># service hinemos_web start</span>
</pre>


<p>って、この記事準備してたら、2016/2/15にHinemos5.0.2が公開されたので、さっそくもう一度試す羽目に。。</p>

<p>Hinemos5への移行記は今後も続きますので楽しみにお待ちください！</p>
</description>          <pubDate>Thu, 18 Feb 2016 16:55:41 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/6653586347156633673</guid>
          
          <enclosure url="http://cdn.mogile.archive.st-hatena.com/v1/image/uzabase/302456199552088609.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>えびスタ！#3 特別編「ウェブ版リニューアルの裏側」を開催します</title>
          <link>http://tech.uzabase.com/entry/2015/08/07/123741</link>          <description><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150807/20150807105606.png" alt="f:id:uzabase:20150807105606p:plain" title="f:id:uzabase:20150807105606p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>皆さまこんにちは。</p>

<p>恵比寿のイケてるスタートアップが集まるエンジニア向けの技術勉強会「えびスタ！」の第3回を開催します。
第3回は特別編として1社での単独開催です。先日リニューアルしたばかりのウェブ版の開発の裏側についてお届けします。</p>

<p>もちろん今回もLT枠を用意しています。自社の技術についてアピールしたいという方はぜひLT枠でご参加ください！懇親会ではエビスビールとピザも用意してお待ちしています！</p>

<p>エビスビールを飲みながら、テクノロジーとデザインの未来について語り合いましょう！</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Febista.connpass.com%2Fevent%2F18581%2F" title="えびスタ！#3 特別編「ウェブ版リニューアルの裏側」 (2015/08/24 19:00〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://ebista.connpass.com/event/18581/">えびスタ！#3 特別編「ウェブ版リニューアルの裏側」 (2015/08/24 19:00〜)</a></iframe><cite class="hatena-citation"><a href="http://ebista.connpass.com/event/18581/">ebista.connpass.com</a></cite>
<iframe src="http://blog.newspicks.com/embed/2015web_renewal" title=" ウェブ版リニューアルのお知らせ -  Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"><a href="http://blog.newspicks.com/entry/2015web_renewal"> ウェブ版リニューアルのお知らせ -  Blog</a></iframe><cite class="hatena-citation"><a href="http://blog.newspicks.com/entry/2015web_renewal">blog.newspicks.com</a></cite></p>

<h2>イベント情報</h2>

<ul>
<li>日時：8/24（月）19:00（18:30 開場）</li>
<li>場所：株式会社ニューズピックス（東京都渋谷区恵比寿 1-18-14 恵比寿ファーストスクエア 10 階）</li>
</ul>


<table>
<thead>
<tr>
<th style="text-align:left;">時間</th>
<th style="text-align:left;">発表者</th>
<th style="text-align:left;">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">18:30 ~ 19:00</td>
<td style="text-align:left;">-</td>
<td style="text-align:left;">開場</td>
</tr>
<tr>
<td style="text-align:left;">19:00</td>
<td style="text-align:left;">-</td>
<td style="text-align:left;">乾杯（エビスビールで）</td>
</tr>
<tr>
<td style="text-align:left;">19:00 ~ 19:30</td>
<td style="text-align:left;">甲斐 琢巳（ エクスペリエンスエディター）</td>
<td style="text-align:left;">が目指す新しいニュース体験について</td>
</tr>
<tr>
<td style="text-align:left;">19:30 ~ 20:00</td>
<td style="text-align:left;">戸辺 淳一郎（ ウェブリニューアルプロジェクトリーダー）</td>
<td style="text-align:left;">ウェブリニューアルを成功させたチーム体制「Holacracy（ホラクラシー）」、およびエンジニアとデザイナーの協業について</td>
</tr>
<tr>
<td style="text-align:left;">20:00 ~ 20:20</td>
<td style="text-align:left;">発表者募集中！</td>
<td style="text-align:left;">LTタイム（5分×4人）</td>
</tr>
<tr>
<td style="text-align:left;">20:20 - 21:30</td>
<td style="text-align:left;">-</td>
<td style="text-align:left;">懇親会（エビスビールとピザを用意しています！）</td>
</tr>
</tbody>
</table>


<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Febista.connpass.com%2Fevent%2F18581%2F" title="えびスタ！#3 特別編「ウェブ版リニューアルの裏側」 (2015/08/24 19:00〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://ebista.connpass.com/event/18581/">えびスタ！#3 特別編「ウェブ版リニューアルの裏側」 (2015/08/24 19:00〜)</a></iframe><cite class="hatena-citation"><a href="http://ebista.connpass.com/event/18581/">ebista.connpass.com</a></cite></p>
</description>          <pubDate>Fri, 07 Aug 2015 12:37:41 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450104773144</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150807/20150807105606.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>「日本の夏は高温化しているか？」について可視化して確かめてみた。</title>
          <link>http://tech.uzabase.com/entry/2015/08/05/185131</link>          <description><p>技術チーム竹内(@<a class="twitter-user-screen-name" href="http://twitter.com/chimerast">chimerast</a>)です。</p>

<p>最近暑いですね。東京では猛暑日の連続が新記録だそうです。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.tenki.jp%2Fforecaster%2Fdiary%2Fdeskpart%2F2015%2F08%2F05%2F29061-summary.html" title="猛暑日　東京新記録　仙台25年ぶり(日直予報士) - tenki.jp" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://www.tenki.jp/forecaster/diary/deskpart/2015/08/05/29061-summary.html">猛暑日　東京新記録　仙台25年ぶり(日直予報士) - tenki.jp</a></iframe><cite class="hatena-citation"><a href="http://www.tenki.jp/forecaster/diary/deskpart/2015/08/05/29061-summary.html">www.tenki.jp</a></cite></p>

<p>Twitter上でも最近暑くなったことについて、データを見つつ色々話題になっていたようです。</p>

<ul>
<li><a href="http://togetter.com/li/856042">&#x65E5;&#x672C;&#x306E;&#x590F;&#x306F;&#x9AD8;&#x6E29;&#x5316;&#x3057;&#x3066;&#x308B;&#x304B;&#xFF1F; - Togetter&#x307E;&#x3068;&#x3081;</a></li>
<li><a href="http://togetter.com/li/855995">&#xFF13;&#xFF10;&#x5E74;&#x524D;&#x3068;&#x6BD4;&#x3079;&#x6691;&#x304F;&#x306A;&#x3063;&#x305F;&#x3068;&#x805E;&#x304D;&#x590F;&#x306E;&#x6C17;&#x6E29;&#x30C7;&#x30FC;&#x30BF;&#x3092;&#x30B0;&#x30E9;&#x30D5;&#x306B;&#x3057;&#x3066;&#x307F;&#x305F;&rarr;&#x69D8;&#x3005;&#x306A;&#x610F;&#x898B;&#x96C6;&#x307E;&#x308B; - Togetter&#x307E;&#x3068;&#x3081;</a></li>
</ul>


<p>で、せっかくなんで自分でも最近どうなっているのか確かめてみました。</p>

<h3>使ったデータ</h3>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.data.jma.go.jp%2Fgmd%2Frisk%2Fobsdl%2F" title="気象庁|過去の気象データ・ダウンロード" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://www.data.jma.go.jp/gmd/risk/obsdl/">気象庁|過去の気象データ・ダウンロード</a></iframe><cite class="hatena-citation"><a href="http://www.data.jma.go.jp/gmd/risk/obsdl/">www.data.jma.go.jp</a></cite></p>

<p>気象庁から東京都の1986年1月から2015年8月4日時点までの月次データを取得してきてみました。</p>

<p>項目は、</p>

<ul>
<li>平均気温(℃)</li>
<li>降水量の合計(mm)</li>
<li>平均湿度(％)</li>
<li>日照時間(時間)</li>
<li>日最高気温の平均(℃)</li>
<li>日最低気温の平均(℃)</li>
</ul>


<p>をとりあえずとってきてみました。</p>

<h3>使ったもの</h3>

<ul>
<li><a href="http://e2d3.org/ja/">E2D3</a></li>
<li><a href="http://dc-js.github.io/dc.js/">dc.js - Dimensional Charting Javascript Library</a></li>
</ul>


<p>Excelでセルにデータを入力するとモダンな感じにビジュアライズ出来るE2D3で、データを多角的に見られるdc.jsを使える「dcjs-example」というテンプレートを使って(作って)可視化してみました。</p>

<p><a href="http://e2d3.org/ja/">E2D3</a>は、Excelから気軽にデータビジュアライズできるようにしようと、現在絶賛開発中のオープンソースソフトウェアです。Excel2013以降もしくは、Excel OnlineのOfficeストアから探せるので使ってみてください。</p>

<h3>できたもの</h3>

<p>こんな感じです(残念ですが、スマホでは表示されません)。マウスで下のグラフを選択すると、選択した範囲でデータがフィルタリングされます。</p>

<p>下の方の青いグラフの縦軸はデータの個数です。</p>

<p><a href="https://s.e2d3.org/e5f3bff/be9fe63b4e1b14e8c644d62e67e9ba2e" target="_blank">別画面で大きく表示する</a></p>

<p><strong>画像ではなくマウスクリックで動かせますよ！</strong></p>

<script type="text/javascript">
if (document.getElementsByTagName("html")[0].getAttribute("data-globalheader-type") === 'pc') {
  document.open();
  document.write('<iframe src="https://s.e2d3.org/e5f3bff/be9fe63b4e1b14e8c644d62e67e9ba2e" width="100%" height="1250" frameborder="0" scrolling="no"></iframe>');
  documnet.close();
}
</script>


<h3>考察</h3>

<p>実際に自分でいろいろ触って見てもらうのが一番ですが、例えば、8月の最低気温の平均を25度以上でフィルタリングしてみると明らかに近年(緑色)の年だけが出てきてしまいますね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20150805/20150805174130.png" alt="f:id:chimerast:20150805174130p:plain" title="f:id:chimerast:20150805174130p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h3>まとめ</h3>

<p>データを触って見ると色々気づきがあります。</p>

<p><a href="http://e2d3.org/ja/">E2D3</a>を使うとExcelでデータを簡単に入れ替えてデータ可視化を行うことが出来ます(たぶん)。</p>

<p>東京だけでなくいろんな地点のデータを入れてみると面白いと思います。</p>

<h3>いろいろ</h3>

<p><a href="http://www.uzabase.com/">株式会社ユーザベース</a>では、企業・業界・統計データやニュース記事・コメント等データを大量に抱えています。そんなデータをなんとかしてみたいエンジニアを募集しています。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fcompanies%2Fuzabase-inc%2Fprojects" title="株式会社ユーザベースの募集一覧 - Wantedly" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/companies/uzabase-inc/projects">株式会社ユーザベースの募集一覧 - Wantedly</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/companies/uzabase-inc/projects">www.wantedly.com</a></cite></p>

<p>あと、OSSで開発している<a href="http://e2d3.org/ja/">E2D3</a>プロジェクトでは、可視化テンプレートを作成してくれるエンジニアや、基盤システムを開発してくれるエンジニアを探しています。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fe2d3%2Fe2d3" title="e2d3/e2d3" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://github.com/e2d3/e2d3">e2d3/e2d3</a></iframe><cite class="hatena-citation"><a href="https://github.com/e2d3/e2d3">github.com</a></cite></p>
</description>          <pubDate>Wed, 05 Aug 2015 18:51:31 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450104591467</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20150805/20150805174130.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>ウェブサービスの品質保証をお弁当作りに例えたら</title>
          <link>http://tech.uzabase.com/entry/2015/07/02/200356</link>          <description><p>初めまして。QA（Quality Assurance）を担当しております、えがさ（仮名）と申します。<br />
QAエンジニアとして、主にBtoC向けWebサービスサイトや、プリンタ、<br />
携帯電話などのテスティングや、雑誌の原稿作成のお手伝いなどをしておりました。<br />
ユーザベースに参加してからだいたい半年になります。<br />
<br />
<br />
<span style="font-size: 150%"><b>SPEEDAの簡単な概要</b><br /></span>
<br />
私は、SPEEDAのWebサイト部分がメインの担当ですが、SPEEDAとは。<br />
一言で表すと、「企業情報などを多角的に取り出せるデータベース」です。<br />
お客様がSPEEDAを活用して新たな価値を生み出すための<br />
ベースを支えるのがミッションです。<br />
<br />
<br />
<span style="font-size: 150%"><b>SPEEDAって・・・。</b><br /></span>
<br />
このお仕事をして製品を触るうちに、私はあることを思いつきました。<br />
SPEEDAって・・・まるでお弁当みたいだな、と。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150630/20150630113418.png" alt="f:id:uzabase:20150630113418p:plain" title="f:id:uzabase:20150630113418p:plain" class="hatena-fotolife" itemprop="image"></span><br />
<span style="color: #00cc00">
お客様にお出しするためのお弁当箱：インフラ　があり<br />
お客様にコアバリューを提供するデータ：主食　があり<br />
データをおいしく加工するためのおかず：Webサイト　があり。<br />
</span>
全部がそろって活用できる。<br />
<br />
しかしお弁当は温かいほうがよりおいしくいただけます。<br />
ホットな情報には賞味期限もあります。<br />
そのためにアジャイルでの開発が行われています。<br />
<br />
<br />
<span style="font-size: 150%"><b>と　こ　ろ　が</b><br /></span>
<br />
アジャイルのQAはウォーターフォールの開発とは<br />
発想が真逆になることもあり。<br />
最初は目が点になることも多々ありました。<br />
<br />
見る間にリリースされるスケジュール感。<br />
クライテリアの基準。<br />
<br />
IEEE829?　ISO9001?<br />
既存のモデルはアジャイルにそのまま適用できません。<br />
<br />
できればテストケースも使いまわしたい。<br />
漏れなく効率よくまわしたい。<br />
<br />
しかし納期と品質という相反する要素をどうやって折り合いを付けるのか？<br />
のんびりしていると冷めたおいしくないお弁当になってしまいます。<br />
<br />
<br />
<span style="font-size: 150%"><b>残念なお弁当の一例</b><br /></span><br /></p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623124057.png" alt="f:id:uzabase:20150623124057p:plain" title="f:id:uzabase:20150623124057p:plain" class="hatena-fotolife" itemprop="image"></span>ケンカでもしましたか？<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623124258.png" alt="f:id:uzabase:20150623124258p:plain" title="f:id:uzabase:20150623124258p:plain" class="hatena-fotolife" itemprop="image"></span>お弁当にする意味が・・・。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623124520.png" alt="f:id:uzabase:20150623124520p:plain" title="f:id:uzabase:20150623124520p:plain" class="hatena-fotolife" itemprop="image"></span>ゼリーを弁当と言い張る弱さ。<br />
<br />
・・・こんなお弁当を出荷するわけにはいきません。<br />
<br />
そこで、まだ和書では少ないアジャイルQAの本や各種勉強会などで勉強を進めつつ<br />
（KindlePCが日本でも使えるようになったので洋書の<br />
　QA本が買いやすくなりました！これは嬉しい。）<br />
既存のモデルをSPEEDA向けにアレンジして以下のセットを<br />
作りおきすることにしました。<br />
<br />
<br />
<span style="font-size: 150%"><b>お弁当作り置き</b><br /></span></p>

<p><b><span style="color: #286f2c">基礎（下ごしらえ）</span></b></p>

<ul>
<li>要求分析→既存製品でしたので簡素化しました。</li>
<li>ユースケース</li>
<li>機能分析</li>
<li>問題分析（魚の骨）
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623144912.png" alt="f:id:uzabase:20150623144912p:plain" title="f:id:uzabase:20150623144912p:plain" class="hatena-fotolife" itemprop="image"></span><br />
SPEEDAの冷蔵庫です<br />
<br />
機能の影響範囲をチェックリストにしたがって見ていけば<br />
基本的なテストケースまでができあがります。<br /></li>
</ul>


<p><br />
<b><span style="color: #286f2c">案件毎のテストセット作成（おかずづくり）</span><br /></b></p>

<p>基礎をベースに、プロジェクト毎のテスト要件定義は、<br /></p>

<ul>
<li>マインドマップ:テスト観点の洗い出し
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623141643.png" alt="f:id:uzabase:20150623141643p:plain" title="f:id:uzabase:20150623141643p:plain" class="hatena-fotolife" itemprop="image"></span>ブラウザのマインドマップ<br /></li>
<li>ユースケース：テスト範囲・開発範囲、影響の見積もり</li>
<li>シーケンス図：実務の考慮漏れ対策</li>
<li>状態遷移図：シナリオテストのヒントにする</li>
<li>デシジョンテーブル：パターン洗い出し</li>
</ul>


<p>などを用意してテストセットに落としています。<br />
どれも目新しいものではありませんが、<br />
再利用もしやすく時間もかからず重宝しています。<br />
<br /></p>

<p><b><span style="color: #286f2c">盛り付け（テストラン）</span><br /></b></p>

<ul>
<li>テスト（お弁当を詰める）<br />
　　UT：単体テスト<br />
　　SIT：結合テスト　直交表やシナリオなど<br /></li>
<li>体制（料理人の皆様）<br /></li>
</ul>


<p>こうして、温かいうちに召し上がっていただけるように<br />
こつこつ資産化しています。<br /></p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623143617.png" alt="f:id:uzabase:20150623143617p:plain" title="f:id:uzabase:20150623143617p:plain" class="hatena-fotolife" itemprop="image"></span>召し上がれ！<br />
<br />
お弁当QAを体験してみたいエンジニアの皆さん、おいでませ＾－＾<br />
<br /></p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4817192283/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/41VcxPXKoYL._SL160_.jpg" class="hatena-asin-detail-image" alt="ソフトウェアテストHAYST法入門 品質と生産性がアップする直交表の使い方" title="ソフトウェアテストHAYST法入門 品質と生産性がアップする直交表の使い方"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4817192283/hatena-blog-22/">ソフトウェアテストHAYST法入門 品質と生産性がアップする直交表の使い方</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> 吉澤正孝/秋山浩一/仙石太郎</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> 日科技連出版社</li><li><span class="hatena-asin-detail-label">発売日:</span> 2007/07/26</li><li><span class="hatena-asin-detail-label">メディア:</span> 単行本</li><li><span class="hatena-asin-detail-label">購入</span>: 3人 <span class="hatena-asin-detail-label">クリック</span>: 86回</li><li><a href="http://d.hatena.ne.jp/asin/4817192283/hatena-blog-22" target="_blank">この商品を含むブログ (20件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div> サイン本もってます:-D</p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4048672347/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51Vxllc4BBL._SL160_.jpg" class="hatena-asin-detail-image" alt="ペンとノートで発想を広げる“お絵描き”ノート術 マインドマップ(R)が本当に使いこなせる本 (アスキームック)" title="ペンとノートで発想を広げる“お絵描き”ノート術 マインドマップ(R)が本当に使いこなせる本 (アスキームック)"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4048672347/hatena-blog-22/">ペンとノートで発想を広げる“お絵描き”ノート術 マインドマップ(R)が本当に使いこなせる本 (アスキームック)</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> 遠竹智寿子,月刊アスキー編集部,ブザン・ワールドワイド・ジャパン、ブザン教育協会</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> アスキー・メディアワークス</li><li><span class="hatena-asin-detail-label">発売日:</span> 2008/06/30</li><li><span class="hatena-asin-detail-label">メディア:</span> ムック</li><li><span class="hatena-asin-detail-label">購入</span>: 40人 <span class="hatena-asin-detail-label">クリック</span>: 957回</li><li><a href="http://d.hatena.ne.jp/asin/4048672347/hatena-blog-22" target="_blank">この商品を含むブログ (66件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div>　さらっと読んですぐ使いこなしたい方に</p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4798118443/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51hcs7og2fL._SL160_.jpg" class="hatena-asin-detail-image" alt="ダイアグラム別UML徹底活用 第2版 (DB Magazine SELECTION)" title="ダイアグラム別UML徹底活用 第2版 (DB Magazine SELECTION)"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4798118443/hatena-blog-22/">ダイアグラム別UML徹底活用 第2版 (DB Magazine SELECTION)</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> 井上樹</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> 翔泳社</li><li><span class="hatena-asin-detail-label">発売日:</span> 2011/02/25</li><li><span class="hatena-asin-detail-label">メディア:</span> 大型本</li><li><span class="hatena-asin-detail-label">購入</span>: 1人 <span class="hatena-asin-detail-label">クリック</span>: 5回</li><li><a href="http://d.hatena.ne.jp/asin/4798118443/hatena-blog-22" target="_blank">この商品を含むブログ (2件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div>　Kindle版もあります</p>
</description>          <pubDate>Thu, 02 Jul 2015 20:03:56 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450098619942</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150623/20150623123325.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>たのしいフォントえらび 〜 GoogleやDEAN & DELUCA、SPEEDAの事例から 〜</title>
          <link>http://tech.uzabase.com/entry/2015/06/11/164718</link>          <description><p>こんにちは。ユーザベースのデザイナー、広田です。企業・業界情報サービス「SPEEDA」を担当しています。</p>

<p>とうとう、ブログの順番が回ってきました。
UZABASE Tech Blogの記事ネタは、ユーザベースのエンジニアが一堂に集まる週一のミーティング、そこで話す持ち回りのライトニングトークが元になっています。もちろん、それがすべてではありませんが、記事を書く順番としてはそんな感じです。
そして、2月に入社した私にも、ライトニングトークの順番、すなわちブログを書く順番が回ってきたというわけです。</p>

<p>テックミーティングの参加者は、当然ですが、エンジニアばかり。
なので、私にとってはチンプンカンプンのエンジニア用語が並ぶわけですが、そんな中で私が話せることってなんだろう？と（一応、真剣に）考えた結果、エンジニアにとっても身近であろうフォントについて話すことにしました。</p>

<p>というのも、入社以来、ずっと気になっていたSPEEDAのロゴのルーツ。その答えを見つけた良いタイミングでもあったので。</p>

<p>・・・と、ちょっと前置きが長くなってしまいましたが、テーマは「たのしいフォントえらび 〜 GoogleやDEAN &amp; DELUCA、SPEEDAの事例から 〜」に決定しました。</p>

<h3>目次</h3>

<p>・<a href="#section1">SPEEDAのロゴのルーツ</a><br>
・<a href="#section2">SPEEDAのお仲間さがし</a><br>
・<a href="#section3">有名ブランドのロゴは何のフォントを使ってる？</a><br>
・<a href="#section4">もしもユーザベースが第3の事業を始めたら...</a></p>

<h3><a name="section1"></a>SPEEDAのロゴのルーツ</h3>

<p>さて、本題のSPEEDAのロゴですが、残念ながらこのロゴの成り立ちを語れる人を見つけることはできませんでした。それで、ずっとモヤモヤした毎日を過ごしていたわけです。これに似たフォントはなんだろう、、、と。そうやってSPEEDAのロゴのフォントのことをずっと想っていたら、とうとう出会ってしまったんです。</p>

<p>それは、ある日、突然。まるで天から降ってきたかのように。久しぶりに見たフォント本の中にいました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531104840.jpg" alt="f:id:uzabase:20150531104840j:plain" title="f:id:uzabase:20150531104840j:plain" class="hatena-fotolife" itemprop="image"></span>
2013年発行の「<a href="http://www.graphicsha.co.jp/shosai.php?snumber3=1305">TYPOGRAPHY03</a>」（グラフィック社）</p>

<p>このムックのここに。ほら。SPEEDAのロゴにそっくりでしょ？
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531105845.jpg" alt="f:id:uzabase:20150531105845j:plain" title="f:id:uzabase:20150531105845j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>そう「BANK GOTHIC」というフォントです。
（ムックには「 BANNK GOTHIC」とありますが、これは誤植ですね。）</p>

<p>このフォントに出会った瞬間、もうね、なんとも言えない晴れ晴れした気持ちになったんですよ。出会うべくして出会った赤い糸＝運命の人？みたいな。それはおおげさですが。。。しかも、フォント名にBANK（銀行）とあるなんて。さまざまな企業の財務情報や業界の動向を提供するSPEEDAにぴったりのフォントですね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531111126.png" alt="f:id:uzabase:20150531111126p:plain" title="f:id:uzabase:20150531111126p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>BANK GOTHICはサンセリフ、ウロコのない書体です。その中でも幾何学的図形のような骨格を持つジオメトリック・サンセリフです。
ほら、見てください。ほぼ正方形の形をしていますよね？（青枠に注目）</p>

<p>BANK GOTHICの特徴を他にも挙げると、GやO、Cに見られる正方形部分、この内側部分が直角になっているのに対して、外側が丸みを帯びている点ですね（赤の丸に注目）</p>

<p>参考までに、<a href="http://www.fonts.com/ja/browse/designers/morris-fuller-benton">fonts.com</a> から引用したBANK GOTHICの生みの親、Morris Fuller Bentonについて記しておきます。</p>

<blockquote><p>Morris Fuller Benton – born 1872 in Milwaukee, USA, died 1948 in Morristown, USA – engineer, type designer. After training as a mechanic and engineer, Benton jointed the ATF, where he became type designer and in-house designer with ATF.</p></blockquote>

<p>フォント名が明らかになったところで、SPEEDAのロゴの検証をしていきましょう。</p>

<p>まずは現在のロゴ。これが最終形です。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531112457.png" alt="f:id:uzabase:20150531112457p:plain" title="f:id:uzabase:20150531112457p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>そしてこれが一世代前のロゴ。いつまで使われていたのか、正確なところはわかりません。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531112712.png" alt="f:id:uzabase:20150531112712p:plain" title="f:id:uzabase:20150531112712p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>今のロゴと比較すると一世代前のロゴは少しスリムでしたね。今のロゴのほうが骨太です。その他にも、PとDに変化が見られますね。現在のロゴのほうが尖った印象になっているとと同時に、より堂々とした感じが伝わってきます。そして男性的。</p>

<p>ここからは想像ですが、こんな流れでSPEEDAのロゴができあがったのではないかと。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150603/20150603195800.png" alt="f:id:uzabase:20150603195800p:plain" title="f:id:uzabase:20150603195800p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<ol>
<li>BANK GOTHICでSPEEDAを組む …（ A）</li>
<li>（A）をベースに文字の横幅を少しスリムにする（正方形から長方形に）...（B）</li>
<li>微調整（特にSやE）を繰り返して、一世代前のロゴが完成…（C）</li>
<li>さらに微調整を繰り返して、今のロゴが完成…（D）</li>
</ol>


<h3><a name="section2"></a>SPEEDAのお仲間さがし</h3>

<p>SPEEDAのロゴのルーツを知り、俄然、BANK GOTHICが身近になった私。そこで、BANK GOTHICを使ったロゴのお仲間を探してみました。</p>

<p>Googleで検索してみると、いろいろ見つかります。
いずれもロゴの形を見ての想像でしかありませんが、<a href="http://www.nintendo.co.jp/ds/">NINTENDO DS</a>のNINTENDOやER緊急救命室のER、浅草にあるホテル<a href="http://www.agoraplace-asakusa.com/">AGOLA PLACE</a>などはBANK GOTHICではないかと思います。</p>

<p>そして、私たちのオフィス近くにもBANK GOTHICを見つけました。
恵比寿駅からオフィスに向かう途中にある恵比寿ビジネスタワー。下の写真をご覧ください。この欧文ロゴがBANK GOTHICっぽいんです。
昨年12月、ユーザベースは外苑前からここ恵比寿に移転しましたが、もしかしたら引っ越し先はこのビルにすべきだったかもしれませんね、、、なんて思ったり。
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531115149.jpg" alt="f:id:uzabase:20150531115149j:plain" title="f:id:uzabase:20150531115149j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h3><a name="section3"></a>Google、VOGUE、Dean &amp; Delucaなどのブランドロゴはどのフォントを使ってる？</h3>

<p>ロゴとフォントのことをいろいろ調べていたら、有名ブランドのロゴのフォントも気になってきました。そこで、書籍やインターネットなどで調べてみました。</p>

<h4>LOUIS VUITTON</h4>

<p>多くの人の憧れのファッションブランド <a href="http://jp.louisvuitton.com/">LOUIS VUITTON</a>。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602000621.png" alt="f:id:uzabase:20150602000621p:plain" title="f:id:uzabase:20150602000621p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>これはMacにも標準で搭載されているFutura（フツラ、フーツラ）で組まれたフォントです。字と字の間を調整している以外は、ほぼ原型のまま使っているっぽいです。実は、ユーザベースのロゴもFuturaなんですね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602224304.png" alt="f:id:uzabase:20150602224304p:plain" title="f:id:uzabase:20150602224304p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>VOGUE</h4>

<p>続いて老舗の女性ファッション誌 <a href="http://www.vogue.co.jp/">VOGUE</a>。このロゴで使われているのは、Didot（ディド）です。こちらもMacをお使いの方は持っているんじゃないでしょうか？</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602002309.jpg" alt="f:id:uzabase:20150602002309j:plain" title="f:id:uzabase:20150602002309j:plain" class="hatena-fotolife" itemprop="image"></span>
<a href="http://(http://www.vogue.co.jp/">http://www.vogue.co.jp/</a></p>

<p>あらためて書店で平積みされている女性ファッション誌を見てみると、Didotのように、細いところと太いところの差がはっきりしているロゴが多いですね。特に大人の女性向けファッション誌に。まるで女性の理想的なプロポーション、華奢に見えるのに出ているところは出ている、、、みたいな。そんな印象を受けるフォントです。Didotはそれに加えて丸みもあるので、女性らしいしなやかさも感じます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602224332.png" alt="f:id:uzabase:20150602224332p:plain" title="f:id:uzabase:20150602224332p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>DEAN &amp; DELUCA</h4>

<p>NY生まれのフード＆カフェのお店。見たことのないオシャレなパッケージの食材が並んでいて、本当に楽しいお店です。このロゴはCopperplate Gothicですね。いろんなところで目にする人気のフォントです。こちらも私のMacにはインストールされています。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602003156.jpg" alt="f:id:uzabase:20150602003156j:plain" title="f:id:uzabase:20150602003156j:plain" class="hatena-fotolife" itemprop="image"></span>
<a href="http://www.deandeluca.com/">http://www.deandeluca.com/</a></p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602224348.png" alt="f:id:uzabase:20150602224348p:plain" title="f:id:uzabase:20150602224348p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>Google</h4>

<p>そして、いつもお世話になっているGoogle。このロゴで使われているのはCatull BQです。ほぼ手を加えず原型のまま使っているっぽいです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150602/20150602003639.jpg" alt="f:id:uzabase:20150602003639j:plain" title="f:id:uzabase:20150602003639j:plain" class="hatena-fotolife" itemprop="image"></span>
<a href="http://www.google.co.jp/">http://www.google.co.jp/</a></p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.myfonts.com%2Ffonts%2Fberthold%2Fcatull-bq%2F" title="Catull® BQ - Desktop font « MyFonts" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.myfonts.com/fonts/berthold/catull-bq/">Catull® BQ - Desktop font « MyFonts</a></iframe><cite class="hatena-citation"><a href="https://www.myfonts.com/fonts/berthold/catull-bq/">www.myfonts.com</a></cite></p>

<h3><a name="section4"></a>もしもユーザベースが第3の事業を始めたら...</h3>

<p>さて、ここからは私の妄想です。「もしもユーザベースが第3の事業を始めたら…」を妄想して、こんなときにはこんなフォントが合うんじゃ？という視点で、フォントを探してみました。</p>

<blockquote><p>ユーザベースは、法人向け業界分析情報データベース「SPEEDA」と、経済情報に特化したニュース共有サービス「」という2つのプロダクトの開発・運営を行っています。</p></blockquote>

<h4>もしもユーザベースが「ホラー映画」を作ったら...</h4>

<p>そこで、こわーいフォントを探してみました。</p>

<p>さて、どうでしょう？　これはAdobe Creative CloudのTypekitにもあるAdobeのIronwoodというフォントです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150603/20150603232308.jpg" alt="f:id:uzabase:20150603232308j:plain" title="f:id:uzabase:20150603232308j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p><a href="https://www.fontshop.com/families/ironwood">https://www.fontshop.com/families/ironwood</a></p>

<p>こうやってみるとそんなに怖そうに見えませんが、少し色を工夫すると、イギリスあたりの誰も住んでいない古い館っぽっく見えてきませんか？　まるでドラキュラの棲家のような。また、不安定な 3本のラインがなかなか良い効果が出ているようで、「裏切り」や「壊れる」といったサスペンス映画の要素も見えてきます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150604/20150604002217.jpg" alt="f:id:uzabase:20150604002217j:plain" title="f:id:uzabase:20150604002217j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>dafont.comを探せば、それはそれは怖いフォントも他にもたくさん見つかるんですが、お勧めしてもいいものとそうでないものの選別が難しいので、ここで紹介するのはやめました。</p>

<h4>もしもユーザベースが「自然派化粧品」を売り出したら...</h4>

<p>続いて、同じくAdobe Creative CloudのTypekitにもあるBlakely というフォントを使って、自然派化粧品のロゴを作ってみました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150604/20150604225039.jpg" alt="f:id:uzabase:20150604225039j:plain" title="f:id:uzabase:20150604225039j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p><a href="https://www.fontshop.com/families/blakely">https://www.fontshop.com/families/blakely</a></p>

<p>上の図はBoldですが、一番細いLightを使うと印象がぐっと変わります。このLightを使って、今度はNewsPIcksでロゴを作ってみました。</p>

<p>ターゲットは20代女性くらい？　「いつまでもみずみずしいお肌をキープしたい女性へ」「敏感肌のあなたへ」といったところかな。とても涼しげな感じに仕上がったので、今のこの暑い季節に売り出したいところですね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150604/20150604225617.png" alt="f:id:uzabase:20150604225617p:plain" title="f:id:uzabase:20150604225617p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>もしもユーザベースが「子ども服ブランド」を立ち上げたら…</h4>

<p>最後に、もしもユーザベースが「子ども服ブランド」を立ち上げたら…と題して、楽しくてやさしいフォントを探してみました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150603/20150603221133.jpg" alt="f:id:uzabase:20150603221133j:plain" title="f:id:uzabase:20150603221133j:plain" class="hatena-fotolife" itemprop="image"></span>
<a href="https://www.fontshop.com/families/scruff">https://www.fontshop.com/families/scruff</a></p>

<p>どうでしょうか？ これは scruff というフォントです。
おもちゃ箱をひっくり返したように、とっても楽しそうですよね。</p>

<p>「S」なんて、おもちゃの電車を走らせる線路に見えてくるし、「f」が2つ並んでいるところは双子の兄弟がひげダンスしているように見えてくる。ほら、他の文字も全部楽しそうですよね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150603/20150603224352.jpg" alt="f:id:uzabase:20150603224352j:plain" title="f:id:uzabase:20150603224352j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>このフォントは、元気な子ども服ブランドや知育の玩具メーカーのロゴにきっと似合うはず。例えば、こんな感じでね。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150604/20150604220204.png" alt="f:id:uzabase:20150604220204p:plain" title="f:id:uzabase:20150604220204p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>ちなみに、キャッチコピーで使用したフォントは「<a href="https://www.fontshop.com/families/blakely">やさしさゴシック</a>」というフリーのフォントです。日本語のフリーフォントでこれだけ文字の種類が揃っているのは珍しいのでとても貴重です。</p>

<p>長々とフォントについて書きましたが、最後に、敬愛する日本人フォントデザイナー、小林章さんの言葉を載せて、締めくくりたいと思います。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531130901.png" alt="f:id:uzabase:20150531130901p:plain" title="f:id:uzabase:20150531130901p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>ユーザベースではエンジニアを募集しています！</p>

<ul>
<li>大規模で多種多様なデータを扱うことに興味がある方</li>
<li>とにかく技術が好きな方</li>
<li>様々なバックグラウンドを持つ人材と働いてみたい方</li>
</ul>


<p>以上に一つでも当てはまる方は、一度オフィスに遊びに来てください！</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F11497" title="巨大金融メディアに打ち勝つサービスをつくりたいエンジニアWanted! by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/projects/11497">巨大金融メディアに打ち勝つサービスをつくりたいエンジニアWanted! by 株式会社ユーザベース</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/11497">www.wantedly.com</a></cite></p>

<p><b>【参考サイト・書籍】</b></p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fmatome.naver.jp%2Fodai%2F2133151854135573901" title="有名企業やサイトのロゴに使用されているフォントまとめ - NAVER まとめ" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://matome.naver.jp/odai/2133151854135573901">有名企業やサイトのロゴに使用されているフォントまとめ - NAVER まとめ</a></iframe><cite class="hatena-citation"><a href="http://matome.naver.jp/odai/2133151854135573901">matome.naver.jp</a></cite></p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fmatome.naver.jp%2Fodai%2F2135168573243723001" title="名作フォントと有名ロゴのおいしい関係 - NAVER まとめ" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://matome.naver.jp/odai/2135168573243723001">名作フォントと有名ロゴのおいしい関係 - NAVER まとめ</a></iframe><cite class="hatena-citation"><a href="http://matome.naver.jp/odai/2135168573243723001">matome.naver.jp</a></cite></p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4766124758/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51fM19fMW2L._SL160_.jpg" class="hatena-asin-detail-image" alt="TYPOGRAPHY(タイポグラフィ)03  デザイナーなら覚えておくべき 厳選フォント350" title="TYPOGRAPHY(タイポグラフィ)03  デザイナーなら覚えておくべき 厳選フォント350"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4766124758/hatena-blog-22/">TYPOGRAPHY(タイポグラフィ)03  デザイナーなら覚えておくべき 厳選フォント350</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> グラフィック社編集部</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> グラフィック社</li><li><span class="hatena-asin-detail-label">発売日:</span> 2013/05/07</li><li><span class="hatena-asin-detail-label">メディア:</span> 大型本</li><li><a href="http://d.hatena.ne.jp/asin/4766124758/hatena-blog-22" target="_blank">この商品を含むブログ (4件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4568504287/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51Dtxr9LBSL._SL160_.jpg" class="hatena-asin-detail-image" alt="フォントのふしぎ  ブランドのロゴはなぜ高そうに見えるのか？" title="フォントのふしぎ  ブランドのロゴはなぜ高そうに見えるのか？"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4568504287/hatena-blog-22/">フォントのふしぎ  ブランドのロゴはなぜ高そうに見えるのか？</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> 小林章</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> 美術出版社</li><li><span class="hatena-asin-detail-label">発売日:</span> 2011/01/17</li><li><span class="hatena-asin-detail-label">メディア:</span> 単行本（ソフトカバー）</li><li><span class="hatena-asin-detail-label">購入</span>: 11人 <span class="hatena-asin-detail-label">クリック</span>: 235回</li><li><a href="http://d.hatena.ne.jp/asin/4568504287/hatena-blog-22" target="_blank">この商品を含むブログ (33件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4756245676/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51CbPBYN4VL._SL160_.jpg" class="hatena-asin-detail-image" alt="新しい価値を生み出すためのブランディングプロセス" title="新しい価値を生み出すためのブランディングプロセス"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4756245676/hatena-blog-22/">新しい価値を生み出すためのブランディングプロセス</a></p><ul><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> パイインターナショナル</li><li><span class="hatena-asin-detail-label">発売日:</span> 2015/01/20</li><li><span class="hatena-asin-detail-label">メディア:</span> 単行本</li><li><a href="http://d.hatena.ne.jp/asin/4756245676/hatena-blog-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>
</description>          <pubDate>Thu, 11 Jun 2015 16:47:18 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450095961553</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150531/20150531104840.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>ユーザベースの自由な社風を支える「みんなの会」のつくり方（動画環境編）</title>
          <link>http://tech.uzabase.com/entry/2015/06/02/183335</link>          <description><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150526/20150526122646.jpg" alt="f:id:uzabase:20150526122646j:plain" title="f:id:uzabase:20150526122646j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>企業・業界情報データベース<a href="http://www.uzabase.com/speeda/">「SPEEDA」</a>の開発チームに所属している川口と申します。</p>

<p>ユーザベースで大事にしている価値観として、「<strong>自由主義で行こう</strong>」があります。きちんと仕事の結果を出せば、出社時間や服装は自由で、出社の義務もないというものです。</p>

<p>一方、自由に対する責任の一つとして、毎週一回の全社会議だけは全員出席する必要があります。この全社会議が「<strong>みんなの会（Town Hall Meeting）</strong>」です。ここでは各チームの進捗報告やリリースされた機能の発表、事務連絡や新メンバーの紹介などを行っています。（以前は「全体進捗会議」という名前でしたが、社内投票の結果、この名前になりました。）</p>

<p>私が入社した2011年当時、オフィスは東京だけで、全体会議の出席メンバーも20人ぐらいでしたので、会議室に全員入り切るぐらいでした。それからオフィスも2回移転して、上海、シンガポール、香港と海外にも拠点も広がり、全体で160人前後のメンバーになりました。今でも全員が出席するスタイルでの会議は続いているのですが、各海外拠点への生中継を毎回行うようになり、海外メンバーからの発表や質問なども可能にしています。</p>

<p>このシステムの構築やオペレーションには私もかかわっており、試行錯誤を続けながらバージョンアップしてきました。この記事では、そんな「みんなの会」を支えている現在のシステムについて少しご紹介したいと思います。</p>

<p>なお、「みんなの会」については、先日公開されたSELECKの記事や、本ブログの竹内（当社チーフテクノロジスト）の記事でもご紹介しています。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fseleck.cc%2Farticle%2F11" title="ベンチャーからグローバル企業へ　ユーザベースCTOが作った「ニコ動」式の全社会議 | SELECK" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://seleck.cc/article/11">ベンチャーからグローバル企業へ　ユーザベースCTOが作った「ニコ動」式の全社会議 | SELECK</a></iframe><cite class="hatena-citation"><a href="https://seleck.cc/article/11">seleck.cc</a></cite>
<iframe src="http://tech.uzabase.com/embed/2015/06/01/143202" title="ニコニコメソッドプレゼンを全社会議に取り入れてみたら会議が面白くなった - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"><a href="http://tech.uzabase.com/entry/2015/06/01/143202">ニコニコメソッドプレゼンを全社会議に取り入れてみたら会議が面白くなった - UZABASE Tech Blog</a></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2015/06/01/143202">tech.uzabase.com</a></cite></p>

<h3>目次</h3>

<ul>
<li><a href="#1">Zoomを使って全世界と中継</a></li>
<li><a href="#2">スライドの配信もZoomの画面共有で</a></li>
<li><a href="#3">「参加者の顔が見えること」が何より重要</a></li>
<li><a href="#4">Wii Uのマイクも使って音声環境を改善</a></li>
<li><a href="#5">有志メンバーによる同時通訳</a></li>
<li><a href="#6">ニコニコメソッドプレゼンで一体感のあるコミュニケーション</a></li>
<li><a href="#7">まとめ</a></li>
</ul>


<h2><a name="1"></a>Zoomを使って全世界と中継</h2>

<p>「みんなの会」の中心となるWeb会議システムですが、<a href="http://zoom.us/">「Zoom」</a>という製品を使用しています。いろいろな製品がある中で、「Zoom」では最大100ユーザまで同時接続可能というところが大きな特長です。</p>

<p>ユーザベースで現在使用しているのは25ユーザまでのプランで、海外拠点の各メンバーが接続するだけでなく、在宅や出張先からのリモートでの参加も出来ています。</p>

<p>なお、Zoomの無料アカウントでは最大40分で会議が切れてしまうという制限があるため、長時間会議を行う場合はProアカウント（$9.99/Month）が必要になります。</p>

<p>会議への参加は、主催者からの招待メール中のリンクをクリックすることで行いますが、初めて参加する場合はアプリのインストールも自動的に行われます。</p>

<p>Windows、Macはもちろん、iPad・iPhoneやAndroid用のアプリも公開されていて、スマートフォンでも後述の画面共有やチャットを含めた一通りの機能が可能です。</p>

<p>「Zoom」はなかなか高機能でよく出来ていると思うのですが、「Skype」などに比べると若干取っつきにくいためか、日本ではあまり知られていなさそうです。これからの普及に期待しています。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fzoom.us%2F" title="Video Conferencing, Web Conferencing, Online Meetings, Screen Sharing" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://zoom.us/">Video Conferencing, Web Conferencing, Online Meetings, Screen Sharing</a></iframe><cite class="hatena-citation"><a href="http://zoom.us/">zoom.us</a></cite></p>

<h2><a name="2"></a>スライドの配信もZoomの画面共有で</h2>

<p>「みんなの会」では、東京オフィスのプロジェクター画面に、発表内容をまとめたプレゼンテーションファイルを映します。同時に、「Zoom」の画面共有機能によって、海外やリモートでの参加者にも同じ画面が表示できます。</p>

<p>リモート表示ではレスポンスが気になるところですが、スライド切り替え時の反映もスムーズですし、画質がオリジナルより大きく劣ることもありませんので、十分実用的だと思います。</p>

<p>「Zoom」の画面共有では、共有対象のウィンドウをアプリ単位もしくはデスクトップ全体で指定します。「みんなの会」のプレゼンテーションファイルはGoogle Driveのスライド形式（Googleスライド）で作成しており、ブラウザにてプレゼンテーションを行いますので、Google Chromeのウィンドウを共有しています。ケースバイケースですが、他の会議では、お手軽にデスクトップ全体を共有することも多いです。</p>

<p>ところで、スライドを開いて、メニューから「プレゼンテーションを開始」を実行すると、プレゼンテーションが全画面で表示されますが、Zoomでブラウザウィンドウを共有している場合は、全画面表示は共有対象外となるので、他のユーザにスライド画面が映らなくなってしまいます。</p>

<p>そこで、Google Chromeを使用する場合のみですが、「スピーカーノートを使って開始」のメニューを実行すると、ブラウザのタブ内にプレゼンテーション画面が表示されます。少しマニアックな話ですが、Zoomを使ってGoogleスライドの画面共有を行う場合はこの方法がおすめです。</p>

<p>ちなみにGoogleスライドですが、PowerPoint等と比較すると凝ったデザインや動きのものは作成しにくいですが、一つのファイルを複数人で同時に編集することが可能で、マージや差し替えの手間が省けるので、こういった会議の資料作成には非常に便利です。</p>

<p>なお、PowerPoint等のプレゼンテーションファイルからの変換も可能ですが、レイアウトが崩れることが多いので、注意が必要です。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.google.com%2Fintl%2Fja_jp%2Fdrive%2F" title="Google ドライブ - 写真やドキュメントなど、ファイルのクラウド ストレージとバックアップ" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.google.com/intl/ja_jp/drive/">Google ドライブ - 写真やドキュメントなど、ファイルのクラウド ストレージとバックアップ</a></iframe><cite class="hatena-citation"><a href="https://www.google.com/intl/ja_jp/drive/">www.google.com</a></cite></p>

<h2><a name="3"></a>「参加者の顔が見えること」が何より重要</h2>

<p>「Zoom」では、会議の参加者の映像を画面に映すことが可能です。参加者がカメラを持っている場合に限定されますが、やはり声だけ聞こえるよりも、顔の表情も一緒に見えるのは重要なポイントだと思います。</p>

<p>なお、東京オフィスの場合は会議室に何十人ものメンバーが集まるので、通常のWebカメラでは全員を1つの画面に映すことは困難です。そこでいろいろ試しているので、少し紹介します。</p>

<ul>
<li>BUFFALOの<a href="http://buffalo.jp/product/multimedia/web-camera/bsw180abk/">「BSW180ABK」</a>というWebカメラは、180°の広角レンズで会議室全体の様子を映すことが出来て便利です。
ただし、ズーム機能も無いため、細かい部分を映すのには向いていません。</li>
<li>発表者の表情が見えなかったり、質問者が誰か分からないという意見が挙がっていたので、私物のDVビデオカメラを持ち込んでみました。カメラマンが発表者や質問者にズームしたり、会議室全体を映したりと工夫出来るし、映りが良いと好評なようです。</li>
</ul>


<p>しばらくはDVビデオカメラを使用してみたいと思いますが、段々と設備が大がかりになってきました。</p>

<p>なお、MacへのDVビデオカメラの接続ですが、<a href="http://store.apple.com/jp/product/MD464ZM">「Thunderbolt - FireWireアダプタ」</a>と9pin-4pinのFireWireケーブルを使用しています。これで、MacからはWebカメラと同様のビデオデバイスとして認識されますので、Zoomの設定画面にて選択することが可能になります。</p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00E0D1RWI/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/31kRCg1Rh-L._SL160_.jpg" class="hatena-asin-detail-image" alt="iBUFFALO マイク内蔵60万画素WEBカメラ 180°広角モデル BSW180ABK" title="iBUFFALO マイク内蔵60万画素WEBカメラ 180°広角モデル BSW180ABK"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00E0D1RWI/hatena-blog-22/">iBUFFALO マイク内蔵60万画素WEBカメラ 180°広角モデル BSW180ABK</a></p><ul><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> バッファロー</li><li><span class="hatena-asin-detail-label">発売日:</span> 2013/08/25</li><li><span class="hatena-asin-detail-label">メディア:</span> Personal Computers</li><li><a href="http://d.hatena.ne.jp/asin/B00E0D1RWI/hatena-blog-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div>
<div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B008RXYOKY/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/21sRgqMdUKL._SL160_.jpg" class="hatena-asin-detail-image" alt="アップル Thunderbolt - FireWireアダプタ MD464ZM/A" title="アップル Thunderbolt - FireWireアダプタ MD464ZM/A"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B008RXYOKY/hatena-blog-22/">アップル Thunderbolt - FireWireアダプタ MD464ZM/A</a></p><ul><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> アップル</li><li><span class="hatena-asin-detail-label">メディア:</span> Personal Computers</li><li><a href="http://d.hatena.ne.jp/asin/B008RXYOKY/hatena-blog-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<h2><a name="4"></a>Wii Uのマイクも使って音声環境を改善</h2>

<p>「みんなの会」では、海外を含めて、毎回20台ぐらいのPCがWeb会議に参加しています。</p>

<p>インターネットを使用しているので、一時的に音声が途切れたりする時もありますが、音声の品質や遅延はあまり気にならないため、その点でもZoomは高評価です。</p>

<p>ところで、会議室に複数の人が集まってWeb会議に参加する場合、通常ではマイクは一つだけ設置すると思いますが、マイクから離れた場所にいる人の声が聞き取りづらく、聞く側にとってストレスになることがしばしばあります。</p>

<p>そこで、マイクについてもいろいろ試しているので、少し紹介いたします。</p>

<ul>
<li>SANWA DIRECTの<a href="http://direct.sanwa.co.jp/ItemPage/400-MC001">「400-MC001」</a>というUSB接続のスタンドマイクは、高集音かつ全指向性の本格的な製品です。
声の大きさにもよりますが、10mぐらい離れた場所に座っている人の発言でもちゃんと拾ってくれるので、なかなか優秀です。</li>
<li><a href="http://www.nintendo.co.jp/wiiu/hardware/accessories/index.html">Nitendo Wii U</a>のワイヤレスマイク「WUP-019」ですが、実はWindowsやMacでも使用することが出来ます。マイクのレシーバーをUSB端子に差すだけで、Macから音声入力デバイスと認識されるので、とても簡単です。音声も非常にクリアに聞こえるので、大いに活用しています。</li>
<li>Wii Uでは2本同時に使用出来るそうなので、Macにワイヤレスマイク「WUP-019」を2台繋いでみましたが、残念ながら1つしか認識しないようです。</li>
</ul>


<p>ワイヤレスマイクとスタンドマイクを同時に使用することが出来れば最高なのですが、Zoomではマイク、スピーカーとも1つのデバイスしか設定出来ません。</p>

<p>そこで、何か手は無いかと探したところ、Macでは以下のソフトウェアを組み合わせることで可能ということが分かりました。</p>

<ul>
<li><a href="https://code.google.com/p/soundflower/">Soundflower</a>

<ul>
<li>「仮想サウンドデバイス」で、例えばMacでインターネット中継を行う時に、同じMacで再生した音楽ファイルを配信するような場合に使用出来ます。</li>
</ul>
</li>
<li><a href="http://blog.kawauso.com/ladiocast">LadioCast</a>

<ul>
<li>複数デバイスからの音声入力をミックスしたり、複数デバイスに出力することの出来るミキサーです。</li>
</ul>
</li>
</ul>


<p>LadioCastでワイヤレスマイクと集音マイクをミキシングしてSoundflowerに出力し、Zoomの音声入力デバイスとしてSoundflowerを指定することで、両方のマイクの音声がWeb会議の参加者に聞こえるという仕組みです。</p>

<p>これによって、発表者がワイヤレスマイクで話しながら、聴衆の拍手や笑い声を集音マイクで同時に拾うことが出来ています。さらに、LadioCastで発表者の声に合わせて音量を調整することで、より聞き取りやすくなっていると思います。</p>

<p>また、現在のオフィスでは、HDMI出力のプロジェクタにスピーカーが付いており、東京オフィス以外のメンバーの発言はこのプロジェクターから聞こえます。</p>

<p>ハウリングを避けるため、通常ではマイクの音はスピーカーから聞こえないのですが、LadioCastの設定を工夫して、ワイヤレスマイクの音声のみ、プロジェクターに出すようにしています。東京オフィスのように広い部屋では、発表者の声が聞こえにくいこともあるので、この簡易拡声器機能がとても便利です。</p>

<p>なお、「Zoom」に参加している各メンバーは、基本的にマイクはミュート状態で、発言時のみマイクをオンにするようにしています。そのままでは、キーボードの操作音や周囲の会話などを拾ってしまうためです。</p>

<p><div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B008F1S3PU/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/41GPhvAFODL._SL160_.jpg" class="hatena-asin-detail-image" alt="サンワダイレクト WEB会議マイク USBマイク PCマイク 高集音 全指向性&単一指向性 400-MC001" title="サンワダイレクト WEB会議マイク USBマイク PCマイク 高集音 全指向性&単一指向性 400-MC001"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B008F1S3PU/hatena-blog-22/">サンワダイレクト WEB会議マイク USBマイク PCマイク 高集音 全指向性&単一指向性 400-MC001</a></p><ul><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> サンワダイレクト</li><li><span class="hatena-asin-detail-label">メディア:</span> Personal Computers</li><li><a href="http://d.hatena.ne.jp/asin/B008F1S3PU/hatena-blog-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div>
<div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00FKSWGVI/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/41DTcM%2BHU5L._SL160_.jpg" class="hatena-asin-detail-image" alt="Wii U ワイヤレスマイク" title="Wii U ワイヤレスマイク"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00FKSWGVI/hatena-blog-22/">Wii U ワイヤレスマイク</a></p><ul><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> 任天堂</li><li><span class="hatena-asin-detail-label">発売日:</span> 2013/12/12</li><li><span class="hatena-asin-detail-label">メディア:</span> Video Game</li><li><a href="http://d.hatena.ne.jp/asin/B00FKSWGVI/hatena-blog-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div>
<a href="https://code.google.com/p/soundflower/">https://code.google.com/p/soundflower/</a><cite class="hatena-citation"><a href="https://code.google.com/p/soundflower/">code.google.com</a></cite>
<a href="http://blog.kawauso.com/ladiocast">http://blog.kawauso.com/ladiocast</a><cite class="hatena-citation"><a href="http://blog.kawauso.com/ladiocast">blog.kawauso.com</a></cite></p>

<h2><a name="5"></a>有志メンバーによる同時通訳</h2>

<p>海外のオフィスも繋いで会議を行う場合に避けられない問題として、言語の壁があります。これについても、様々なトライアルを行ってきました。</p>

<p>例えば、「みんなの会」を資料・発表とも英語で行っていた時期もありました。ユーザベースには英語の得意なメンバーも多いので、各チームとも流暢な英語にて発表が行われていましたが、もちろん全員そうではありません。私は英語が得意ではないので、事前に英訳した原稿を用意して臨んだのですが、ちゃんと伝わっていたのか怪しく、申し訳なかったです。</p>

<p>現在は、日本語版の資料と英語版の資料を用意して、2画面あるプロジェクターに片方ずつ映すようにしています。なお、Zoomで共有するのは英語版のみで、日本語版の画面はそれ専用のPCで映しています。ページ送りはそれぞれ手動で進めていますが、自動的に同期する仕組みも構想中です。</p>

<p>発表は当人の得意な言語で行われますが、Zoomのチャットで、有志メンバーによる同時翻訳が行われています。このため、プロジェクター画面に、プレゼンテーション資料とチャット画面を並べて映しています。翻訳を行うメンバーは、会議室に持ち込んだPCからZoomの会議に参加して、日本語の発表や質問は英語に、英語の発表や質問は日本語に訳して、リアルタイムにチャットに投稿しています。</p>

<p>また、チャットによる文字の通訳だけでは思いが伝わりにくいということで、さらに有志の方に立候補していただき、発表の同時通訳にもチャレンジしています。発表と通訳を交互に行う逐次通訳では倍の時間が必要なので、同時通訳で行うのが理想ですが、システム面での難易度も上がります。</p>

<p>そもそも、Web会議システムで二カ国語の音声に対応しているものはあまり無いようで、Zoomもサポートしていません。そこで、Zoomとは別の、通訳音声用の独立した会議システムにて配信しています。具体的には、各オフィスの専用PCをSkypeで繋いでおり、海外オフィス側でもSkype用のPCで通訳の音声を受信しています。通訳の音声はオフィス全体にスピーカーで流しており、各メンバーは必要に応じてZoomの音声と聞き分けています。</p>

<p>このような構成にしている理由は、当初は1台でZoomとSkypeを両方配信しようとしたのですが、配信側も受信側も準備にも時間がかかるし、PCの動作も不安定になってしまったためです。「みんなの会」は全社で行う会議ですので、トラブルが起きた場合でもすぐ復旧出来るように、なるべくシンプルな構成を心がけています。</p>

<p>なお、資料に沿った発表だけとは限らないし、専門用語が多く出てくる内容もあるので、翻訳を引き受けていただいている方々にはとても感謝しています。当社代表・新野による「白熱教室」という、その場でのディスカッションが主体となることもあるのですが、そういう会では翻訳がかなりハードだそうです。</p>

<h2><a name="6"></a>ニコニコメソッドプレゼンで一体感のあるコミュニケーション</h2>

<p>「みんなの会」に社員がもっと参加するための仕組みとして、当社オリジナルの“字幕コメントシステム”を取り入れました。これは、Google Chromeの機能拡張を使って、発表内容についての参加者からのコメントを、ニコニコ動画のようにプレゼンテーション画面上に字幕で流すものです。本記事の冒頭に示した画像が、スライドに字幕コメントがつけられている様子です。（ブログで紹介用に弾幕を貼ってもらいました。）</p>

<p>このシステムは、当社チーフテクノロジストの竹内が一晩で作成したそうです。これについては、当ブログにて竹内から技術背景についてご紹介しました。</p>

<p><iframe src="http://tech.uzabase.com/embed/2015/06/01/143202" title="ニコニコメソッドプレゼンを全社会議に取り入れてみたら会議が面白くなった - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"><a href="http://tech.uzabase.com/entry/2015/06/01/143202">ニコニコメソッドプレゼンを全社会議に取り入れてみたら会議が面白くなった - UZABASE Tech Blog</a></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2015/06/01/143202">tech.uzabase.com</a></cite>
<iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fchimerast%2Fniconico-speenya" title="chimerast/niconico-speenya" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://github.com/chimerast/niconico-speenya">chimerast/niconico-speenya</a></iframe><cite class="hatena-citation"><a href="https://github.com/chimerast/niconico-speenya">github.com</a></cite></p>

<p>全社会議というと真面目で少し堅いイメージがありますので、当初はこのようなコンテンツが受け入れられるのか不安でした。ところが、いざ始めて見ると予想以上に好評で、もはや「みんなの会」に無くてはならないツールになりました。</p>

<p>例えば、SPEEDAやの新機能のリリースについての報告では、「いいね！」のマークが画面を埋め尽くしたり、バックオフィスからの経費精算手順の説明では、いつも間違っていた人から「すみませんでした」というコメントがあったり…。今までよりもリアクションが遙かにしやすくなり、会議に参加しているという意識が強くなって、「みんなの会」の雰囲気もかなり変わったと思います。</p>

<h2><a name="7"></a>まとめ</h2>

<p>今回の記事では、「みんなの会」のシステムについて、一通りご紹介いたしました。まだまだ完成形とは言えず、課題も多いのですが、その一方でかなり複雑になってしまっているので、よりシンプルにしていきたいと思います。機会があれば、さらに細かい部分についても、詳しく説明してみたいと思います。</p>

<p>ユーザベースの「世界一の経済メディアをつくる」というミッション実現のため、今後さらに社員数も増え、新しいオフィスも開設されていくと思います。物理的な距離があっても、「みんなの会」には全てのメンバーが同じように参加出来るべきです。完全な実現は難しいかもしれませんが、メンバーのアイデアとテクノロジーの力で、少しでも理想に近付けられればと思います。</p>

<p>ユーザベースでは、SPEEDAやに携わっていただくエンジニアを募集中です。こういったシステム構築や、企業カルチャーをつくる「みんなの会」などの取り組みに興味のある方も、採用ページやWantedlyからお気軽にご連絡ください。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.uzabase.com%2Fcareer%2F%23career-sec1" title="CAREER | 株式会社ユーザベース | UZABASE, Inc." class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://www.uzabase.com/career/#career-sec1">CAREER | 株式会社ユーザベース | UZABASE, Inc.</a></iframe><cite class="hatena-citation"><a href="http://www.uzabase.com/career/#career-sec1">www.uzabase.com</a></cite>
<iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F11448" title="100年に一度のメディア変革期！世界一のニュースプラットフォームを創ろう by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/projects/11448">100年に一度のメディア変革期！世界一のニュースプラットフォームを創ろう by 株式会社ユーザベース</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/11448">www.wantedly.com</a></cite>
<iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F11497" title="巨大金融メディアに打ち勝つサービスをつくりたいエンジニアWanted! by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/projects/11497">巨大金融メディアに打ち勝つサービスをつくりたいエンジニアWanted! by 株式会社ユーザベース</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/11497">www.wantedly.com</a></cite>
<iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fprojects%2F19575" title="情報社会にイノベーションを起こせ！エンジニアインターン募集 by 株式会社ユーザベース" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/projects/19575">情報社会にイノベーションを起こせ！エンジニアインターン募集 by 株式会社ユーザベース</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/projects/19575">www.wantedly.com</a></cite></p>
</description>          <pubDate>Tue, 02 Jun 2015 18:33:35 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450087345655</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150526/20150526122646.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>ニコニコメソッドプレゼンを全社会議に取り入れてみたら会議が面白くなった</title>
          <link>http://tech.uzabase.com/entry/2015/06/01/143202</link>          <description><p>技術チーム竹内(@<a class="twitter-user-screen-name" href="http://twitter.com/chimerast">chimerast</a>)です。</p>

<p>作ったものが知らない間に<a href="https://seleck.cc/article/11">記事</a>のネタにされていたので、どんな仕組みで動いているか技術的なところについて書いてみます。どう使われているかの細かい話は、後日ブログ内に別の記事が上がる予定です。</p>

<p><i>（6/2 追記：「みんなの会」の動画配信システムについて記事を投稿しました。</i>）
<iframe src="http://tech.uzabase.com/embed/2015/06/02/183335" title="ユーザベースの自由な社風を支える「みんなの会」のつくり方（動画環境編） - UZABASE Tech Blog" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"><a href="http://tech.uzabase.com/entry/2015/06/02/183335">ユーザベースの自由な社風を支える「みんなの会」のつくり方（動画環境編） - UZABASE Tech Blog</a></iframe><cite class="hatena-citation"><a href="http://tech.uzabase.com/entry/2015/06/02/183335">tech.uzabase.com</a></cite></p>

<h3>全社会議で「ニコニコメソッドプレゼン」</h3>

<p>だいぶ昔にWeb業界界隈で話題になった(?)ニコニコメソッドプレゼンを、週一の全社会議で取り入れたところ、プレゼンのエンタメ性が増して以前よりだいぶ面白いものになりました。プレゼンを聞く側の一体感がでて面白くなったのに加え、プレゼンする側としても、今まで聞いてるんだか聞いていないんだかよくわからない状態だったのが、反応が目に見えるようになってやりやすくなりました。</p>

<p>ニコニコメソッドプレゼンとは、視聴者がスマホ等でコメントを入力して、そのコメントがニコニコ動画のようにプレゼン資料の上に流れる、視聴者参加型のプレゼンです。</p>

<p>やるとこんな感じになります(全社会議内でやっている社員の自己紹介タイム)↓</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/h0rErlGD0JM" frameborder="0" allowfullscreen></iframe>


<p>ニコニコメソッドを取り入れることになったきっかけは、全社会議への参加者のコミットメントをどうやったら上げることが出来るかどうかみたいな事を話し合った際に、</p>

<ul>
<li>発言しようにも人数が多くなって発言しづらい雰囲気ができあがってしまっている</li>
<li>海外拠点等のリモートからの参加時に、発言がしづらかったり、会議の盛り上がり具合が伝わりにくい</li>
</ul>


<p>という声があがり、その解決策として、</p>

<ul>
<li>ニコニコ動画みたいに横から匿名の突っ込みを入れるようにできたら発言の機会が増えるんじゃないか</li>
</ul>


<p>という意見が出たことによるものです。</p>

<p>ちょうど、視聴者参加型プレゼンツールを作ってみたいなと思っていたこともあり、一晩夜なべして作りました。</p>

<h3>作ったもの: Chrome機能拡張「NicoNico SPEENYA」</h3>

<p>(Chromeウェブストアでの公開はしてません)</p>

<p>全社会議では、色んなチームが進捗報告することもあり、全員で一つのプレゼン資料を編集出来るGoogle Slidesを使用して発表を行っています。</p>

<p>プレゼンのためのほかのツールを使ったり作ったりすることは、移行コストや作成コストの面で考えられなかったので、Google Slidesをそのまま使うことにして、Chrome機能拡張でその上にコメントを重ねるようなものを作りました。</p>

<p>コメントをするだけでは面白くないので、いいねボタンをつけて、押すと親指の画像が浮き上がって消えるような機能や、それを応用して任意の画像を送り込むような機能もつけてます。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20150531/20150531234517.gif" alt="f:id:chimerast:20150531234517g:plain" title="f:id:chimerast:20150531234517g:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>プログラムはGitHub上でひっそり公開しています。一般向けに機能拡張およびサーバを公開することも考えたのですが、チャンネル機能を作るモチベーションがわかないのと、セキュリティの事を考えると使う人ごとにサーバ立ててもらった方が良い気がするので、そのままにしています。</p>

<p>Forkして拡張していただいたり、面白い機能をつけてPull Requestを送っていただけるとうれしいです。</p>

<p><a href="https://github.com/chimerast/niconico-speenya">chimerast/niconico-speenya &middot; GitHub</a></p>

<h3>作るのに使ったもの</h3>

<ul>
<li><a href="http://socket.io/">Socket.IO</a></li>
<li><a href="https://developer.chrome.com/extensions/getstarted">Google Chrome機能拡張</a></li>
<li><a href="http://www.w3.org/TR/web-animations/">Web Animations API</a></li>
<li><a href="https://nodejs.org/">Node.js</a> + <a href="http://expressjs.com/">Express</a></li>
</ul>


<h4>Socket.IO</h4>

<p>ブラウザで双方向の何かをつくる場合は鉄板の選択ですね。</p>

<p>Chrome機能拡張側でSocket.IOのサーバへの接続を行い、サーバ側からの通知を待って、コメントやイメージ表示の通知があったらそれを表示するという事をやっています。</p>

<h4>Google Chrome機能拡張</h4>

<p>Chromeには、表示される全てのページへJavaScriptを挿入するような機能拡張を作るための拡張ポイントが用意されているのでそれを使いました。</p>

<p><a href="https://developer.chrome.com/extensions/content_scripts">Content Scripts - Google Chrome</a></p>

<p>これに加えて、ツールバーにボタンを置いて、コメント表示のON/OFFを切り替えられるようにしていたりします。</p>

<h4>Web Animations API</h4>

<p>あまり有名ではない機能だと思いますが、HTML5標準のアニメーションAPIです。jQuery.animate()と同じようなものだと思って良いと思います。</p>

<p>ブラウザネイティブなので、動作が軽かったりリソース消費が少なかったりするみたいです。ただし、まだドラフトなのでサポートしていないブラウザも多いです。</p>

<p>あまり依存ライブラリを増やしたくなかったのと、どんなもんなのか使ってみたかったのでアニメーションAPIとして採用しました。</p>

<h4>Node.js + Express</h4>

<p>こったことはせず、普通のAPIサーバとしての使い方をしています。Expressで待ち受けているURLにPOSTが送信されると、Socket.IOを呼び出して、Chrome機能拡張側に通知を行います。</p>

<h3>まとめ</h3>

<p>視聴者参加型のプレゼンは盛り上がります。また、プレゼンする側も面白いプレゼンを作ろうという気になります。</p>

<p>プログラムの総行数はクライアントサーバ合わせて200行ぐらいです。ありものの機能を使うとさくさくっと作れます。</p>

<h3>宣伝</h3>

<p>ユーザベースでは、2015年6月14日(日)に、<a href="http://e2d3.org/about-e2d3-2/?lang=ja">E2D3プロジェクト</a>と一緒にハッカソンを行います。</p>

<p>スマホでのデータビジュアライズ方法が、世の中で試行錯誤されている中、みんなで考えてみようというハッカソンです。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fe2d3.connpass.com%2Fevent%2F14868%2F" title=" &amp; SPEEDA スマートデータエクスペリエンス ハッカソン (2015/06/14 10:00〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://e2d3.connpass.com/event/14868/"> &amp; SPEEDA スマートデータエクスペリエンス ハッカソン (2015/06/14 10:00〜)</a></iframe><cite class="hatena-citation"><a href="http://e2d3.connpass.com/event/14868/">e2d3.connpass.com</a></cite></p>

<p>ネタ的に面白いと思うので是非ご参加ください。</p>

<p>E2D3プロジェクトについてはまた別で記事を書こうと思います。</p>
</description>          <pubDate>Mon, 01 Jun 2015 14:32:02 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450095983310</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/c/chimerast/20150531/20150531234517.gif" type="image/gif" length="0" />
        </item>
      
    
      
      
        <item>
          <title>恵比寿のスタートアップエンジニアが集まる「えびスタ！」#2 を開催しました（ユーザベース、クックパッド、VASILY、エウレカ、はてな）</title>
          <link>http://tech.uzabase.com/entry/2015/05/15/170206</link>          <description><p><a href="http://tech.uzabase.com/entry/2015/04/10/194732">既報</a>の通り、恵比寿近辺のスタートアップエンジニアが集まる勉強会「えびスタ！」#2 を開催しました。少し遅れましたが開催レポートをお届けします。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150513/20150513145913.jpg" alt="f:id:uzabase:20150513145913j:plain" title="f:id:uzabase:20150513145913j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h1>発表資料</h1>

<p>第2回となる今回は、「大規模データの料理法」と題してユーザベース、クックパッド、VASILY、エウレカ、はてなのエンジニアが集まり、各社の事例をご紹介しました。発表内容と資料を以下にまとめます。</p>

<h2>アドベリフィケーションサービス「BrandSafe はてな」の裏側（株式会社はてな 山家 雄介）</h2>

<blockquote><p>2014年8月に株式会社はてなの初のアドテクノロジープロダクトとしてリリースされた「BrandSafe はてな」について、システムを構成するアーキテクチャや、はてな特有のデータを活用して高精度にブランド毀損サイトを判定するための技術的アプローチ、DSP上で広告インプレッションがあった全URLをベースにした、膨大なアドベリフィケーションリクエストをさばくためのインフラ的な工夫などについてお話をする予定です。</p></blockquote>

<h3>発表資料</h3>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fdocs.google.com%2Fpresentation%2Fd%2F1_m8XTOt4Rz--aVGN-qDtrmuaGLu9eWuBA-CRAJWBKt0%2Fedit%3Fusp%3Dsharing" title="アドベリフィケーションサービス「BrandSafe はてな」の裏側" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://docs.google.com/presentation/d/1_m8XTOt4Rz--aVGN-qDtrmuaGLu9eWuBA-CRAJWBKt0/edit?usp=sharing">アドベリフィケーションサービス「BrandSafe はてな」の裏側</a></iframe><cite class="hatena-citation"><a href="https://docs.google.com/presentation/d/1_m8XTOt4Rz--aVGN-qDtrmuaGLu9eWuBA-CRAJWBKt0/edit?usp=sharing">docs.google.com</a></cite></p>

<h2>企業・業界データサービスSPEEDAの複雑怪奇なデータとの格闘（株式会社ユーザベース 北内啓）</h2>

<blockquote><p>急激に増加し続けるSPEEDAの企業データを扱う上での課題や取り組み、今後の展望などについて紹介します。</p></blockquote>

<h3>発表資料</h3>

<p><iframe src="https://www.slideshare.net/slideshow/embed_code/key/C8bvFGYNjwBTDy" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/tau3000/speeda-47444622" title="企業・業界データサービスSPEEDAの複雑怪奇なデータとの格闘" target="_blank">企業・業界データサービスSPEEDAの複雑怪奇なデータとの格闘</a> </strong> from <strong><a href="http://www.slideshare.net/tau3000" target="_blank">Akira Kitauchi</a></strong> </div><cite class="hatena-citation"><a href="http://www.slideshare.net/tau3000/speeda-47444622">www.slideshare.net</a></cite></p>

<h2>iQONのアプリ内のデータ分析基盤の紹介や分析手法について紹介します（今村雅幸 株式会社VASILY）</h2>

<blockquote><p>iQONのアプリ内のデータ分析基盤の紹介や分析手法について紹介します</p></blockquote>

<h3>発表資料</h3>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="596" id="talk_frame_296543" mozallowfullscreen="true" src="//speakerdeck.com/player/aa71354e8c1140278ba2ac59c4f359ae" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/kyuns/iqon-bigquery">speakerdeck.com</a></cite></p>

<h2>ベンチャーならではRedShiftの低コスト運用（株式会社エウレカ 鉄本環）</h2>

<blockquote><p>pairsではRedShiftを用いてマーケティングデータや、アルゴリズム解析をしていますが、 これを低価格で運用しているTIPSをお話いたします。</p></blockquote>

<h3>発表資料</h3>

<p><iframe allowfullscreen="true" allowtransparency="true" frameborder="0" height="463" id="talk_frame_296950" mozallowfullscreen="true" src="//speakerdeck.com/player/864b12be51a445e28e5513e9d3dcf821" style="border:0; padding:0; margin:0; background:transparent;" webkitallowfullscreen="true" width="710"></iframe><cite class="hatena-citation"><a href="https://speakerdeck.com/tamaki0506/bentiyanaradehafalseredshiftdi-kosutoyun-yong">speakerdeck.com</a></cite></p>

<h2>リアルタイム分析サービス『たべみる』を支える高可用性アーキテクチャ（クックパッド株式会社 井上寛之）</h2>

<blockquote><p>「たべみる」は、クックパッドの検索データをウェブから分析できる法人向けのウェブサービスです。 そのアーキテクチャの特徴としてサービスのバックエンドDBとバッチの両方でRedshiftを使っていることが挙げられます。 今回は、Redshiftの可用性を高めるためのクックパッド独自のアーキテクチャについて紹介します。</p></blockquote>

<h3>発表資料</h3>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/3HMWdJOMwi9CkJ" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/inohiro/ebi-sta" title="リアルタイム分析サービス『たべみる』を支える高可用性アーキテクチャ" target="_blank">リアルタイム分析サービス『たべみる』を支える高可用性アーキテクチャ</a> </strong> from <strong><a href="//www.slideshare.net/inohiro" target="_blank">Hiroyuki Inoue</a></strong> </div></p>

<h1>懇親会はエビスビールとピザ＋LT！</h1>

<p>懇親会ではピザと、恵比寿スタートアップということで<b>エビスビール</b>をご用意しました。希望者によるLTもとても盛り上がりました。発表いただいた皆さまありがとうございました！</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150513/20150513151035.jpg" alt="f:id:uzabase:20150513151035j:plain" title="f:id:uzabase:20150513151035j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h2>LT：GoWorker調査（大貫）</h2>

<blockquote><p>データ処理を支えるGoWorkerあたりの紹介など</p></blockquote>

<h3>発表資料</h3>

<p>（確認中）</p>

<h2>LT：E2D3プロジェクトの紹介（株式会社ユーザベース CTO たけうちひでゆき）</h2>

<blockquote><p>Excelで様々なデータ可視化を行えるようになる予定の、E2D3というオープンソースで進めているプロジェクトを紹介します。</p></blockquote>

<h3>発表資料</h3>

<p><iframe src="https://www.slideshare.net/slideshow/embed_code/key/n3gL3DWPlosXlz" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/chimerast/e2d3-47364632" title="E2D3プロジェクトのご紹介@えびスタ！" target="_blank">E2D3プロジェクトのご紹介@えびスタ！</a> </strong> from <strong><a href="http://www.slideshare.net/chimerast" target="_blank">Hideyuki Takeuchi</a></strong> </div><cite class="hatena-citation"><a href="http://www.slideshare.net/chimerast/e2d3-47364632">www.slideshare.net</a></cite></p>

<h2>LT：mecab-ipadic-NEologd の効果的な使い方（LINE株式会社 佐藤敏紀）</h2>

<blockquote><p>「mecab-ipadic-NEologd」は 形態素解析エンジン MeCab のシステム辞書である IPA 辞書を拡張するオープンソースな辞書です。大きな特徴は「大量の新語・固有表現を読み仮名付きで採録されていること」と「最低でも月二回(初旬と中旬)、辞書データが更新されること」です。またライセンスは Apache License 2.0 ですので、安心して製品開発や研究にご利用いただけます。今回は「mecab-ipadic-NEologd」を実務で使う際にどうするべきかをお伝えし、使用例のデモをご紹介いたします。</p></blockquote>

<h3>発表資料</h3>

<p><iframe src="https://www.slideshare.net/slideshow/embed_code/key/xfahOOsXcA159j" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/overlast/effective-mecabipadicneologdebisuta-1" title="mecab-ipadic-NEologd の効果的な使い方" target="_blank">mecab-ipadic-NEologd の効果的な使い方</a> </strong> from <strong><a href="http://www.slideshare.net/overlast" target="_blank">Toshinori Sato</a></strong> </div><cite class="hatena-citation"><a href="http://www.slideshare.net/overlast/effective-mecabipadicneologdebisuta-1">www.slideshare.net</a></cite></p>

<h1>恵比寿スタートアップを盛り上げていきます！</h1>

<p>スタートアップを追いかけている週アスPLUSによると、「スタートアップ集積地」として恵比寿が最近盛り上がってきているそうです。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fweekly.ascii.jp%2Felem%2F000%2F000%2F334%2F334134%2F" title="バイアウトが話題のエウレカほか注目企業多数！ 押さえておきたい恵比寿スタートアップ【2015年5月】" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://weekly.ascii.jp/elem/000/000/334/334134/">バイアウトが話題のエウレカほか注目企業多数！ 押さえておきたい恵比寿スタートアップ【2015年5月】</a></iframe><cite class="hatena-citation"><a href="http://weekly.ascii.jp/elem/000/000/334/334134/">weekly.ascii.jp</a></cite></p>

<p>えびスタ！では、恵比寿のスタートアップやエンジニアコミュニティを盛り上げるために今後もイベントを開催してまいります。運営する株式会社ユーザベース・株式会社ニューズピックスにご興味のある方は、以下のWantedlyなどからお気軽にご連絡ください！</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.wantedly.com%2Fcompanies%2Fuzabase-inc" title="株式会社ユーザベースの最新情報 - Wantedly" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="https://www.wantedly.com/companies/uzabase-inc">株式会社ユーザベースの最新情報 - Wantedly</a></iframe><cite class="hatena-citation"><a href="https://www.wantedly.com/companies/uzabase-inc">www.wantedly.com</a></cite></p>
</description>          <pubDate>Fri, 15 May 2015 17:02:06 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450094322238</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150513/20150513151035.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>「えびスタ！#2 ~大規模データの調理法~ ユーザベースxクックパッドxVASILYxエウレカxはてな」開催のお知らせ</title>
          <link>http://tech.uzabase.com/entry/2015/04/10/194732</link>          <description><p>SPEEDA/を提供する株式会社ユーザベースでは、エンジニアの技術力向上と交流を目的として「えびスタ！（恵比寿スタートアップ勉強会）」を開催しています。2015年4月23日（木）に「えびスタ #2」を開催しますのでお知らせいたします。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150410/20150410193802.png" alt="f:id:uzabase:20150410193802p:plain" title="f:id:uzabase:20150410193802p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>第2回となる今回は、クックパッド、VASILY、エウレカ、そして特別ゲストとして京都からはてなのエンジニアをお呼びして開催します。各社の事例をもとに、アドテクを支える技術やRedShiftの活用法などについてお話する予定です。</p>

<p>また後半では軽食（エビスビールとピザ！）を交えたLTや交流会も開催予定です。恵比寿のスタートアップと語り合いたい、他社エンジニアと交流したいという方はぜひお気軽にご参加いただければと思います。（LT参加者も募集しています。LTしていただける方は応募時に「LTしたい！」とコメントください。）</p>

<p>イベント詳細や申し込みについては以下の connpass ページをご覧ください。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Febista.connpass.com%2Fevent%2F13953%2F" title="えびスタ！#2 ~大規模データの調理法~ ユーザベースxクックパッドxVASILYxエウレカxはてな (2015/04/23 19:00〜)" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"><a href="http://ebista.connpass.com/event/13953/">えびスタ！#2 ~大規模データの調理法~ ユーザベースxクックパッドxVASILYxエウレカxはてな (2015/04/23 19:00〜)</a></iframe><cite class="hatena-citation"><a href="http://ebista.connpass.com/event/13953/">ebista.connpass.com</a></cite></p>
</description>          <pubDate>Fri, 10 Apr 2015 19:47:32 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450091056412</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150410/20150410193802.png" type="image/png" length="0" />
        </item>
      
    
      
      
        <item>
          <title>IntelliJ IDEA + JRebel セミナーを開催しました</title>
          <link>http://tech.uzabase.com/entry/2015/03/30/175726</link>          <description><p> 開発チームの文字です。</p>

<p>先週の金曜日、株式会社サムライズムの山本裕介さん（<a href="https://twitter.com/yusuke">@yusuke</a>）に弊社オフィスまで来て頂き、IntelliJ IDEA + JRebel のセミナーを開催して頂きました。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150329/20150329161416.jpg" alt="f:id:uzabase:20150329161416j:plain" title="f:id:uzabase:20150329161416j:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>弊社は SPEEDA /  ともにサーバーサイドの実装に Java を利用しています。私自身や一部メンバーは IntelliJ IDEA を使っているのですが、使い慣れた Eclipse を利用しているメンバーも多いため、今回 Eclipse から IntelliJ IDEA への移行を検討するためにセミナーを開いて頂きました（ちなみに iOS 開発を行っているメンバーは App Code を利用しています）。加えて、SPEEDA 開発チームで導入を検討している JRebel のデモも行って頂きました。</p>

<p>私が Eclipse から IntelliJ IDEA に移行したのは半年ほど前ですが、既に Eclipse に戻れなくなりつつあります。要因は幾つかあるのですが、パッと思い付くところだと以下でしょうか。</p>

<ul>
<li>全体的に動作が軽い・速い</li>
<li>デバッグ時の変数内容表示が使いやすい</li>
<li>プラグインが無くてもデフォルトで様々な言語／フレームワークのサポートがある</li>
<li>Postfix Completion が使いやすい</li>
</ul>


<p>総じて何もセットアップしなくても「痒いところに手が届く」IDE になっているのが魅力だなと感じています。Eclipse 時代には何かとプラグインを自作していましたが、IntelliJ IDEA では大抵のものは標準でサポートされています。</p>

<p>@yusuke さんのデモを見て私自身も様々な機能を知らなかったことに今更ながら気付きましたが（恥ずかしながら Chronon Debug や Live Edit・BTS 連携などは全く知りませんでした）、社内の開発メンバーも Postfix Completion を始めとした IntelliJ IDEA の様々な機能に驚きの声を上げており、本格的にチームでの導入を検討しようかという声もありました。</p>

<p>非常に勉強になるセッションでした。@yusuke さん、本当にありがとうございました！</p>
</description>          <pubDate>Mon, 30 Mar 2015 17:57:26 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450089701904</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150329/20150329161416.jpg" type="image/jpeg" length="0" />
        </item>
      
    
      
      
        <item>
          <title>Preserving Code Quality and Save Everyone’s Time with SonarQube</title>
          <link>http://tech.uzabase.com/entry/2015/03/20/174914</link>          <description><p>Hello. I'm Jason from SPEEDA's development team</p>

<p>A developer's work (and even life) revolves around writing and testing codes. As a developer, I, like many others, take pride in my codes which are clean, elegant, and bug-free. And so we do our best to achieve this.</p>

<p>I must admit, though, that even as a seasoned developer, I do have some shortcomings. SonarQube classifies these shortcomings as the "Seven Deadly Sins" which are considered as capital sins committed by developers everyday.</p>

<ol>
<li>Bugs and potential bugs</li>
<li>Coding standards breach</li>
<li>Duplicates</li>
<li>Lack of unit tests</li>
<li>Bad distribution of complexity</li>
<li>Spaghetti design</li>
<li>Not enough / too many comments</li>
</ol>


<p>For more description you can visit the SonarQube: <a href="http://docs.sonarqube.org/display/SONAR/Developers%27+Seven+Deadly+Sins">Developers&#39; Seven Deadly Sins - SonarQube - Confluence</a></p>

<p>One way to avoid these pitfalls is through peer review. We should not be afraid to ask others to review our codes so we can be aware of our weaknesses. Similarly, we should also take the time to review other's work. This helps ensure that we deliver quality but this does not guarantee 100% error-proof codes (after all, reviewers are also humans who commit errors). They may improve 90% of the code but will still miss the remaining 10%.</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320013622.png" alt="f:id:uzabase:20150320013622p:plain" title="f:id:uzabase:20150320013622p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>Some people claim that the practice of peer review is a waste of precious human resource. They argue that more experienced developer can contribute more to a project through other means other than reviewing their colleagues' codes. While they may have a point, in my experience, review improves everybody's coding skills because of the reviewers give correct solutions and tips. Meanwhile, the reviewee (or the developer receiving the feedback) learns from the more-experienced colleague. This exercise becomes an avenue for knowledge sharing in the company.</p>

<p>From the project management perspective, one would like to measure or quantify the developers' improvements in the peer review practice. But since we don't really count how many feedbacks a developer has for his code, we can't really give a number to the project managers.</p>

<p>But I believe that these problems can be managed through a platform to manage code quality called <b>SonarQube</b>.</p>

<h3>What is SonarQube?</h3>

<p><i>"SonarQube is the central place to manage code quality, offering visual reporting on and across projects and enabling to replay the past to follow metrics evolution."</i></p>

<p>It is open source, extensible with custom plugins (and we can even create one ourselves), we can integrate this with other systems (such as Jenkins), and supports 20+ programming language (In our case we will just use Java).</p>

<p>I've actually implemented this with our current codebase and there were, indeed, some simple misses in the codes (it might have been overlooked by the reviewers). But due to confidentiality, I chose to hide the numbers and the source codes here in this entry.</p>

<p>This is a screenshot of the dashboard of SonarQube's demo: <a href="http://nemo.sonarqube.org">SonarQube</a></p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320013733.png" alt="f:id:uzabase:20150320013733p:plain" title="f:id:uzabase:20150320013733p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>We can see the technical debt (what the developers have to "pay" to fix the issues) is set to 82,176 days. Assuming that 1 person will work in 8 hours a day, it will take that developer to fix everything in 82,176 days. (And also assuming that it won't increase anymore). There are 14,937,000 lines of codes there, and 2,714,682 issues. Issues are categorized as Blocker, Critical, Major, Minor, Info. Depending on your company, you will need to determine how they should be dealt with.</p>

<p>In the code below, you can see SonarQube gives suggestions as to the best approach for this case. Of course, SonarQube will not always be correct since we may be following the company's coding standard. We can actually adjust the rules of SonarQube to fit our company's coding standard.</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320013957.png" alt="f:id:uzabase:20150320013957p:plain" title="f:id:uzabase:20150320013957p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>This is another example of a code that doesn't follow JavaBean's Naming convention and the complexity of this code is quite high based from SonarQube's  calculation.</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320014035.png" alt="f:id:uzabase:20150320014035p:plain" title="f:id:uzabase:20150320014035p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>You can also assign the technical debt tasks to your teammates (You can integrate this to your JIRA or Redmine so it creates tickets which the Project Leader could also manage)</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320014054.png" alt="f:id:uzabase:20150320014054p:plain" title="f:id:uzabase:20150320014054p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>Here we can customized the rules SonarQube is following</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320014111.png" alt="f:id:uzabase:20150320014111p:plain" title="f:id:uzabase:20150320014111p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>We can also see which codes got duplicated (or copy paste instead of refactoring and reusing the same code)</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320014135.png" alt="f:id:uzabase:20150320014135p:plain" title="f:id:uzabase:20150320014135p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>And here is from another file with the same codes</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320014147.png" alt="f:id:uzabase:20150320014147p:plain" title="f:id:uzabase:20150320014147p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>There are still tons of functionalities which SonarQube has but I haven't explored yet.</p>

<p>Regarding installation, setup is a breeze so I highly recommend you try it on your codebase.</p>

<h4>To sum up,</h4>

<p>SonarQube is not just for developers, but for everyone involved in the project:</p>

<ul>
<li>For developers, it helps them check if their code is correct and follows the correct coding standard.</li>
<li>For QA, it helps them check the test coverage of unit test (they make sure that every code is tested on unit level)</li>
<li>For Architects, it helps them check if the architecture of the system is correct, and that no codes are having a spaghetti code design.</li>
<li>For Managers, it helps them see if developers are actually improving (they can monitor if technical debt actually decreases) and can
use this for future decisions (i.e. they can delay the release of a functionality because it's technical debt is too high).</li>
</ul>


<h4>"Quality is everyone's responsibility" - Deming, W. Edwards</h4>

<hr />

<p>If you are the type of developer who takes pride in your skills and values code quality, or if you are interested in learning new and interesting technologies, then we want you!</p>

<p>You can try checking this link <a href="https://www.wantedly.com/companies/uzabase-inc">&#x682A;&#x5F0F;&#x4F1A;&#x793E;&#x30E6;&#x30FC;&#x30B6;&#x30D9;&#x30FC;&#x30B9;&#x306E;&#x6700;&#x65B0;&#x60C5;&#x5831; - Wantedly</a> and give us a contact!</p>
</description>          <pubDate>Fri, 20 Mar 2015 17:49:14 +0900</pubDate>
          <guid isPermalink="false">hatenablog://entry/8454420450088648834</guid>
          
          <enclosure url="http://cdn-ak.f.st-hatena.com/images/fotolife/u/uzabase/20150320/20150320013622.png" type="image/png" length="0" />
        </item>
      
    
  </channel>
</rss>
